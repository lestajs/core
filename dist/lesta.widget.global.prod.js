(()=>{var V=Object.defineProperty;var I=(e,t)=>{for(var r in t)V(e,r,{get:t[r],enumerable:!0})};function p(e){return e?typeof e=="object"?JSON.parse(JSON.stringify(e)):e:e??null}async function f(e,t,r){return new Promise((n,o)=>{let s=()=>{o(),r?.(),t?.removeEventListener("abort",s)};t?.addEventListener("abort",s),t?.aborted&&s(),e.then(n).catch(o)})}function b(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var h=(e,t,r="")=>{};function l(e,t,r=""){if(!(e&&(e.constructor.name==="Object"||e.constructor.name==="Array")))return e;let n={getPrototypeOf(o){return{target:o,instance:"Proxy"}},get(o,s,i){return t.get?.(o,s,`${r}${s}`),Reflect.get(o,s,i)},set(o,s,i,a){return t.beforeSet(i,`${r}${s}`,m=>{i=m})||!(Reflect.get(o,s,a)!==i||s==="length")||(i=l(i,t,`${r}${s}.`),Reflect.set(o,s,i,a),t.set(o,i,`${r}${s}`)),!0},deleteProperty(o,s){return Reflect.deleteProperty(o,s)},defineProperty(o,s,i){return Reflect.defineProperty(o,s,i)}};e=p(e);for(let o in e)e.hasOwnProperty(o)&&(e[o]=l(e[o],t,`${r}${o}.`));return new Proxy(e,n)}function x(e,t,r){if(!e)return;let n=(o,s)=>{let i=Math.min(o.length,s.length);return o.slice(0,i)===s.slice(0,i)};for(let[o,s]of e)Array.isArray(s)?s.includes(t)&&o(r):n(t,s)&&o(r,t.length>s.length?t.replace(s+".",""):void 0)}var u=(e,t,r="")=>{};var C={refs:[],collect:!1,define(e){return e&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var v={};I(v,{_attr:()=>T,_class:()=>_,_event:()=>S,_text:()=>M});var _={update:(e,t,r)=>t?e.target.classList.add(r):e.target.classList.remove(r)};var M={update:(e,t)=>{t!==void 0&&(e.target.textContent=t!==Object(t)?t:JSON.stringify(t))}};var T={update:(e,t,r)=>{typeof t=="boolean"?t?e.target.setAttribute(r,""):e.target.removeAttribute(r):e.target.setAttribute(r,t)}};var S={create:(e,t)=>{for(let r in t)e.target.addEventListener(r,t[r])},destroy:(e,t)=>{for(let r in t)e.target.removeEventListener(r,t[r])}};var y=class{constructor(t,r,n,o,s){this.factory=s,this.component=t,this.app=n,this.impress=C,this.proxiesData={},this.context={app:n,container:r,options:t,phase:0,abort:()=>o.abort(),appId:()=>(n.id++,n.name+n.id),abortSignal:o.signal,node:{},param:{},method:{},proxy:{},source:t.sources||{},directives:{...v,...n.directives,...t.directives}}}async loaded(t){await this.component.loaded?.bind(this.context)(t)}async props(){}async rendered(){if(typeof this.component!="object")return h(this.context.container.nodepath,211);await this.component.rendered?.bind(this.context)()}async mounted(){await this.component.mounted?.bind(this.context)()}async created(){await this.component.created?.bind(this.context)()}unmounted(t){this.component.unmounted?.bind(this.context)(),delete t.unmount}refreshed(t){this.component.refreshed?.bind(this.context)(t)}methods(){if(this.component.methods)for(let[t,r]of Object.entries(this.component.methods)){if(this.context.method.hasOwnProperty(t))return h(this.context.container.nodepath,212,t);this.context.method[t]=r.bind(this.context),this.component.actions?.includes(t)&&(this.context.container.action[t]=(...n)=>{let o=r.bind(this.context)(p(...n));return o instanceof Promise?o.then(s=>p(s)):p(o)})}Object.preventExtensions(this.context.container.action),Object.preventExtensions(this.context.method)}params(){if(this.component.params){for(let t in this.component.params)if(this.context.param.hasOwnProperty(t))return h(this.context.container.nodepath,213,t);Object.assign(this.context.param,this.component.params)}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return h(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}actives(t,r){x(t.reactivity?.node,r)}getProxy(){return l(this.proxiesData,{beforeSet:(t,r,n)=>{if(this.component.setters?.[r]){let o=this.component.setters[r].bind(this.context)(t);if(o===void 0)return!0;n(o)}},set:(t,r,n)=>{for(let o in this.context.node)this.actives(this.context.node[o],n,r);this.component.handlers?.[n]?.bind(this.context)(r)},get:(t,r,n)=>{this.impress.collect&&!this.impress.refs.includes(n)&&t.hasOwnProperty(r)&&this.impress.refs.push(n)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(this.context),r=this.context.container,n=r.target;for(let o in t){let s=t[o].selector||this.context.app.selectors||`.${o}`,i=typeof s=="function"?s(o):s,a=n.querySelector(i)||n.matches(i)&&n,c=r.nodepath+"."+o;if(a){if(a._engaged)return u(c,106,o);a._engaged=!0;let m=this.component.styles?.[o];if(typeof m=="string"&&m.trim()&&(a.classList.remove(o),a.classList.add(m)),r.spot&&Object.values(r.spot).includes(a)){u(c,107,o);continue}Object.assign(this.context.node,{[o]:{target:a,nodepath:c,nodename:o,action:{},prop:{},directives:{}}})}else u(c,105)}Object.preventExtensions(this.context.node);for await(let[o,s]of Object.entries(this.context.node))await this.factory(t[o],this.context,s,this.impress,this.app).controller()}}};var j={directives(e){let t=this.nodeElement;if(!e.startsWith("_"))return u(t.nodepath,102,e);let r=this.context.directives[e],n=this.nodeOptions[e],{create:o,update:s,destroy:i}=r;Object.assign(t.directives,{[e]:{create:()=>o?o.bind(r)(t,n):{},destroy:()=>i?i.bind(r)(t,n):{}}}),o&&t.directives[e].create();let a=(c,m,E)=>{let g=D=>s.bind(r)(t,D,m,E);typeof c=="function"?(this.impress.collect=!0,g(c(t,E)),this.reactiveNode(this.impress.define(),()=>g(c(t,E)))):g(c)};if(s)if(typeof n=="object")for(let c in n)a(n[c],c,n);else a(n)}};var P={listeners(e){typeof this.nodeOptions[e]=="function"&&(this.nodeElement.target[e]=t=>{this.nodeOptions[e].bind(this.context)(t)})},general(e){let t=r=>{this.nodeElement.target[e]!==null&&typeof this.nodeElement.target[e]=="object"?r!==null&&typeof r=="object"?Object.assign(this.nodeElement.target[e],r):u(this.nodeElement.nodepath,103,e):this.nodeElement.target[e]=r};if(typeof this.nodeOptions[e]=="function"){let r=()=>t(this.nodeOptions[e].bind(this.context)());this.impress.collect=!0,r(),this.reactiveNode(this.impress.define(),r)}else t(this.nodeOptions[e])},native(e){e.startsWith("on")?this.listeners(e):this.general(e)}};var d=class{constructor(t,r,n,o,s){this.app=s,this.nodeOptions=t,this.context=r,this.impress=o,this.nodeElement=n,this.nodeElement.reactivity={node:new Map}}reactive(t,r,n){return t?.length&&n.set(r,t),this.impress.clear(),t}reactiveNode(t,r){this.reactive(t,r,this.nodeElement.reactivity.node)}controller(){let t=this.nodeElement.nodepath,r=this.nodeElement.target.tagName==="TEMPLATE";this.nodeElement.replaced=r;for(let n in this.nodeOptions){if(r&&!["selector","component"].includes(n))return u(t,108,n);if(n in this.nodeElement.target)this.native(n);else if(n in this.context.directives)this.directives(n);else{if(n==="component")return this.component?.();if(n!=="selector")return u(t,104,n)}}}};function w(e,t){let r=typeof e=="function"?e.bind(t)():e,n=document.createElement("div");return n.innerHTML=r.trim().replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gi,""),n.childNodes}async function L(e,t,r,n,o={}){let s=e.context;s.container.refresh=({cause:a,data:c={}})=>e.refresh(p({cause:a,data:c}));let i=[async()=>await e.loaded(),async()=>{await e.props(o),e.params(),e.methods(),e.proxies(),await e.created()},async()=>{t(),await e.rendered()},async()=>{await e.nodes(),await e.mounted()}];try{for await(let a of i)await f(a(),s.abortSignal),s.phase++}catch(a){throw r(),a}return n?.(),s.container}function q(...e){return Object.assign(d.prototype,P,j),new d(...e)}async function $(e,t,r={}){if(r.id=0,r.name||="_",!e)return h(r.name,216);if(!t)return h(r.name,217);let n={...e},o=new AbortController,s={target:t,nodepath:r.name,action:{},unmount(){o.abort(),t.innerHTML="",a.unmounted(s)}},i=()=>r.aborted?.({phase:a.context.phase,reason:o.signal.reason}),a=new y(n,s,r,o,q);return await L(a,()=>{a.context.container=s,n.template&&t.append(...w(n.template,a.context))},i,r.completed)}window.lesta={mountWidget:$,replicate:p,revocablePromise:f,camelToKebab:b};})();
