(()=>{function u(o){return o?typeof o=="object"?JSON.parse(JSON.stringify(o)):o:o??null}function E(o){let t=document.createElement("table");return t.innerHTML=o,t}function O(o){function t(s){let c=s.querySelectorAll("script");for(let a of c)a.remove()}function e(s,c){let a=c.replace(/\s+/g,"").toLowerCase();if(["src","href","xlink:href"].includes(s)&&(a.includes("javascript:")||a.includes("data:text/html"))||s.startsWith("on"))return!0}function r(s){let c=s.attributes;for(let{name:a,value:h}of c)e(a,h)&&s.removeAttribute(a)}function n(s){let c=s.children;for(let a of c)r(a),n(a)}let i=E(o);return t(i),n(i),i.childNodes}var p=(o="root",t,e="")=>{};var y=class{constructor(t,e,r){this.component=t,this.app=e,this.proxiesData={},this.context={...e,mount:e.mount,phase:0,abortSignal:r,options:t,container:null,node:{},param:{},method:{},proxy:{},source:t.sources||{}}}async loaded(t){if(this.component.loaded)return await this.component.loaded.bind(this.context)(t)}async rendered(){if(typeof this.component!="object")return p(this.context.container.nodepath,211);if(this.component.rendered)return await this.component.rendered.bind(this.context)()}async created(){if(this.component.created)return await this.component.created.bind(this.context)()}methods(){if(this.context.container.method||(this.context.container.method={}),this.component.methods)for(let[t,e]of Object.entries(this.component.methods))this.context.method[t]=e.bind(this.context),this.context.container.method[t]=(...r)=>this.context.method[t](...u(r));Object.preventExtensions(this.context.method)}params(){if(this.component.params){for(let t in this.component.params)if(t in this.context.param)return p(this.context.container.nodepath,213,t);Object.assign(this.context.param,u(this.component.params))}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return p(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}};function m(o,t,e=""){if(!(o&&(o.constructor.name==="Object"||o.constructor.name==="Array")))return o;let r={getPrototypeOf(n){return{target:n,instance:"Proxy"}},get(n,i,s){return t.get?.(n,`${e}${i}`),Reflect.get(n,i,s)},set(n,i,s,c){return t.beforeSet(s,`${e}${i}`,h=>s=h)||(Reflect.get(n,i,c)!==s||i==="length"||i.startsWith("__"))&&(s=m(s,t,`${e}${i}.`),Reflect.set(n,i,s,c),t.set(n,s,`${e}${i}`)),!0},deleteProperty(n,i){return Reflect.deleteProperty(n,i)},defineProperty(n,i,s){return Reflect.defineProperty(n,i,s)}};o=u(o);for(let n in o)o[n]=m(o[n],t,`${e}${n}.`);return new Proxy(o,r)}function d(o,t,e){let r=(n,i)=>{let s=n.split("."),c=i.split(".");for(let a=0;a<c.length;a++)if(s[a]!==c[a])return!1;return!0};for(let[n,i]of o)if(Array.isArray(i))i.includes(t)&&n(e);else if(r(t,i)){let s=[...t.split(".")||[]];s.shift(),n(e,s)}}var L={update:async(o,t)=>{let e=typeof t=="function"?await t(o):t;e!==void 0&&(o.innerHTML="",o.append(...O(e)))}};var N={update:async(o,t)=>{let e=typeof t=="function"?await t(o):t;e!==void 0&&(o.innerHTML=e)}};var C={update:(o,t,e)=>{(typeof t[e]=="function"?t[e](o):t[e])?o.classList.add(e):o.classList.remove(e)}};var M={update:async(o,t)=>{let e=typeof t=="function"?await t(o):t;e!==void 0&&(o.textContent=e)}};var l=(o,t,e="")=>{};var q={refs:[],collect:!1,exclude(o){this.collect=!1;let t=o();return this.collect=!0,t},define(o){return o&&o.startsWith("_")?this.refs[0]:[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var b=class extends y{constructor(t,e,r,n){super(t,e,r),this.Nodes=n,this.impress=q,this.context={...this.context,exclude:this.impress.exclude.bind(this.impress),directives:{_html:L,_evalHTML:N,_class:C,_text:M,...e.directives,...t.directives}}}async props(){}async mounted(){this.component.mounted&&await this.component.mounted.bind(this.context)()}getProxy(){return m(this.proxiesData,{beforeSet:(t,e,r)=>{if(this.component.setters?.[e]){let n=this.component.setters[e].bind(this.context)(t);if(n===void 0)return!0;r(n)}},set:(t,e,r)=>{for(let n in this.context.node){let i=this.context.node[n];i.reactivity.node&&d(i.reactivity.node,r),i.reactivity.component&&d(i.reactivity.component,r,e);for(let s in i.section)i.section[s]?.reactivity.component&&d(i.section[s].reactivity.component,r,e)}this.component.handlers?.[r]?.bind(this.context)(e)},get:(t,e)=>{this.impress.collect&&!this.impress.refs.includes(e)&&this.impress.refs.push(e)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),e=this.context.container;for await(let[r,n]of Object.entries(t)){let i=this.component.selectors&&this.component.selectors[r]||`.${r}`,s=e.querySelector(i)||e.classList.contains(r)&&e,c=e.nodepath?e.nodepath+"."+r:r;if(s){if(s.nodepath=c,s.nodename=r,Object.assign(this.context.node,{[r]:s}),n){let a=new this.Nodes(n,this.context,s,this.impress,this.app,r);for await(let[h]of Object.entries(n))await a.controller(h)}}else l(c,105)}Object.preventExtensions(this.context.node)}}};var f=class{constructor(t,e,r,n,i,s){this.app=i,this.node=t,this.context=e,this.impress=n,this.nodeElement=r,this.keyNode=s,this.nodeElement.reactivity={node:new Map}}reactive(t,e,r){t.length&&r.set(e,t),this.impress.clear()}reactiveNode(t,e){this.reactive(t,e,this.nodeElement.reactivity.node)}};var w=class extends f{constructor(...t){super(...t)}init(t){if(t[0]!=="_")return l(this.nodeElement.nodepath,102,t);let e=this.context.directives[t],r=this.node[t],{create:n,update:i,destroy:s}=e;"directives"in this.nodeElement||Object.assign(this.nodeElement,{directives:{}}),Object.assign(this.nodeElement.directives,{[t]:{create:()=>n?n(this.nodeElement,r,e):{},destroy:()=>s?s(this.nodeElement,r,e):{}}}),n&&this.nodeElement.directives[t].create();let c=(a,h,v)=>{typeof a=="function"?(this.impress.collect=!0,i.bind(e)(this.nodeElement,h,v),this.reactiveNode(this.impress.define(),()=>i(this.nodeElement,h,v))):i.bind(e)(this.nodeElement,h,v)};if(i!=null)if(typeof r=="object")for(let a in r)c(r[a],r,a);else c(r,r)}};var g=class extends f{constructor(...t){super(...t)}listeners(t){typeof this.node[t]=="function"&&(this.nodeElement[t]=e=>this.node[t].bind(this.context)(e))}general(t){if(t==="innerHTML")return l(this.nodeElement.nodepath,106);if(typeof this.node[t]=="function"){let e=()=>{let r=this.node[t].bind(this.context)(this.nodeElement);this.nodeElement[t]!==null&&typeof this.nodeElement[t]=="object"?r!==null&&typeof r=="object"?Object.assign(this.nodeElement[t],r):l(this.nodeElement.nodepath,103,t):this.nodeElement[t]=r!==Object(r)?r:JSON.stringify(r)};this.impress.collect=!0,e(),this.reactiveNode(this.impress.define(),e)}else this.nodeElement[t]=this.node[t]}init(t){t.substr(0,2)==="on"?this.listeners(t):this.general(t)}};var x=class{constructor(t,e,r,n,i,s){this.app=i,this.node=t,this.context=e,this.impress=n,this.nodeElement=r,this.keyNode=s,this.directive=new w(t,e,r,n,i,s),this.native=new g(t,e,r,n,i,s)}async controller(t){t in this.nodeElement?this.native.init(t):t in this.context.directives?this.directive.init(t):t==="component"&&this.component?await this.component():l(this.nodeElement.nodepath,104,t)}};async function A(o,t,e){let r=[async()=>await o.loaded(),async()=>{if(o.context.container=t(),typeof document<"u")return await o.rendered()},async()=>(await o.props(),o.params(),o.methods(),o.proxies(),await o.created()),async()=>{if(await o.nodes(),typeof document<"u")return await o.mounted()}];for await(let n of r){let i=await n();if(o.context.phase++,o.context.abortSignal?.aborted||i){e&&e({phase:o.context.phase,data:i,abortSignal:o.context.abortSignal});return}}return o.context.container}async function H(o,t,e,r){if(!o)return p("root",216);e&&!(e instanceof AbortSignal)&&p("root",217),r&&typeof r!="function"&&p("root",218);let n=new b(o,{},e,x);return await A(n,()=>{t.innerHTML=o.template,n.context.container=t},r),{destroy(){delete t.reactivity,delete t.method,t.innerHTML=""}}}window.lesta={createWidget:H};})();
