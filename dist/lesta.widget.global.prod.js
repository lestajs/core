(()=>{function p(o){return o?typeof o=="object"?JSON.parse(JSON.stringify(o)):o:o??null}function v(o){let t=document.createElement("table");return t.innerHTML=o,t}function O(o){function t(s){let c=s.querySelectorAll("script");for(let a of c)a.remove()}function e(s,c){let a=c.replace(/\s+/g,"").toLowerCase();if(["src","href","xlink:href"].includes(s)&&(a.includes("javascript:")||a.includes("data:text/html"))||s.startsWith("on"))return!0}function r(s){let c=s.attributes;for(let{name:a,value:u}of c)e(a,u)&&s.removeAttribute(a)}function i(s){let c=s.children;for(let a of c)r(a),i(a)}let n=v(o);return t(n),i(n),n.childNodes}var h=(o="root",t,e="")=>{};var b=class{constructor(t,e,r){this.component=t,this.app=e,this.proxiesData={},this.context={...e,mount:e.mount,phase:0,abortSignal:r,options:t,container:null,node:{},param:{},method:{},proxy:{},source:t.sources||{}}}async loaded(t){if(this.component.loaded)return await this.component.loaded.bind(this.context)(t)}async rendered(){if(typeof this.component!="object")return h(this.context.container.nodepath,211);if(this.component.rendered)return await this.component.rendered.bind(this.context)()}async created(){if(this.component.created)return await this.component.created.bind(this.context)()}methods(){if(this.context.container.method||(this.context.container.method={}),this.component.methods)for(let[t,e]of Object.entries(this.component.methods))this.context.method[t]=e.bind(this.context),this.context.container.method[t]=(...r)=>this.context.method[t](...p(r));Object.preventExtensions(this.context.method)}params(){if(this.component.params){for(let t in this.component.params)if(t in this.context.param)return h(this.context.container.nodepath,213,t);Object.assign(this.context.param,p(this.component.params))}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return h(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}};function f(o,t,e=""){if(!(o&&(o.constructor.name==="Object"||o.constructor.name==="Array")))return o;let r={getPrototypeOf(i){return{target:i,instance:"Proxy"}},get(i,n,s){return typeof n=="symbol"||t.get?.(i,`${e}${n}`),Reflect.get(i,n,s)},set(i,n,s,c){if(typeof n=="symbol")return Reflect.set(i,n,s,c);let a=!1;return t.beforeSet(s,`${e}${n}`,y=>{s=y,a=!0})&&!(Reflect.get(i,n,c)!==s||n==="length"||a)||(s=f(s,t,`${e}${n}.`),Reflect.set(i,n,s,c),t.set(i,s,`${e}${n}`)),!0},deleteProperty(i,n){return Reflect.deleteProperty(i,n)},defineProperty(i,n,s){return Reflect.defineProperty(i,n,s)}};o=p(o);for(let i in o)o[i]=f(o[i],t,`${e}${i}.`);return new Proxy(o,r)}function d(o,t,e){let r=(i,n)=>{let s=Math.min(i.length,n.length);return i.slice(0,s)===n.slice(0,s)};for(let[i,n]of o)Array.isArray(n)?n.includes(t)&&i(e):r(t,n)&&i(e,t.length>n.length?t.replace(n+".","").split("."):void 0)}var L={update:async(o,t)=>{let e=typeof t=="function"?await t(o):t;e!==void 0&&(o.innerHTML="",o.append(...O(e)))}};var C={update:async(o,t)=>{let e=typeof t=="function"?await t(o):t;e!==void 0&&(o.innerHTML=e)}};var N={update:(o,t,e)=>{(typeof t[e]=="function"?t[e](o):t[e])?o.classList.add(e):o.classList.remove(e)}};var M={update:async(o,t)=>{let e=typeof t=="function"?await t(o):t;e!==void 0&&(o.textContent=e)}};var l=(o,t,e="")=>{};var R={refs:[],collect:!1,exclude(o){this.collect=!1;let t=o();return this.collect=!0,t},define(o){return o&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var w=class extends b{constructor(t,e,r,i){super(t,e,r),this.Nodes=i,this.impress=R,this.context={...this.context,exclude:this.impress.exclude.bind(this.impress),directives:{_html:L,_evalHTML:C,_class:N,_text:M,...e.directives,...t.directives}}}async props(){}async mounted(){this.component.mounted&&await this.component.mounted.bind(this.context)()}getProxy(){return f(this.proxiesData,{beforeSet:(t,e,r)=>{if(this.component.setters?.[e]){let i=this.component.setters[e].bind(this.context)(t);if(i===void 0)return!0;r(i)}},set:(t,e,r)=>{for(let i in this.context.node){let n=this.context.node[i];n.reactivity.node&&d(n.reactivity.node,r),n.reactivity.component&&d(n.reactivity.component,r,e);for(let s in n.section)n.section[s]?.reactivity.component&&d(n.section[s].reactivity.component,r,e)}this.component.handlers?.[r]?.bind(this.context)(e)},get:(t,e)=>{this.impress.collect&&!this.impress.refs.includes(e)&&this.impress.refs.push(e)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),e=this.context.container;for await(let[r,i]of Object.entries(t)){let n=this.component.selectors&&this.component.selectors[r]||`.${r}`,s=e.querySelector(n)||e.classList.contains(r)&&e,c=e.nodepath?e.nodepath+"."+r:r;if(s){if(s.nodepath=c,s.nodename=r,Object.assign(this.context.node,{[r]:s}),i){let a=new this.Nodes(i,this.context,s,this.impress,this.app,r);for await(let[u]of Object.entries(i))await a.controller(u)}}else l(c,105)}Object.preventExtensions(this.context.node)}}};var m=class{constructor(t,e,r,i,n,s){this.app=n,this.node=t,this.context=e,this.impress=i,this.nodeElement=r,this.keyNode=s,this.nodeElement.reactivity={node:new Map}}reactive(t,e,r){t.length&&r.set(e,t),this.impress.clear()}reactiveNode(t,e){this.reactive(t,e,this.nodeElement.reactivity.node)}};var g=class extends m{constructor(...t){super(...t)}init(t){if(t[0]!=="_")return l(this.nodeElement.nodepath,102,t);let e=this.context.directives[t],r=this.node[t],{create:i,update:n,destroy:s}=e;"directives"in this.nodeElement||Object.assign(this.nodeElement,{directives:{}}),Object.assign(this.nodeElement.directives,{[t]:{create:()=>i?i(this.nodeElement,r,e):{},destroy:()=>s?s(this.nodeElement,r,e):{}}}),i&&this.nodeElement.directives[t].create();let c=(a,u,y)=>{typeof a=="function"?(this.impress.collect=!0,n.bind(e)(this.nodeElement,u,y),this.reactiveNode(this.impress.define(),()=>n(this.nodeElement,u,y))):n.bind(e)(this.nodeElement,u,y)};if(n!=null)if(typeof r=="object")for(let a in r)c(r[a],r,a);else c(r,r)}};var E=class extends m{constructor(...t){super(...t)}listeners(t){typeof this.node[t]=="function"&&(this.nodeElement[t]=e=>this.node[t].bind(this.context)(e,this.nodeElement))}general(t){if(t==="innerHTML")return l(this.nodeElement.nodepath,106);if(typeof this.node[t]=="function"){let e=()=>{let r=this.node[t].bind(this.context)(this.nodeElement);this.nodeElement[t]!==null&&typeof this.nodeElement[t]=="object"?r!==null&&typeof r=="object"?Object.assign(this.nodeElement[t],r):l(this.nodeElement.nodepath,103,t):this.nodeElement[t]=r!==Object(r)?r:JSON.stringify(r)};this.impress.collect=!0,e(),this.reactiveNode(this.impress.define(),e)}else this.nodeElement[t]=this.node[t]}init(t){t.startsWith("on")?this.listeners(t):this.general(t)}};var x=class{constructor(t,e,r,i,n,s){this.app=n,this.node=t,this.context=e,this.impress=i,this.nodeElement=r,this.keyNode=s,this.directive=new g(t,e,r,i,n,s),this.native=new E(t,e,r,i,n,s)}async controller(t){t in this.nodeElement?this.native.init(t):t in this.context.directives?this.directive.init(t):t==="component"&&this.component?await this.component():l(this.nodeElement.nodepath,104,t)}};async function $(o,t,e){let r=[async()=>await o.loaded(),async()=>{if(o.context.container=t(),typeof document<"u")return await o.rendered()},async()=>(await o.props(),o.params(),o.methods(),o.proxies(),await o.created()),async()=>{if(await o.nodes(),typeof document<"u")return await o.mounted()}];for await(let i of r){let n=await i();if(o.context.phase++,o.context.abortSignal?.aborted||n){e&&e({phase:o.context.phase,data:n,abortSignal:o.context.abortSignal});return}}return o.context.container}async function A(o,t,e,r){if(!o)return h("root",216);e&&!(e instanceof AbortSignal)&&h("root",217),r&&typeof r!="function"&&h("root",218);let i=new w(o,{},e,x);return await $(i,()=>{t.innerHTML=o.template,i.context.container=t},r),{destroy(){delete t.reactivity,delete t.method,t.innerHTML=""}}}window.lesta={createWidget:A};})();
