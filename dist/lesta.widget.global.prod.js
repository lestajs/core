(()=>{function u(o){return o?typeof o=="object"?JSON.parse(JSON.stringify(o)):o:o??null}function v(o){function t(a){let h=document.createElement("capsule");return h.innerHTML=a,h}function e(a){let h=a.querySelectorAll("script");for(let c of h)c.remove()}function i(a,h){let c=h.replace(/\s+/g,"").toLowerCase();if(["src","href","xlink:href"].includes(a)&&(c.includes("javascript:")||c.includes("data:text/html"))||a.startsWith("on"))return!0}function r(a){let h=a.attributes;for(let{name:c,value:f}of h)i(c,f)&&a.removeAttribute(c)}function n(a){let h=a.children;for(let c of h)r(c),n(c)}let s=t(o);return e(s),n(s),s.childNodes}var p=(o="root",t,e="")=>{};var b=class{constructor(t,e,i){this.component=t,this.app=e,this.proxiesData={},this.context={...e,mount:e.mount,phase:0,abortSignal:i,options:t,container:null,node:{},param:{},method:{},proxy:{},source:t.sources||{}}}async loaded(t){if(this.component.loaded)return await this.component.loaded.bind(this.context)(t)}async rendered(){if(typeof this.component!="object")return p(this.context.container.nodepath,211);if(this.component.rendered)return await this.component.rendered.bind(this.context)()}async created(){if(this.component.created)return await this.component.created.bind(this.context)()}methods(){if(this.context.container.method||(this.context.container.method={}),this.component.methods)for(let[t,e]of Object.entries(this.component.methods))this.context.method[t]=e.bind(this.context),this.context.container.method[t]=(...i)=>this.context.method[t](...u(i));Object.preventExtensions(this.context.method)}params(){if(this.component.params){for(let t in this.component.params)if(t in this.context.param)return p(this.context.container.nodepath,213,t);Object.assign(this.context.param,u(this.component.params))}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return p(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}};function d(o,t,e=""){if(!(o&&(o.constructor.name==="Object"||o.constructor.name==="Array")))return o;let i={getPrototypeOf(r){return{target:r,instance:"Proxy"}},get(r,n,s){return typeof n=="symbol"||t.get?.(r,`${e}${n}`),Reflect.get(r,n,s)},set(r,n,s,a){if(typeof n=="symbol")return Reflect.set(r,n,s,a);let h=!1;return t.beforeSet(s,`${e}${n}`,f=>{s=f,h=!0})||!(Reflect.get(r,n,a)!==s||n==="length"||h)||(s=d(s,t,`${e}${n}.`),Reflect.set(r,n,s,a),t.set(r,s,`${e}${n}`)),!0},deleteProperty(r,n){return Reflect.deleteProperty(r,n)},defineProperty(r,n,s){return Reflect.defineProperty(r,n,s)}};o=u(o);for(let r in o)o[r]=d(o[r],t,`${e}${r}.`);return new Proxy(o,i)}function x(o,t,e){let i=(r,n)=>{let s=Math.min(r.length,n.length);return r.slice(0,s)===n.slice(0,s)};for(let[r,n]of o)Array.isArray(n)?n.includes(t)&&r(e):i(t,n)&&r(e,t.length>n.length?t.replace(n+".","").split("."):void 0)}var j={update:(o,t)=>{o.innerHTML="",t&&o.append(...v(t))}};var L={update:(o,t)=>t!==void 0?o.innerHTML=t:""};var C={update:(o,t,e)=>t?o.classList.add(e):o.classList.remove(e)};var N={update:(o,t)=>o.textContent=t!==Object(t)?t:JSON.stringify(t)};var l=(o,t,e="")=>{};var T={refs:[],collect:!1,define(o){return o&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var w=class extends b{constructor(t,e,i,r){super(t,e,i),this.Nodes=r,this.impress=T,this.context={...this.context,directives:{_html:j,_evalHTML:L,_class:C,_text:N,...e.directives,...t.directives}}}async props(){}async mounted(){this.component.mounted&&await this.component.mounted.bind(this.context)()}getProxy(){return d(this.proxiesData,{beforeSet:(t,e,i)=>{if(this.component.setters?.[e]){let r=this.component.setters[e].bind(this.context)(t);if(r===void 0)return!0;i(r)}},set:(t,e,i)=>{for(let r in this.context.node){let n=this.context.node[r];n.reactivity.node&&x(n.reactivity.node,i),n.reactivity.component&&x(n.reactivity.component,i,e);for(let s in n.section)n.section[s]?.reactivity.component&&x(n.section[s].reactivity.component,i,e)}this.component.handlers?.[i]?.bind(this.context)(e)},get:(t,e)=>{this.impress.collect&&!this.impress.refs.includes(e)&&this.impress.refs.push(e)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),e=this.context.container;for await(let[i,r]of Object.entries(t)){let n=r.selector||this.context.selector||`.${i}`,s=typeof n=="function"?n(i):n,a=e.querySelector(s)||e.classList.contains(i)&&e,h=e.nodepath?e.nodepath+"."+i:i;if(a){if(a.nodepath=h,a.nodename=i,Object.assign(this.context.node,{[i]:a}),r){let c=new this.Nodes(r,this.context,a,this.impress,this.app,i);for await(let[f]of Object.entries(r))await c.controller(f)}}else l(h,105)}Object.preventExtensions(this.context.node)}}};var m=class{constructor(t,e,i,r,n,s){this.app=n,this.node=t,this.context=e,this.impress=r,this.nodeElement=i,this.keyNode=s,this.nodeElement.reactivity={node:new Map}}reactive(t,e,i){t?.length&&i.set(e,t),this.impress.clear()}reactiveNode(t,e){this.reactive(t,e,this.nodeElement.reactivity.node)}};var g=class extends m{constructor(...t){super(...t)}init(t){let e=this.nodeElement;if(!t.startsWith("_"))return l(e.nodepath,102,t);let i=this.context.directives[t],r=this.node[t],{create:n,update:s,destroy:a}=i;e.hasOwnProperty("directives")||Object.assign(e,{directives:{}}),Object.assign(e.directives,{[t]:{create:()=>n?n.bind(i)(e,r):{},destroy:()=>a?a.bind(i)(e,r):{}}}),n&&e.directives[t].create();let h=(c,f,H)=>{let P=()=>s.bind(i)(e,typeof c=="function"?c(e):c,f,H);this.impress.collect=!0,P(),this.reactiveNode(this.impress.define(),P)};if(s)if(typeof r=="object")for(let c in r)h(r[c],c,r);else h(r)}};var E=class extends m{constructor(...t){super(...t)}listeners(t){typeof this.node[t]=="function"&&(this.nodeElement[t]=e=>this.node[t].bind(this.context)(e,this.nodeElement))}general(t){if(t==="innerHTML")return l(this.nodeElement.nodepath,106);if(typeof this.node[t]=="function"){let e=()=>{let i=this.node[t].bind(this.context)(this.nodeElement);this.nodeElement[t]!==null&&typeof this.nodeElement[t]=="object"?i!==null&&typeof i=="object"?Object.assign(this.nodeElement[t],i):l(this.nodeElement.nodepath,103,t):this.nodeElement[t]=i};this.impress.collect=!0,e(),this.reactiveNode(this.impress.define(),e)}else this.nodeElement[t]=this.node[t]}init(t){t.startsWith("on")?this.listeners(t):this.general(t)}};var y=class{constructor(t,e,i,r,n,s){this.app=n,this.node=t,this.context=e,this.impress=r,this.nodeElement=i,this.keyNode=s,this.directive=new g(t,e,i,r,n,s),this.native=new E(t,e,i,r,n,s)}async controller(t){t in this.nodeElement?this.native.init(t):t in this.context.directives?this.directive.init(t):t==="component"&&this.component?await this.component():t!=="selector"&&l(this.nodeElement.nodepath,104,t)}};async function $(o,t,e){let i=[async()=>await o.loaded(),async()=>{if(o.context.container=t(),typeof document<"u")return await o.rendered()},async()=>(await o.props(),o.params(),o.methods(),o.proxies(),await o.created()),async()=>{if(await o.nodes(),typeof document<"u")return await o.mounted()}];for await(let r of i){let n=await r();if(o.context.phase++,o.context.abortSignal?.aborted||n){e&&e({phase:o.context.phase,data:n,abortSignal:o.context.abortSignal});return}}return o.context.container}async function M(o,t,e,i){if(!o)return p("root",216);e&&!(e instanceof AbortSignal)&&p("root",217),i&&typeof i!="function"&&p("root",218);let r=new w(o,{},e,y);return await $(r,()=>{t.innerHTML=o.template,r.context.container=t},i),{destroy(){delete t.reactivity,delete t.method,t.innerHTML=""}}}window.lesta={createWidget:M};})();
