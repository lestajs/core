(()=>{var V=Object.defineProperty;var I=(e,t)=>{for(var r in t)V(e,r,{get:t[r],enumerable:!0})};function h(e){return e?typeof e=="object"?JSON.parse(JSON.stringify(e)):e:e??null}async function u(e,t,r){return new Promise((n,o)=>{let s=()=>{o(),r?.(),t?.removeEventListener("abort",s)};t?.addEventListener("abort",s),t?.aborted&&s(),e.then(n).catch(o)})}var p=(e,t,r="")=>{};var O={};I(O,{_attr:()=>_,_class:()=>A,_event:()=>M,_text:()=>C});var A={update:(e,t,r)=>t?e.classList.add(r):e.classList.remove(r)};var C={update:(e,t)=>{t!==void 0&&(e.textContent=t!==Object(t)?t:JSON.stringify(t))}};var _={update:(e,t,r)=>{typeof t=="boolean"?t?e.setAttribute(r,""):e.removeAttribute(r):e.setAttribute(r,t)}};var M={create:(e,t)=>{for(let r in t)e.addEventListener(r,t[r])},destroy:(e,t)=>{for(let r in t)e.removeEventListener(r,t[r])}};var S={refs:[],collect:!1,define(e){return e&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var f=class{constructor(t,r,n={},o){this.component=t,this.app=n,this.impress=S,this.proxiesData={},this.context={app:n,container:r,options:t,phase:0,abort:()=>o.abort(),id:()=>(n.id++,n.name+n.id),abortSignal:o.signal,node:{},param:{},method:{},proxy:{},source:t.sources||{},directives:{...O,...n.directives,...t.directives}}}async loaded(t){return await this.component.loaded?.bind(this.context)(t)}async rendered(){return typeof this.component!="object"?p(this.context.container.nodepath,211):await this.component.rendered?.bind(this.context)()}async created(){return await this.component.created?.bind(this.context)()}methods(){if(this.component.methods)for(let[t,r]of Object.entries(this.component.methods)){if(this.context.method.hasOwnProperty(t))return p(this.context.container.nodepath,212,t);this.context.method[t]=r.bind(this.context),this.component.actions?.includes(t)&&(this.context.container.action[t]=(...n)=>{let o=r.bind(this.context)(h(...n));return o instanceof Promise?o.then(s=>h(s)):h(o)})}Object.preventExtensions(this.context.container.action),Object.preventExtensions(this.context.method)}params(){if(this.component.params){for(let t in this.component.params)if(this.context.param.hasOwnProperty(t))return p(this.context.container.nodepath,213,t);Object.assign(this.context.param,this.component.params)}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return p(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}};function l(e,t,r=""){if(!(e&&(e.constructor.name==="Object"||e.constructor.name==="Array")))return e;let n={getPrototypeOf(o){return{target:o,instance:"Proxy"}},get(o,s,i){return t.get?.(o,s,`${r}${s}`),Reflect.get(o,s,i)},set(o,s,i,a){return t.beforeSet(i,`${r}${s}`,w=>{i=w})||!(Reflect.get(o,s,a)!==i||s==="length")||(i=l(i,t,`${r}${s}.`),Reflect.set(o,s,i,a),t.set(o,i,`${r}${s}`)),!0},deleteProperty(o,s){return Reflect.deleteProperty(o,s)},defineProperty(o,s,i){return Reflect.defineProperty(o,s,i)}};e=h(e);for(let o in e)e.hasOwnProperty(o)&&(e[o]=l(e[o],t,`${r}${o}.`));return new Proxy(e,n)}function x(e,t,r){if(!e)return;let n=(o,s)=>{let i=Math.min(o.length,s.length);return o.slice(0,i)===s.slice(0,i)};for(let[o,s]of e)Array.isArray(s)?s.includes(t)&&o(r):n(t,s)&&o(r,t.length>s.length?t.replace(s+".",""):void 0)}var m=(e,t,r="")=>{};var y=class extends f{constructor(t,r,n,o,s){super(t,r,n,o),this.factory=s}async props(){}async mounted(){await this.component.mounted?.bind(this.context)()}actives(t,r){x(t.reactivity?.node,r)}getProxy(){return l(this.proxiesData,{beforeSet:(t,r,n)=>{if(this.component.setters?.[r]){let o=this.component.setters[r].bind(this.context)(t);if(o===void 0)return!0;n(o)}},set:(t,r,n)=>{for(let o in this.context.node)this.actives(this.context.node[o],n,r);this.component.handlers?.[n]?.bind(this.context)(r)},get:(t,r,n)=>{this.impress.collect&&!this.impress.refs.includes(n)&&t.hasOwnProperty(r)&&this.impress.refs.push(n)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),r=this.context.container,n=r.target;for(let o in t){let s=t[o].selector||this.context.app.selector||`.${o}`,i=typeof s=="function"?s(o):s,a=n.querySelector(i)||n.matches(i)&&n,c=r.nodepath+"."+o;if(a){if(a._engaged)return m(c,106,o);if(a._engaged=!0,r.spot&&Object.values(r.spot).includes(a)){m(c,107,o);continue}Object.assign(this.context.node,{[o]:{target:a,nodepath:c,nodename:o,action:{},prop:{},directives:{}}})}else m(c,105)}Object.preventExtensions(this.context.node);for await(let[o,s]of Object.entries(this.context.node))await this.factory(t[o],this.context,s,this.impress,this.app).controller()}}};var v={directives(e){let t=this.nodeElement;if(!e.startsWith("_"))return m(t.nodepath,102,e);let r=this.context.directives[e],n=this.nodeOptions[e],{create:o,update:s,destroy:i}=r;Object.assign(t.directives,{[e]:{create:()=>o?o.bind(r)(t.target,n):{},destroy:()=>i?i.bind(r)(t.target,n):{}}}),o&&t.directives[e].create();let a=(c,w,T)=>{let E=q=>s.bind(r)(t.target,q,w,T);typeof c=="function"?(this.impress.collect=!0,E(c(t.target)),this.reactiveNode(this.impress.define(),()=>E(c(t.target)))):E(c)};if(s)if(typeof n=="object")for(let c in n)a(n[c],c,n);else a(n)}};var j={listeners(e){typeof this.nodeOptions[e]=="function"&&(this.nodeElement.target[e]=t=>{this.nodeOptions[e].bind(this.context)(t)})},general(e){let t=r=>{this.nodeElement.target[e]!==null&&typeof this.nodeElement.target[e]=="object"?r!==null&&typeof r=="object"?Object.assign(this.nodeElement.target[e],r):m(this.nodeElement.nodepath,103,e):this.nodeElement.target[e]=r};if(typeof this.nodeOptions[e]=="function"){let r=()=>t(this.nodeOptions[e].bind(this.context)());this.impress.collect=!0,r(),this.reactiveNode(this.impress.define(),r)}else t(this.nodeOptions[e])},native(e){e.startsWith("on")?this.listeners(e):this.general(e)}};var d=class{constructor(t,r,n,o,s){this.app=s,this.nodeOptions=t,this.context=r,this.impress=o,this.nodeElement=n,this.nodeElement.reactivity={node:new Map}}reactive(t,r,n){return t?.length&&n.set(r,t),this.impress.clear(),t}reactiveNode(t,r){this.reactive(t,r,this.nodeElement.reactivity.node)}controller(){let t=this.nodeElement.nodepath,r=this.nodeElement.target.tagName==="TEMPLATE";this.nodeElement.replaced=r;for(let n in this.nodeOptions){if(r&&!["selector","component"].includes(n))return m(t,108,n);if(n in this.nodeElement.target)this.native(n);else if(n in this.context.directives)this.directives(n);else{if(n==="component")return this.component?.();if(n!=="selector")return m(t,104,n)}}}};function b(e,t){let r=typeof e=="function"?e.bind(t)():e,n=document.createElement("div");return n.innerHTML=r.trim(),n.childNodes}async function P(e,t,r,n,o={}){let s=[async()=>await e.loaded(),async()=>{await e.props(o),e.params(),e.methods(),e.proxies(),await e.created()},async()=>{t(),await e.rendered()},async()=>{await e.nodes(),await e.mounted()}];try{for await(let i of s)await u(i(),e.context.abortSignal),e.context.phase++}catch(i){throw r(),i}return n?.(),e.context.container}function H(...e){return Object.assign(d.prototype,j,v),new d(...e)}async function $({options:e,target:t},r={}){if(!e)return p(name,216);if(!t)return p(name,217);r.id=0,r.name||="_";let n={...e},o=new AbortController,s={target:t,nodepath:r.name,action:{},unmount(){o.abort(),t.innerHTML="",a.component.unmounted?.bind(a.context)(),delete s.unmount}},i=()=>r.aborted?.({phase:a.context.phase,reason:o.signal.reason}),a=new y(n,s,r,o,H);return await P(a,()=>{a.context.container=s,n.template&&t.append(...b(n.template,a.context))},i,r.completed)}window.lesta={mountWidget:$,replicate:h,revocablePromise:u};})();
