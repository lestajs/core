(()=>{var I=Object.defineProperty;var q=(e,t)=>{for(var r in t)I(e,r,{get:t[r],enumerable:!0})};function l(e){return e?typeof e=="object"?JSON.parse(JSON.stringify(e)):e:e??null}function f(e){function t(c){let a=document.createElement("capsule");return a.innerHTML=c,a}function r(c){let a=c.querySelectorAll("script");for(let p of a)p.remove()}function s(c,a){let p=a.replace(/\s+/g,"").toLowerCase();if(["src","href","xlink:href"].includes(c)&&(p.includes("javascript:")||p.includes("data:text/html"))||c.startsWith("on"))return!0}function o(c){let a=c.attributes;for(let{name:p,value:b}of a)s(p,b)&&c.removeAttribute(p)}function n(c){let a=c.children;for(let p of a)o(p),n(p)}let i=t(e);return r(i),n(i),i.childNodes}var h=(e,t,r="")=>{};var O={};q(O,{_attr:()=>R,_class:()=>M,_evalHTML:()=>_,_event:()=>S,_html:()=>$,_text:()=>A});var $={update:(e,t)=>{t!==void 0&&(e.innerHTML="",t&&e.append(...f(t)))}};var _={update:(e,t)=>t!==void 0?e.innerHTML=t:""};var M={update:(e,t,r)=>t?e.classList.add(r):e.classList.remove(r)};var A={update:(e,t)=>{t!==void 0&&(e.textContent=t!==Object(t)?t:JSON.stringify(t))}};var R={update:(e,t,r)=>{typeof t=="boolean"?t?e.setAttribute(r,""):e.removeAttribute(r):e.setAttribute(r,t)}};var S={create:(e,t)=>{for(let r in t)e.addEventListener(r,t[r])},destroy:(e,t)=>{for(let r in t)e.removeEventListener(r,t[r])}};var T={refs:[],collect:!1,define(e){return e&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var x=class{constructor(t,r,s={},o){this.component=t,this.app=s,this.impress=T,this.proxiesData={},this.context={app:s,container:r,options:t,phase:0,abortSignal:o,node:{},param:{},method:{},proxy:{},source:t.sources||{},directives:{...O,...s.directives,...t.directives}}}async loaded(t){return await this.component.loaded?.bind(this.context)(t)}async rendered(){return typeof this.component!="object"?h(this.context.container.nodepath,211):await this.component.rendered?.bind(this.context)()}async created(){return await this.component.created?.bind(this.context)()}methods(){if(this.component.methods){this.component.outwards?.methods?.length&&(this.context.container.method={});for(let[t,r]of Object.entries(this.component.methods)){if(this.context.method.hasOwnProperty(t))return h(this.context.container.nodepath,212,t);this.context.method[t]=r.bind(this.context),this.component.outwards?.methods?.includes(t)&&(this.context.container.method[t]=(...s)=>{let o=r.bind(this.context)(l(...s));return o instanceof Promise?o.then(n=>l(n)):l(o)})}}Object.preventExtensions(this.context.method)}params(){if(this.component.params){this.component.outwards?.params?.length&&(this.context.container.param={});for(let t in this.component.params){if(this.context.param.hasOwnProperty(t))return h(this.context.container.nodepath,213,t);this.component.outwards?.params?.includes(t)&&(this.context.container.param[t]=this.component.params[t])}Object.assign(this.context.param,this.component.params)}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return h(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}};function d(e,t,r=""){if(!(e&&(e.constructor.name==="Object"||e.constructor.name==="Array")))return e;let s={getPrototypeOf(o){return{target:o,instance:"Proxy"}},get(o,n,i){return t.get?.(o,n,`${r}${n}`),Reflect.get(o,n,i)},set(o,n,i,c){return t.beforeSet(i,`${r}${n}`,p=>{i=p})||!(Reflect.get(o,n,c)!==i||n==="length")||(i=d(i,t,`${r}${n}.`),Reflect.set(o,n,i,c),t.set(o,i,`${r}${n}`)),!0},deleteProperty(o,n){return Reflect.deleteProperty(o,n)},defineProperty(o,n,i){return Reflect.defineProperty(o,n,i)}};e=l(e);for(let o in e)e.hasOwnProperty(o)&&(e[o]=d(e[o],t,`${r}${o}.`));return new Proxy(e,s)}function y(e,t,r){if(!e)return;let s=(o,n)=>{let i=Math.min(o.length,n.length);return o.slice(0,i)===n.slice(0,i)};for(let[o,n]of e)Array.isArray(n)?n.includes(t)&&o(r):s(t,n)&&o(r,t.length>n.length?t.replace(n+".",""):void 0)}var u=(e,t,r="")=>{};var w=class extends x{constructor(t,r,s,o,n){super(t,r,s,o),this.factory=n}async props(){}async mounted(){await this.component.mounted?.bind(this.context)()}actives(t,r){y(t.reactivity?.node,r)}getProxy(){return d(this.proxiesData,{beforeSet:(t,r,s)=>{if(this.component.setters?.[r]){let o=this.component.setters[r].bind(this.context)(t);if(o===void 0)return!0;s(o)}},set:(t,r,s)=>{for(let o in this.context.node)this.actives(this.context.node[o],s,r);this.component.handlers?.[s]?.bind(this.context)(r)},get:(t,r,s)=>{this.impress.collect&&!this.impress.refs.includes(s)&&t.hasOwnProperty(r)&&this.impress.refs.push(s)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),r=this.context.container,s=r.target;for(let o in t){let n=t[o].selector||this.context.app.selector||`.${o}`,i=typeof n=="function"?n(o):n,c=s.querySelector(i)||s.matches(i)&&s,a=r.nodepath+"."+o;if(c){if(r.spot&&Object.values(r.spot).includes(c)){u(a,107,o);continue}Object.assign(this.context.node,{[o]:{target:c,nodepath:a,nodename:o,directives:{}}})}else u(a,105)}Object.preventExtensions(this.context.node);for await(let[o,n]of Object.entries(this.context.node))await this.factory(t[o],this.context,n,this.impress,this.app).controller()}}};var v={directives(e){let t=this.nodeElement;if(!e.startsWith("_"))return u(t.nodepath,102,e);let r=this.context.directives[e],s=this.nodeOptions[e],{create:o,update:n,destroy:i}=r;Object.assign(t.directives,{[e]:{create:()=>o?o.bind(r)(t.target,s):{},destroy:()=>i?i.bind(r)(t.target,s):{}}}),o&&t.directives[e].create();let c=(a,p,b)=>{let g=D=>n.bind(r)(t.target,D,p,b);typeof a=="function"?(this.impress.collect=!0,g(a(t.target)),this.reactiveNode(this.impress.define(),()=>g(a(t.target)))):g(a)};if(n)if(typeof s=="object")for(let a in s)c(s[a],a,s);else c(s)}};var j={listeners(e){typeof this.nodeOptions[e]=="function"&&(this.nodeElement.target[e]=t=>this.nodeOptions[e].bind(this.context)(t))},general(e){if(e==="innerHTML")return u(this.nodeElement.nodepath,106);if(typeof this.nodeOptions[e]=="function"){let t=()=>{let r=this.nodeOptions[e].bind(this.context)();this.nodeElement.target[e]!==null&&typeof this.nodeElement.target[e]=="object"?r!==null&&typeof r=="object"?Object.assign(this.nodeElement.target[e],r):u(this.nodeElement.nodepath,103,e):this.nodeElement.target[e]=r};this.impress.collect=!0,t(),this.reactiveNode(this.impress.define(),t)}else this.nodeElement.target[e]=this.nodeOptions[e]},native(e){e.startsWith("on")?this.listeners(e):this.general(e)}};var m=class{constructor(t,r,s,o,n){this.app=n,this.nodeOptions=t,this.context=r,this.impress=o,this.nodeElement=s,this.nodeElement.reactivity={node:new Map}}reactive(t,r,s){return t?.length&&s.set(r,t),this.impress.clear(),t}reactiveNode(t,r){this.reactive(t,r,this.nodeElement.reactivity.node)}async controller(){for(let t in this.nodeOptions){if(this.nodeOptions.prepared&&!["selector","component","prepared"].includes(t))return u(this.nodeElement.nodepath,109,t);t in this.nodeElement.target?this.native(t):t in this.context.directives?this.directives(t):t==="component"?await this.component?.():t==="selector"||t==="prepared"?this.nodeElement.isSpot&&u(this.nodeElement.nodepath,108):u(this.nodeElement.nodepath,104,t)}}};async function P(e,t,r){let s=[async()=>{e.context.props=r,await e.loaded()},async()=>(await e.props(r),e.params(),e.methods(),e.proxies(),delete e.context.props,await e.created()),async()=>(t(),await e.rendered()),async()=>(await e.nodes(),await e.mounted())],o=n=>({container:e.context.container,phase:e.context.phase,data:n});for await(let n of s){let i=await n();if(e.context.phase++,e.context.abortSignal?.aborted||i){r.aborted?.(o(l(i)));return}}return r.completed?.(o(null)),e.context.container}function V(...e){return Object.assign(m.prototype,j,v),new m(...e)}async function L({options:e,target:t,name:r="root",aborted:s,completed:o}){if(!e)return h(r,216);if(!t)return h(r,217);let n={...e},i=new AbortController,c=i.signal,a={target:t,nodepath:r,unmount(){delete p.context.container,t.innerHTML="",i.abort()}},p=new w(n,a,{},c,V);return await P(p,()=>{t.innerHTML=n.template,p.context.container=a},{aborted:s,completed:o})}window.lesta={mountWidget:L};})();
