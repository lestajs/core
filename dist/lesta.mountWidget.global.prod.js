(()=>{var W=Object.defineProperty;var k=(e,t)=>{for(var r in t)W(e,r,{get:t[r],enumerable:!0})};function m(e){return e?typeof e=="object"?JSON.parse(JSON.stringify(e)):e:e??null}async function x(e,t,r){return new Promise((s,o)=>{let n=()=>{o(),r?.(),t.removeEventListener("abort",n)};t.addEventListener("abort",n),t.aborted&&n(),e.then(s).catch(o)})}function l(e){function t(a){let c=document.createElement("capsule");return c.innerHTML=a,c}function r(a){let c=a.querySelectorAll("script");for(let p of c)p.remove()}function s(a,c){let p=c.replace(/\s+/g,"").toLowerCase();if(["src","href","xlink:href"].includes(a)&&(p.includes("javascript:")||p.includes("data:text/html"))||a.startsWith("on"))return!0}function o(a){let c=a.attributes;for(let{name:p,value:g}of c)s(p,g)&&a.removeAttribute(p)}function n(a){let c=a.children;for(let p of c)o(p),n(p)}let i=t(e.trim());return r(i),n(i),i.childNodes}var h=(e,t,r="")=>{};var v={};k(v,{_attr:()=>T,_class:()=>A,_evalHTML:()=>M,_event:()=>H,_html:()=>_,_text:()=>R});var _={update:(e,t)=>{t!==void 0&&(e.innerHTML="",t&&e.append(...l(t)))}};var M={update:(e,t)=>t!==void 0?e.innerHTML=t:""};var A={update:(e,t,r)=>t?e.classList.add(r):e.classList.remove(r)};var R={update:(e,t)=>{t!==void 0&&(e.textContent=t!==Object(t)?t:JSON.stringify(t))}};var T={update:(e,t,r)=>{typeof t=="boolean"?t?e.setAttribute(r,""):e.removeAttribute(r):e.setAttribute(r,t)}};var H={create:(e,t)=>{for(let r in t)e.addEventListener(r,t[r])},destroy:(e,t)=>{for(let r in t)e.removeEventListener(r,t[r])}};var S={refs:[],collect:!1,define(e){return e&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var y=class{constructor(t,r,s={},o){this.component=t,this.app=s,this.impress=S,this.proxiesData={},this.context={app:s,container:r,options:t,phase:0,abort:()=>o.abort(),abortSignal:o.signal,node:{},param:{},method:{},proxy:{},source:t.sources||{},directives:{...v,...s.directives,...t.directives}}}async loaded(t){return await this.component.loaded?.bind(this.context)(t)}async rendered(){return typeof this.component!="object"?h(this.context.container.nodepath,211):await this.component.rendered?.bind(this.context)()}async created(){return await this.component.created?.bind(this.context)()}methods(){if(this.component.methods){this.component.outwards?.methods?.length&&(this.context.container.method={});for(let[t,r]of Object.entries(this.component.methods)){if(this.context.method.hasOwnProperty(t))return h(this.context.container.nodepath,212,t);this.context.method[t]=r.bind(this.context),this.component.outwards?.methods?.includes(t)&&(this.context.container.method[t]=(...s)=>{let o=r.bind(this.context)(m(...s));return o instanceof Promise?o.then(n=>m(n)):m(o)})}}Object.preventExtensions(this.context.method)}params(){if(this.component.params){this.component.outwards?.params?.length&&(this.context.container.param={});for(let t in this.component.params){if(this.context.param.hasOwnProperty(t))return h(this.context.container.nodepath,213,t);this.component.outwards?.params?.includes(t)&&(this.context.container.param[t]=this.component.params[t])}Object.assign(this.context.param,this.component.params)}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return h(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}};function f(e,t,r=""){if(!(e&&(e.constructor.name==="Object"||e.constructor.name==="Array")))return e;let s={getPrototypeOf(o){return{target:o,instance:"Proxy"}},get(o,n,i){return t.get?.(o,n,`${r}${n}`),Reflect.get(o,n,i)},set(o,n,i,a){return t.beforeSet(i,`${r}${n}`,p=>{i=p})||!(Reflect.get(o,n,a)!==i||n==="length")||(i=f(i,t,`${r}${n}.`),Reflect.set(o,n,i,a),t.set(o,i,`${r}${n}`)),!0},deleteProperty(o,n){return Reflect.deleteProperty(o,n)},defineProperty(o,n,i){return Reflect.defineProperty(o,n,i)}};e=m(e);for(let o in e)e.hasOwnProperty(o)&&(e[o]=f(e[o],t,`${r}${o}.`));return new Proxy(e,s)}function b(e,t,r){if(!e)return;let s=(o,n)=>{let i=Math.min(o.length,n.length);return o.slice(0,i)===n.slice(0,i)};for(let[o,n]of e)Array.isArray(n)?n.includes(t)&&o(r):s(t,n)&&o(r,t.length>n.length?t.replace(n+".",""):void 0)}var u=(e,t,r="")=>{};var w=class extends y{constructor(t,r,s,o,n){super(t,r,s,o),this.factory=n}async props(){}async mounted(){await this.component.mounted?.bind(this.context)()}actives(t,r){b(t.reactivity?.node,r)}getProxy(){return f(this.proxiesData,{beforeSet:(t,r,s)=>{if(this.component.setters?.[r]){let o=this.component.setters[r].bind(this.context)(t);if(o===void 0)return!0;s(o)}},set:(t,r,s)=>{for(let o in this.context.node)this.actives(this.context.node[o],s,r);this.component.handlers?.[s]?.bind(this.context)(r)},get:(t,r,s)=>{this.impress.collect&&!this.impress.refs.includes(s)&&t.hasOwnProperty(r)&&this.impress.refs.push(s)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),r=this.context.container,s=r.target;for(let o in t){let n=t[o].selector||this.context.app.selector||`.${o}`,i=typeof n=="function"?n(o):n,a=s.querySelector(i)||s.matches(i)&&s,c=r.nodepath+"."+o;if(a){if(r.spot&&Object.values(r.spot).includes(a)){u(c,107,o);continue}Object.assign(this.context.node,{[o]:{target:a,nodepath:c,nodename:o,directives:{}}})}else u(c,105)}Object.preventExtensions(this.context.node);for await(let[o,n]of Object.entries(this.context.node))await this.factory(t[o],this.context,n,this.impress,this.app).controller()}}};var j={directives(e){let t=this.nodeElement;if(!e.startsWith("_"))return u(t.nodepath,102,e);let r=this.context.directives[e],s=this.nodeOptions[e],{create:o,update:n,destroy:i}=r;Object.assign(t.directives,{[e]:{create:()=>o?o.bind(r)(t.target,s):{},destroy:()=>i?i.bind(r)(t.target,s):{}}}),o&&t.directives[e].create();let a=(c,p,g)=>{let E=q=>n.bind(r)(t.target,q,p,g);typeof c=="function"?(this.impress.collect=!0,E(c(t.target)),this.reactiveNode(this.impress.define(),()=>E(c(t.target)))):E(c)};if(n)if(typeof s=="object")for(let c in s)a(s[c],c,s);else a(s)}};var P={listeners(e){typeof this.nodeOptions[e]=="function"&&(this.nodeElement.target[e]=t=>this.nodeOptions[e].bind(this.context)(t))},general(e){if(e==="innerHTML")return u(this.nodeElement.nodepath,106);let t=r=>{this.nodeElement.target[e]!==null&&typeof this.nodeElement.target[e]=="object"?r!==null&&typeof r=="object"?Object.assign(this.nodeElement.target[e],r):u(this.nodeElement.nodepath,103,e):this.nodeElement.target[e]=r};if(typeof this.nodeOptions[e]=="function"){let r=()=>t(this.nodeOptions[e].bind(this.context)());this.impress.collect=!0,r(),this.reactiveNode(this.impress.define(),r)}else t(this.nodeOptions[e])},native(e){e.startsWith("on")?this.listeners(e):this.general(e)}};var d=class{constructor(t,r,s,o,n){this.app=n,this.nodeOptions=t,this.context=r,this.impress=o,this.nodeElement=s,this.nodeElement.reactivity={node:new Map}}reactive(t,r,s){return t?.length&&s.set(r,t),this.impress.clear(),t}reactiveNode(t,r){this.reactive(t,r,this.nodeElement.reactivity.node)}controller(){let t=this.nodeElement.nodepath;for(let r in this.nodeOptions){if(this.nodeOptions.replaced&&!["selector","component","replaced"].includes(r))return u(t,109,r);if(r in this.nodeElement.target)this.native(r);else if(r in this.context.directives)this.directives(r);else{if(r==="component")return this.component?.();r==="selector"||r==="replaced"?this.nodeElement.spoted&&u(t,108):u(t,104,r)}}}};async function L(e,t,r,s){let o=[async()=>await e.loaded(r),async()=>{await e.props(r),e.params(),e.methods(),e.proxies(),await e.created()},async()=>{t(),await e.rendered()},async()=>{await e.nodes(),await e.mounted()}];try{for await(let n of o)await x(n(),e.context.abortSignal),e.context.phase++}catch{s()}return r.completed?.(),e.context.container}function D(...e){return Object.assign(d.prototype,P,j),new d(...e)}async function C({options:e,target:t,name:r="root"},s){if(!e)return h(r,216);if(!t)return h(r,217);let o={...e},n=new AbortController,i={target:t,nodepath:r,unmount(){n.abort(),t.innerHTML=""}},a=new w(o,i,{},n,D);return await L(a,()=>{t.innerHTML=l(o.template),a.context.container=i},s,()=>s.aborted?.({phase:a.context.phase,reason:n.signal.reason}))}window.lesta={mountWidget:C};})();
