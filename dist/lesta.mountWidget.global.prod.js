(()=>{var W=Object.defineProperty;var I=(e,t)=>{for(var r in t)W(e,r,{get:t[r],enumerable:!0})};function m(e){return e?typeof e=="object"?JSON.parse(JSON.stringify(e)):e:e??null}async function x(e,t,r){return new Promise((n,o)=>{let s=()=>{o(),r?.(),t.removeEventListener("abort",s)};t.addEventListener("abort",s),t.aborted&&s(),e.then(n).catch(o)})}function f(e){function t(c){let a=document.createElement("capsule");return a.innerHTML=c,a}function r(c){let a=c.querySelectorAll("script");for(let p of a)p.remove()}function n(c,a){let p=a.replace(/\s+/g,"").toLowerCase();if(["src","href","xlink:href"].includes(c)&&(p.includes("javascript:")||p.includes("data:text/html"))||c.startsWith("on"))return!0}function o(c){let a=c.attributes;for(let{name:p,value:g}of a)n(p,g)&&c.removeAttribute(p)}function s(c){let a=c.children;for(let p of a)o(p),s(p)}let i=t(e.trim());return r(i),s(i),i.childNodes}var h=(e,t,r="")=>{};var j={};I(j,{_attr:()=>H,_class:()=>A,_evalHTML:()=>T,_event:()=>S,_html:()=>_,_text:()=>R});var _={update:(e,t)=>{t!==void 0&&(e.innerHTML="",t&&e.append(...f(t)))}};var T={update:(e,t)=>t!==void 0?e.innerHTML=t:""};var A={update:(e,t,r)=>t?e.classList.add(r):e.classList.remove(r)};var R={update:(e,t)=>{t!==void 0&&(e.textContent=t!==Object(t)?t:JSON.stringify(t))}};var H={update:(e,t,r)=>{typeof t=="boolean"?t?e.setAttribute(r,""):e.removeAttribute(r):e.setAttribute(r,t)}};var S={create:(e,t)=>{for(let r in t)e.addEventListener(r,t[r])},destroy:(e,t)=>{for(let r in t)e.removeEventListener(r,t[r])}};var V={refs:[],collect:!1,define(e){return e&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var y=class{constructor(t,r,n={},o){this.component=t,this.app=n,this.impress=V,this.proxiesData={},this.context={app:n,container:r,options:t,phase:0,abort:()=>o.abort(),abortSignal:o.signal,node:{},param:{},method:{},proxy:{},source:t.sources||{},directives:{...j,...n.directives,...t.directives}}}async loaded(t){return await this.component.loaded?.bind(this.context)(t)}async rendered(){return typeof this.component!="object"?h(this.context.container.nodepath,211):await this.component.rendered?.bind(this.context)()}async created(){return await this.component.created?.bind(this.context)()}methods(){if(this.component.methods){this.component.outwards?.methods?.length&&(this.context.container.method={});for(let[t,r]of Object.entries(this.component.methods)){if(this.context.method.hasOwnProperty(t))return h(this.context.container.nodepath,212,t);this.context.method[t]=r.bind(this.context),this.component.outwards?.methods?.includes(t)&&(this.context.container.method[t]=(...n)=>{let o=r.bind(this.context)(m(...n));return o instanceof Promise?o.then(s=>m(s)):m(o)})}}Object.preventExtensions(this.context.method)}params(){if(this.component.params){this.component.outwards?.params?.length&&(this.context.container.param={});for(let t in this.component.params){if(this.context.param.hasOwnProperty(t))return h(this.context.container.nodepath,213,t);this.component.outwards?.params?.includes(t)&&(this.context.container.param[t]=this.component.params[t])}Object.assign(this.context.param,this.component.params)}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return h(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}};function d(e,t,r=""){if(!(e&&(e.constructor.name==="Object"||e.constructor.name==="Array")))return e;let n={getPrototypeOf(o){return{target:o,instance:"Proxy"}},get(o,s,i){return t.get?.(o,s,`${r}${s}`),Reflect.get(o,s,i)},set(o,s,i,c){return t.beforeSet(i,`${r}${s}`,p=>{i=p})||!(Reflect.get(o,s,c)!==i||s==="length")||(i=d(i,t,`${r}${s}.`),Reflect.set(o,s,i,c),t.set(o,i,`${r}${s}`)),!0},deleteProperty(o,s){return Reflect.deleteProperty(o,s)},defineProperty(o,s,i){return Reflect.defineProperty(o,s,i)}};e=m(e);for(let o in e)e.hasOwnProperty(o)&&(e[o]=d(e[o],t,`${r}${o}.`));return new Proxy(e,n)}function b(e,t,r){if(!e)return;let n=(o,s)=>{let i=Math.min(o.length,s.length);return o.slice(0,i)===s.slice(0,i)};for(let[o,s]of e)Array.isArray(s)?s.includes(t)&&o(r):n(t,s)&&o(r,t.length>s.length?t.replace(s+".",""):void 0)}var u=(e,t,r="")=>{};var w=class extends y{constructor(t,r,n,o,s){super(t,r,n,o),this.factory=s}async props(){}async mounted(){await this.component.mounted?.bind(this.context)()}actives(t,r){b(t.reactivity?.node,r)}getProxy(){return d(this.proxiesData,{beforeSet:(t,r,n)=>{if(this.component.setters?.[r]){let o=this.component.setters[r].bind(this.context)(t);if(o===void 0)return!0;n(o)}},set:(t,r,n)=>{for(let o in this.context.node)this.actives(this.context.node[o],n,r);this.component.handlers?.[n]?.bind(this.context)(r)},get:(t,r,n)=>{this.impress.collect&&!this.impress.refs.includes(n)&&t.hasOwnProperty(r)&&this.impress.refs.push(n)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),r=this.context.container,n=r.target;for(let o in t){let s=t[o].selector||this.context.app.selector||`.${o}`,i=typeof s=="function"?s(o):s,c=n.querySelector(i)||n.matches(i)&&n,a=r.nodepath+"."+o;if(c){if(r.spot&&Object.values(r.spot).includes(c)){u(a,107,o);continue}Object.assign(this.context.node,{[o]:{target:c,nodepath:a,nodename:o,directives:{}}})}else u(a,105)}Object.preventExtensions(this.context.node);for await(let[o,s]of Object.entries(this.context.node))await this.factory(t[o],this.context,s,this.impress,this.app).controller()}}};var P={directives(e){let t=this.nodeElement;if(!e.startsWith("_"))return u(t.nodepath,102,e);let r=this.context.directives[e],n=this.nodeOptions[e],{create:o,update:s,destroy:i}=r;Object.assign(t.directives,{[e]:{create:()=>o?o.bind(r)(t.target,n):{},destroy:()=>i?i.bind(r)(t.target,n):{}}}),o&&t.directives[e].create();let c=(a,p,g)=>{let O=k=>s.bind(r)(t.target,k,p,g);typeof a=="function"?(this.impress.collect=!0,O(a(t.target)),this.reactiveNode(this.impress.define(),()=>O(a(t.target)))):O(a)};if(s)if(typeof n=="object")for(let a in n)c(n[a],a,n);else c(n)}};var L={listeners(e){typeof this.nodeOptions[e]=="function"&&(this.nodeElement.target[e]=t=>this.nodeOptions[e].bind(this.context)(t))},general(e){if(e==="innerHTML")return u(this.nodeElement.nodepath,106);let t=r=>{this.nodeElement.target[e]!==null&&typeof this.nodeElement.target[e]=="object"?r!==null&&typeof r=="object"?Object.assign(this.nodeElement.target[e],r):u(this.nodeElement.nodepath,103,e):this.nodeElement.target[e]=r};if(typeof this.nodeOptions[e]=="function"){let r=()=>t(this.nodeOptions[e].bind(this.context)());this.impress.collect=!0,r(),this.reactiveNode(this.impress.define(),r)}else t(this.nodeOptions[e])},native(e){e.startsWith("on")?this.listeners(e):this.general(e)}};var l=class{constructor(t,r,n,o,s){this.app=s,this.nodeOptions=t,this.context=r,this.impress=o,this.nodeElement=n,this.nodeElement.reactivity={node:new Map}}reactive(t,r,n){return t?.length&&n.set(r,t),this.impress.clear(),t}reactiveNode(t,r){this.reactive(t,r,this.nodeElement.reactivity.node)}controller(){let t=this.nodeElement.nodepath,r=this.nodeElement.target.tagName==="TEMPLATE";this.nodeElement.replaced=r;for(let n in this.nodeOptions){if(r&&!["selector","component"].includes(n))return u(t,108,n);if(n in this.nodeElement.target)this.native(n);else if(n in this.context.directives)this.directives(n);else{if(n==="component")return this.component?.();u(t,104,n)}}}};function E(e,t){let r=typeof e=="function"?e.bind(t)():e;return f(r)}async function N(e,t,r,n,o){let s=[async()=>await e.loaded(r),async()=>{await e.props(r),e.params(),e.methods(),e.proxies(),await e.created()},async()=>{t(),await e.rendered()},async()=>{await e.nodes(),await e.mounted()}];try{for await(let i of s)await x(i(),e.context.abortSignal),e.context.phase++}catch{n()}return o?.(),e.context.container}function q(...e){return Object.assign(l.prototype,L,P),new l(...e)}async function C({options:e,target:t,name:r="root",completed:n,aborted:o},s={}){if(!e)return h(r,216);if(!t)return h(r,217);let i={...e},c=new AbortController,a={target:t,nodepath:r,unmount(){c.abort(),t.innerHTML=""}},p=new w(i,a,s,c,q);return await N(p,()=>{p.context.container=a,i.template&&t.append(...E(i.template,p.context))},{},()=>o?.({phase:p.context.phase,reason:c.signal.reason}),n)}window.lesta={mountWidget:C};})();
