(()=>{var Et=Object.defineProperty;var tt=(e,t)=>{for(var r in t)Et(e,r,{get:t[r],enumerable:!0})};var Y={};tt(Y,{camelToKebab:()=>K,createApp:()=>ut,createRouter:()=>yt,createStores:()=>ft,debounce:()=>z,deepFreeze:()=>N,delayRace:()=>W,deliver:()=>A,escHtml:()=>k,isObject:()=>$,loadModule:()=>E,mapProps:()=>I,mountWidget:()=>wt,replicate:()=>u,revocablePromise:()=>w,throttle:()=>U});function $(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function N(e){if(e===null||typeof e!="object")return e;let t=new WeakSet;function r(o){if(Object.isFrozen(o)||!(o instanceof Object)||t.has(o))return o;t.add(o),Object.freeze(o);for(let n of Reflect.ownKeys(o)){let s=o[n];s instanceof Object&&r(s)}return o}return r(e)}function u(e){return e?typeof e=="object"?JSON.parse(JSON.stringify(e)):e:e??null}function A(e,t=[],r){let o=Array.isArray(t)?t:t.split("."),n;try{for(n=0;n<o.length-1;n++)e=e[o[n]];return r!==void 0&&(e[o[n]]=r),e[o[n]]}catch{}}function I(e,t){return e.reduce((r,o)=>(r[o]=t,r),{})}function z(e,t=150){let r;return(...o)=>{clearTimeout(r),r=setTimeout(()=>{e(...o)},t)}}function U(e,t=150){let r=null;return function(...n){r===null&&(r=setTimeout(()=>{e.apply(this,n),r=null},t))}}function W(e=0,t){return new Promise((r,o)=>{if(t?.aborted){o(new Error("Aborted"));return}let n=setTimeout(()=>{r(),i()},e),s=()=>{clearTimeout(n),o(new Error("Aborted")),i()},i=()=>t?.removeEventListener("abort",s);t?.addEventListener("abort",s)})}async function w(e,t,r){return new Promise((o,n)=>{let s=()=>{n(),r?.(),t?.removeEventListener("abort",s)};t?.addEventListener("abort",s),t?.aborted&&s(),e.then(o).catch(n)})}async function E(e,t,r){if(typeof e=="function"){let o=e();return o instanceof Promise?{...(await w(o,t,r))?.default}:o}return{...e}}function F(e,t){for(let[r,o]of e)if(Array.isArray(o)){let n=o.indexOf(t);n!==-1&&(o.length===1?e.delete(r):o.splice(n,1))}else o===t&&e.delete(r)}function k(e=""){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/`/g,"&#x60;").replace(/=/g,"&#x3D;")}function K(e=""){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var m=(e,t,r="")=>{};function g(e,t,r=""){if(!(e&&(e.constructor.name==="Object"||e.constructor.name==="Array")))return e;let o={getPrototypeOf(n){return{target:n,instance:"Proxy"}},get(n,s,i){return t.get?.(n,s,`${r}${s}`),Reflect.get(n,s,i)},set(n,s,i,a){return t.beforeSet(i,`${r}${s}`,h=>{i=h})||!(Reflect.get(n,s,a)!==i||s==="length")||(i=g(i,t,`${r}${s}.`),Reflect.set(n,s,i,a),t.set(n,i,`${r}${s}`)),!0},deleteProperty(n,s){return Reflect.deleteProperty(n,s)},defineProperty(n,s,i){return Reflect.defineProperty(n,s,i)}};e=u(e);for(let n in e)e.hasOwnProperty(n)&&(e[n]=g(e[n],t,`${r}${n}.`));return new Proxy(e,o)}function b(e,t,r){if(!e)return;let o=(n,s)=>{let i=Math.min(n.length,s.length);return n.slice(0,i)===s.slice(0,i)};for(let[n,s]of e)Array.isArray(s)?s.includes(t)&&n(r):o(t,s)&&n(r,t.length>s.length?t.replace(s+".",""):void 0)}var x=(e,t,r="")=>{};var et={refs:[],collect:!1,define(e){return e&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var J={};tt(J,{_attr:()=>nt,_class:()=>rt,_event:()=>st,_text:()=>ot});var rt={update:(e,t,r)=>t?e.target.classList.add(r):e.target.classList.remove(r)};var ot={update:(e,t)=>{t!==void 0&&(e.target.textContent=t!==Object(t)?t:JSON.stringify(t))}};var nt={update:(e,t,r)=>{typeof t=="boolean"?t?e.target.setAttribute(r,""):e.target.removeAttribute(r):e.target.setAttribute(r,t)}};var st={create:(e,t)=>{for(let r in t)e.target.addEventListener(r,t[r])},destroy:(e,t)=>{for(let r in t)e.target.removeEventListener(r,t[r])}};var j=class{constructor(t,r,o,n,s){this.factory=s,this.component=t,this.app=o,this.impress=et,this.proxiesData={},this.context={app:o,container:r,options:t,phase:0,abort:()=>n.abort(),appId:()=>(o.id++,"_"+o.id),abortSignal:n.signal,node:{},param:{},method:{},proxy:{},source:t.sources||{},directives:{...J,...o.directives,...t.directives}}}async loaded(t){await this.component.loaded?.bind(this.context)(t)}props(){}refresh(t){this.component.refreshed?.bind(this.context)(t)}async rendered(){if(typeof this.component!="object")return m(this.context.container.nodepath,211);await this.component.rendered?.bind(this.context)()}async mounted(){await this.component.mounted?.bind(this.context)()}async created(){await this.component.created?.bind(this.context)()}unmounted(t){this.component.unmounted?.bind(this.context)(),delete t.unmount}methods(){if(this.component.methods)for(let[t,r]of Object.entries(this.component.methods)){if(this.context.method.hasOwnProperty(t))return m(this.context.container.nodepath,212,t);this.context.method[t]=r.bind(this.context),this.component.actions?.includes(t)&&(this.context.container.action[t]=(...o)=>{let n=r.bind(this.context)(u(...o));return n instanceof Promise?n.then(s=>u(s)):u(n)})}Object.preventExtensions(this.context.container.action),Object.preventExtensions(this.context.method)}params(){if(this.component.params){for(let t in this.component.params)if(this.context.param.hasOwnProperty(t))return m(this.context.container.nodepath,213,t);Object.assign(this.context.param,this.component.params)}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return m(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}actives(t,r){b(t.reactivity?.node,r)}getProxy(){return g(this.proxiesData,{beforeSet:(t,r,o)=>{if(this.component.setters?.[r]){let n=this.component.setters[r].bind(this.context)(t);if(n===void 0)return!0;o(n)}},set:(t,r,o)=>{for(let n in this.context.node)this.actives(this.context.node[n],o,r);this.component.handlers?.[o]?.bind(this.context)(r)},get:(t,r,o)=>{this.impress.collect&&!this.impress.refs.includes(o)&&t.hasOwnProperty(r)&&this.impress.refs.push(o)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(this.context),r=this.context.container,o=r.target;for(let n in t){let s=t[n].selector||this.context.app.selectors||`.${n}`,i=typeof s=="function"?s(n):s,a=o.querySelector(i)||o.matches(i)&&o,c=r.nodepath+"."+n;if(a){if(a._engaged)return x(c,106,n);a._engaged=!0;let h=this.component.styles?.[n];if(typeof h=="string"&&h.trim()&&(a.classList.remove(n),a.classList.add(h)),r.spot&&Object.values(r.spot).includes(a)){x(c,107,n);continue}Object.assign(this.context.node,{[n]:{target:a,nodepath:c,nodename:n,action:{},prop:{},directives:{}}})}else x(c,105)}Object.preventExtensions(this.context.node);for await(let[n,s]of Object.entries(this.context.node))await this.factory(t[n],this.context,s,this.impress,this.app).controller()}}};var l=(e,t,r,o,n="")=>{};var Z=class{constructor(t,r,o){this.props=t,this.context=r,this.container=r.container,this.app=o}async setup(t){if(this.props.proxies&&Object.keys(this.props.proxies).length&&!t?.proxies)return l(this.container.nodepath,306);if(this.context.unrelatedProxy=r=>this.props.proxies[r]?.hasOwnProperty("_independent")?this.props.proxies[r]._independent:!0,t)return await this.params(t.params),await this.methods(t.methods),await this.proxies(t.proxies)}prop(t){return typeof t=="function"?t.bind(this.context)():t}validation(t,r,o,n,s){let i=this.container.nodepath,a=(h,d)=>h&&d&&!(typeof h===d||d==="array"&&Array.isArray(h))&&l(i,s,o,304,d),c=(h,d)=>h&&Array.isArray(d)&&!d.includes(h)&&l(i,s,o,302,h);return t[o]=n??(r.required&&l(i,s,o,303))??r.default??n,typeof r=="string"&&a(t[o],r),Array.isArray(r)&&c(t[o],r),$(r)&&(a(t[o],r.type),c(t[o],r.enum),r.validation&&!r.validation.bind(this.context)(t[o])&&l(i,s,o,308)),t[o]}async proxies(t){if(t){let r={},o=this.context;for(let n in t){let s=this.prop(t[n]),i=s.store;this.container.prop[n]={update:(c,h)=>h?A(o.proxy[n],h,u(c)):this.validation(o.proxy,s,n,u(c),"proxies")};let a=null;if(this.props.proxies?.hasOwnProperty(n))a=this.props.proxies[n]?._value;else if(i){let c=await this.app.store?.init(i);if(!c)return l(this.container.nodepath,"proxies",n,307,i);a=c.proxies(n,this.container)}this.validation(r,s,n,u(a),"proxies")}return r}}async params(t){for(let r in t){let o=this.prop(t[r]),n=o.store,s=async()=>{let i=null;if(n){let a=await this.app.store?.init(n);if(!a)return l(this.container.nodepath,"params",r,307,n);i=a.params(r)}else i=this.props?.params[r];return o?.mutable?i:u(i)};this.validation(this.context.param,o,r,await s(),"params"),o.readonly&&Object.defineProperty(this.context.param,r,{writable:!1})}}async methods(t){let r=(o,n)=>{this.context.method[n]=(...s)=>{if(s.length&&(s.length>1||typeof s.at(0)!="object"))return l(this.container.nodepath,"methods",n,301);let i=o(u(s.at(0)));return i instanceof Promise?i.then(a=>u(a)):u(i)}};for(let o in t){let n=this.prop(t[o]),s=n.store;if(s){let i=await this.app.store?.init(s);if(!i)return l(this.container.nodepath,"methods",o,307,s);let a=i.methods(o);if(!a)return l(this.container.nodepath,"methods",o,305,s);r(a,o)}else{let i=this.props.methods?.hasOwnProperty(o);if((n?.required||n===!0)&&!i)return l(this.container.nodepath,"methods",o,303);i&&r(this.props.methods[o],o)}}}},it={init(e,t,r,o){return new Z(e,r,o).setup(t)}};var M=class extends j{constructor(...t){super(...t)}async props(t){this.proxiesData=await it.init(t,this.component.props,this.context,this.app)||{}}actives(t,r,o){let n=i=>{b(i.reactivity?.node,r),b(i.reactivity?.component,r,o)},s=i=>{for(let a in i.spot)n(i.spot[a]),s(i.spot[a])};n(t),t.children?t.children.forEach(i=>s(i)):s(t)}destroy(t){t.reactivity?.component?.clear(),t.prop={},t.action={};for(let r in t.unstore)t.unstore[r]()}refresh(t){if(this.context.node){for(let r of Object.values(this.context.node))if(r.unmount){for(let o in r.spot)r.spot[o].refresh?.(t);r.refresh(t)}}super.refresh(t)}unmount(t){if(this.context.node)for(let n of Object.values(this.context.node)){if(n.directives)for(let s of Object.values(n.directives))s.destroy?.();if(n.reactivity?.node?.clear(),!!n.unmount){for(let s in n.spot)n.spot[s].unmount?.();n.unmount()}}let{spotname:r,parent:o}=t;r&&o.refresh({cause:"spotUnmounted",data:{spotname:r}}),super.unmounted(t)}};function B(e){if(!e.mixins?.length)return e;let t=["styles","directives","params","proxies","methods","handlers","setters","sources"],r=["params","proxies","methods"],o=["loaded","rendered","created","mounted","unmounted","refreshed"],n={props:{},actions:[],spots:[]},s=[],i={},a=(p,f,v)=>({...p[v],...f[v]}),c=(p,f)=>[...p,...f||[]],h=(p={},f={})=>{for(let v in f)p[v]={...p[v]||{},...f[v]};return p},d=p=>{n.template=p.template||n.template,n.actions=c(n.actions,p.actions),n.spots=c(n.spots,p.spots),t.forEach(f=>{n[f]=a(n,p,f)}),o.forEach(f=>{p[f]&&(n[f]=p[f])}),r.forEach(f=>{n.props[f]=a(n.props,p.props||{},f)}),p.nodes&&s.push(p.nodes)};return n.nodes=function(){return s.forEach(p=>{h(i,p.bind(this)())}),i},e.mixins.forEach(p=>{d(B(p))}),d(e),n}var T={directives(e){let t=this.nodeElement;if(!e.startsWith("_"))return x(t.nodepath,102,e);let r=this.context.directives[e],o=this.nodeOptions[e],{create:n,update:s,destroy:i}=r;Object.assign(t.directives,{[e]:{create:()=>n?n.bind(r)(t,o):{},destroy:()=>i?i.bind(r)(t,o):{}}}),n&&t.directives[e].create();let a=(c,h,d)=>{let p=f=>s.bind(r)(t,f,h,d);typeof c=="function"?(this.impress.collect=!0,p(c(t,d)),this.reactiveNode(this.impress.define(),()=>p(c(t,d)))):p(c)};if(s)if(typeof o=="object")for(let c in o)a(o[c],c,o);else a(o)}};var S={listeners(e){typeof this.nodeOptions[e]=="function"&&(this.nodeElement.target[e]=t=>{this.nodeOptions[e].bind(this.context)(t)})},general(e){let t=r=>{this.nodeElement.target[e]!==null&&typeof this.nodeElement.target[e]=="object"?r!==null&&typeof r=="object"?Object.assign(this.nodeElement.target[e],r):x(this.nodeElement.nodepath,103,e):this.nodeElement.target[e]=r};if(typeof this.nodeOptions[e]=="function"){let r=()=>t(this.nodeOptions[e].bind(this.context)());this.impress.collect=!0,r(),this.reactiveNode(this.impress.define(),r)}else t(this.nodeOptions[e])},native(e){e.startsWith("on")?this.listeners(e):this.general(e)}};var at={async iterative(e){if(typeof e.iterate!="function")return m(this.nodeElement.nodepath,205);if(this.nodeElement.replaced)return m(this.nodeElement.nodepath,204);if(this.name=null,this.repeat=0,this.nodeElement.children=[],this.nodeOptions.component=e,this.nodeElement.clear=()=>this.length.bind(this)(0),this.createIterate=async t=>{this.nodeElement.children[t]=this.nodeElement._current={parent:this.nodeElement,target:!0,nodepath:this.nodeElement.nodepath+"."+t,index:t,action:{},prop:{},iterated:!0},await this.create(this.proxiesIterate.bind(this),this.nodeElement._current,e)},this.impress.collect=!0,this.data=e.iterate(),this.data){if(!Array.isArray(this.data))return m(this.nodeElement.nodepath,205);this.name=this.impress.refs.at(-1),this.impress.clear(),Object.getPrototypeOf(this.data).instance==="Proxy"&&(this.reactiveComponent([this.name],o=>this.length(o.length)),this.reactiveComponent([this.name+".length"],o=>this.length(o)));let t=async()=>{this.data=e.iterate(),await this.length(this.data.length)};this.induced(async o=>o?await t():this.nodeElement.clear())&&await t()}},proxiesIterate(e){let t=this.nodeElement._current,r=(o,n)=>{this.impress.refs.some(s=>s.includes(this.name))?this.reactiveComponent(this.impress.define(o),(s,i)=>{let a=(...c)=>t.prop[o]?.update(...c);i?a(s,i):a(n(t))}):this.nodeElement.created?this.impress.clear():this.reactiveComponent(this.impress.define(o),(s,i)=>{let a=this.nodeElement.children,c=h=>{let d=a[h],p=(...f)=>d.prop[o]?.update(...f);i?p(s,i):p(n(d))};this.portions(a.length,0,c),this.repeat++})};return this.reactivate(e,r,t)},async portions(e,t,r){if(!e)return;let{portion:o}=this.nodeOptions.component,n=null,s=!1;if(t<e-o){let i=()=>{if(this.repeat>1)return this.repeat--;this.portions(e,t,r)};setTimeout(()=>s?i():new Promise(a=>n=a).then(a=>i()))}do if(await r(t),t++,n&&(o=1),t>=e){this.repeat=0;break}while(t%o!==0);s=!0,n?.()},async length(e){this.repeat++;let t=this.nodeElement.children.length;if(e>t&&await this.portions(e,t,async r=>await this.createIterate(r)),e<t)for(;e<t;){t--;let r=this.nodeElement.children;F(this.nodeElement.reactivity.component,this.name+"."+t),r[t].unmount?.(),r[t].target.remove?.(),r.splice(t,1)}}};var ct={async basic(e){this.nodeOptions.component=e;let t=()=>this.create(this.proxies.bind(this),this.nodeElement,e);this.induced(async o=>o?await t():this.nodeElement.unmount?.())&&await t()},proxies(e){if(!e)return;let t=(r,o)=>this.reactiveComponent(this.impress.define(r),(n,s)=>{let i=(...a)=>this.nodeElement.prop[r]?.update(...a);s?i(n,s):i(o(this.nodeElement))});return this.reactivate(e,t)}};var pt={collect(e,t){return{params:this.params(e.params,t),methods:this.methods(e.methods)}},methods(e){let t={};if(e)for(let[r,o]of Object.entries(e))typeof o=="function"&&Object.assign(t,{[r]:o});return t},params(e,t){let r={};if(e)for(let[o,n]of Object.entries(e))Object.assign(r,{[o]:typeof n=="function"&&n.name?n(t):n});return r}};var ht={async component(){if(this.nodeElement.reactivity.component=new Map,this.nodeElement.iterated)return m(this.nodeElement.nodepath,208);this.nodeElement.mount=t=>{if(!Object.keys(t).length)return;this.nodeElement.unmount?.(),this.nodeElement.created=!1;let{spotname:r,parent:o}=this.nodeElement;return r&&o.refresh({cause:"spotMounted",data:{spotname:r}}),t.iterate?this.iterative(t):this.basic(t)};let e=()=>this.nodeElement.mount(this.nodeOptions.component);this.nodeOptions.component.async?e():await e()},induced(e){if(this.nodeOptions.component.hasOwnProperty("induced")){this.nodeElement.induced=e;let t=this.nodeOptions.component.induced;if(!t)return;if(typeof t=="function"){this.impress.collect=!0;let r=t();if(this.reactiveNode(this.impress.define(),async()=>await this.nodeElement.induced(t())),!r)return}}return!0},reactiveComponent(e,t){return this.reactive(e,t,this.nodeElement.reactivity.component)},reactivate(e,t){let r={};if(e)for(let[o,n]of Object.entries(e))if(typeof n=="function"&&n.name){this.impress.collect=!0;let s=a=>n(a),i=n(this.nodeElement._current||this.nodeElement);Object.assign(r,{[o]:{_value:i,_independent:!t(o,s)}})}else Object.assign(r,{[o]:{_value:n,_independent:!0}});return r},async create(e,t,r){let{src:o,spots:n,aborted:s,completed:i}=r;if(o&&(await q(o,t,{aborted:s,completed:i,...pt.collect(r,t),proxies:e(r.proxies)||{}},this.app),this.nodeElement.created=!0,!!n))for await(let[a,c]of Object.entries(n)){if(!t.spot?.hasOwnProperty(a)){m(t.nodepath,202,a);continue}let h=t.spot[a];Object.assign(h,{parent:t,nodepath:t.nodepath+"."+a,nodename:a,spotname:a,action:{},prop:{}}),await H(c,this.context,h,this.impress,this.app).controller()}}};var y=class{constructor(t,r,o,n,s){this.app=s,this.nodeOptions=t,this.context=r,this.impress=n,this.nodeElement=o,this.nodeElement.reactivity={node:new Map}}reactive(t,r,o){return t?.length&&o.set(r,t),this.impress.clear(),t}reactiveNode(t,r){this.reactive(t,r,this.nodeElement.reactivity.node)}controller(){let t=this.nodeElement.nodepath,r=this.nodeElement.target.tagName==="TEMPLATE";this.nodeElement.replaced=r;for(let o in this.nodeOptions){if(r&&!["selector","component"].includes(o))return x(t,108,o);if(o in this.nodeElement.target)this.native(o);else if(o in this.context.directives)this.directives(o);else{if(o==="component")return this.component?.();if(o!=="selector")return x(t,104,o)}}}};function H(...e){return Object.assign(y.prototype,S,T,at,ct,ht),new y(...e)}function P(e,t){let r=typeof e=="function"?e.bind(t)():e,o=document.createElement("div");return o.innerHTML=r.trim().replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gi,""),o.childNodes}function G(e,t){let r={...t.context.options},o=r.template,n=i=>{let a=P(i,t.context);return a.length>1?m(e.nodepath,210):a},s=i=>{r.spots?.length&&(i.spot={}),r.spots?.forEach(a=>Object.assign(i.spot,{[a]:{target:i.target.querySelector(`[spot="${a}"]`)}}))};if(e.iterated){let i=e.parent;if(o){let a=n(o);i.target.append(...a)}e.target=i.target.children[e.index],s(e),i.unmount||(i.unmount=()=>{t.destroy(i),i.clear()}),e.unmount=()=>{t.destroy(e),t.unmount(e),t.context.abort()}}else{if(e.replaced){let i=n(o),a=e.target;e.target.before(...i),e.target=a.previousSibling,a.remove()}else{if(!o)return;let i=P(r.template,t.context);e.target.append(...i)}s(e),e.unmount=()=>{t.destroy(e),t.unmount(e),e.target.innerHTML="",t.context.abort()}}}async function D(e,t,r,o,n={}){let s=e.context;s.container.refresh=({cause:a,data:c={}})=>e.refresh(u({cause:a,data:c}));let i=[async()=>await e.loaded(),async()=>{await e.props(n),e.params(),e.methods(),e.proxies(),await e.created()},async()=>{t(),await e.rendered()},async()=>{await e.nodes(),await e.mounted()}];try{for await(let a of i)await w(a(),s.abortSignal),s.phase++}catch(a){throw r(),a}return o?.(),s.container}async function q(e,t,r={},o={}){let n=new AbortController;t.unmount=()=>n.abort();let s=()=>r.aborted?.({phase:a?a.context.phase:0,reason:n.signal.reason}),i=await E(e,n.signal,s);if(!i)return m(t.nodepath,216);let a=new M(B(i),t,o,n,H);return await D(a,()=>G(t,a),s,r.completed,r)}function ut(e={}){return e.id=0,e.name||="_",e.mount=async(t,r,o)=>await q(t,{target:r,nodepath:e.name,action:{},prop:{}},o,e),Object.assign(e,{router:{},store:{}}),Object.preventExtensions(e),e}var R=(e,t,r="")=>{};var Q=class{constructor(t,r,o){this.store=t,this.context={name:o,app:r,options:t,reactivity:new Map,param:{},method:{}}}async loaded(){this.store.loaded&&await this.store.loaded.bind(this.context)()}create(){this.context.param=this.store.params,Object.preventExtensions(this.context.param);for(let t in this.store.methods)this.context.method[t]=(...r)=>{if(r.length&&(r.length>1||typeof r.at(0)!="object"))return R(this.context.name,403,t);let o=r.at(0);return this.store.middlewares?.hasOwnProperty(t)?(async()=>{let n=await this.store.middlewares[t].bind(this.context)(o);return n&&typeof n!="object"?R(this.context.name,404,t):(o&&n&&Object.assign(o,n),this.store.methods[t].bind(this.context)(o))})():this.store.methods[t].bind(this.context)(o)};this.context.proxy=g(this.store.proxies,{beforeSet:(t,r,o)=>{if(this.store.setters?.[r]){let n=this.store.setters[r].bind(this.context)(t);if(n===void 0)return!0;o(n)}},set:async(t,r,o)=>{b(this.context.reactivity,o,r)}}),Object.preventExtensions(this.context.proxy)}async created(){this.store.created&&await this.store.created.bind(this.context)()}params(t){return this.context.param[t]}proxies(t,r){let o=(n,s)=>r.prop[t].update(n,s);return this.context.reactivity.set(o,t),r.unstore||(r.unstore={}),r.unstore[t]=()=>{this.context.reactivity.delete(o)},this.context.proxy[t]}methods(t){return this.context.method[t]}};function ft(e,t){if(!t)return R(null,401);let r={};return e.store={init:async o=>{if(!r.hasOwnProperty(o)){let n=await E(t[o]);if(!n)return R(o,402);let s=new Q(n,e,o);r[o]=s,await s.loaded(),s.create(),await s.created()}return r[o]},destroy:o=>delete r[o]},e.store}var L=(e="",t,r="")=>{},O=(e,t="")=>{};var mt={init(e,t){return this.url=t,this.result={path:null,map:null,to:null},this.routeEach(e)},picker(e){if(e){let t={},r=this.result.path.match(/:\w+/g);r&&r.forEach((n,s)=>{t[n.substring(1)]=this.result.map[s+1]});let o={path:this.result.map.at(0)||"/",params:Object.keys(t).length?t:void 0,fullPath:this.url.href,hash:this.url.hash,query:this.url.search?Object.fromEntries(new URLSearchParams(this.url.search)):void 0,name:e.name,extra:e.extra,route:{}};e.path.slice(-1)==="*"&&(o.pathMatch=this.result.map.at(-1));for(let n in e)e[n]&&(o.route[n]=e[n]);return o.route.path=this.result.path,o}},mapping(e){let t=e.replace(/:\w+/g,"(\\w+)").replace(/\*$/,"(.*)"),r=new RegExp(`^${t}$`);return(decodeURI(this.url.pathname).toString().replace(/\/$/,"")||"/").match(r)},find(e,t){this.result.path=t,this.result.map=this.mapping(this.result.path);let r=1;for(let o in e.route.params){let n=!1,s=e.route.params[o];if(!this.result.map&&s.optional){let i=this.result.path.replace("/:"+o,"").replace(/\/$/,"");this.result.map=this.mapping(i),n=!0}if(this.result.map&&s.regex){let i=this.result.map[r];s.regex.test(i)||n||(this.result.map=null)}if(this.result.map&&s.enum){let i=this.result.map[r];s.enum.includes(i)||n||(this.result.map=null)}n||r++}},routeEach(e){let t={};for(let r of e)r.path||L(r.name,501),this.find(r,r.path),this.result.map&&(this.result.to=this.picker(r.route),t={...this.result});return!this.result.map&&t&&(this.result=t),this.result.to}};function dt(e,t,r){return e&&e[r]?(t.regex&&!t.regex.test(e[r])&&O(555,r),e[r]):(t.optional||O(554,r),"")}function V(e){return/[<>\/&"'=]/.test(e)?encodeURIComponent(e):e}function X(e,t,r){let o="";if(!e)return"/";if(typeof e=="object")if(e=u(e),e.query&&(e.query=u(e.query)),e.path&&e.path.startsWith("/"))o=e.path;else if(e.name){let n=r.findIndex(s=>s.name===e.name);if(n!==-1){o=r[n].path;let s=r[n].route.params;for(let i in e.params)s[i]||O(553,i);for(let[i,a]of Object.entries(s)){let c=dt(e.params,a,i);o=o.replace("/:"+i,V(c))}o.slice(-1)==="*"&&(o=o.replace(/\*$/,e.pathMatch||"")),e.query&&(o+="?"+new URLSearchParams(e.query).toString())}else O(551,e.name)}else{let n=new URL(t.fullPath);if(e.params){Object.keys(t.params).length||O(552),o=t.route.path;for(let s in t.params){let i=e.params[s]||t.params[s];if(i){let a=dt(e.params,i,s);o=o.replace("/:"+s,V(a))}else O(553,s)}o.slice(-1)==="*"&&(o=o.replace(/\*$/,e.pathMatch||t.pathMatch))}else o=n.pathname;if(e.query){for(let s in e.query)e.query[s]===""?n.searchParams.delete(s):n.searchParams.set(V(s),V(e.query[s]));o+=n.search}e.hash&&(typeof e.hash=="string"&&(n.hash=e.hash),o+=n.hash)}else if(typeof e=="string"&&e.startsWith("/"))o=e;else{let n=new URL(e,t.fullPath);return n.pathname+n.search+n.hash}return o=o.replace(/\/$/,"").replace(/^([^/])/,"/$1"),o||"/"}function lt(e,t,r={path:""}){e.forEach(o=>{if(!o.hasOwnProperty("path"))return L(o.name,557);o.params={...r.params,...o.params},o.extra={...r.extra,...N(o.extra)},o.beforeEnter=o.beforeEnter||r.beforeEnter,o.afterEnter=o.afterEnter||r.afterEnter;let n=(s="")=>{o.children?lt(o.children,t,{path:s,params:o.params,extra:o.extra,beforeEnter:o.beforeEnter,afterEnter:o.afterEnter}):t.push({name:o.name,path:s.replace(/\/$/,"")||"/",route:o})};if(n(r.path+"/"+o.path.replace(/^\/|\/$/g,"")),o.alias){let s=i=>i.charAt(0)==="/"?i:r.path+"/"+i;if(Array.isArray(o.alias))for(let i of o.alias)n(s(i));else n(s(o.alias))}})}var xt=lt;var C=class{constructor(t,r){this.app=t,this.app.router={layouts:r.layouts||{},collection:[],push:this.push.bind(this),link:this.link.bind(this),from:null,to:null},this.routes=r.routes,this.afterEach=r.afterEach,this.beforeEach=r.beforeEach,this.beforeEnter=r.beforeEnter,this.afterEnter=r.afterEnter,this.form=null,xt(this.routes,this.app.router.collection)}link(t){return X(t,this.app.router.to,this.app.router.collection)}async push(t){let r=t.path||t;if(typeof r=="string"&&r!=="")try{if(new URL(r).hostname!==location.hostname)return window.open(r,t.target||"_self",t.windowFeatures)}catch{}let o=this.link(t);if(typeof o!="string")return o;let n=new URL(location.origin+o);return history[t.state?.replaced?"replaceState":"pushState"](null,null,n.href),await this.update(n,!0,t.state)}async beforeHooks(t){if(t){let r=await t(this.app.router.to,this.app.router.from,this.app);if(r)return r!==!0&&this.push(r),!0}}async afterHooks(t){t&&await t(this.app.router.to,this.app.router.from,this.app)}async update(t,r=!1,o={}){let n=null;if(await this.beforeHooks(this.beforeEach))return;let s=mt.init(this.app.router.collection,t),i=s?.route;if(i){if(s.pushed=r,s.state=u(o),this.app.router.from=this.form,this.app.router.to=s,await this.beforeHooks(this.beforeEnter)||await this.beforeHooks(i.beforeEnter))return;if(i.redirect){let a=i.redirect;typeof a=="function"?await this.push(await a(s,this.app.router.from)):await this.push(a);return}if(n=await this.render(this.app.router.to),!n)return;this.form=this.app.router.to,await this.afterHooks(this.afterEnter),await this.afterHooks(i.afterEnter)}return await this.afterHooks(this.afterEach),n}};var _=class extends C{constructor(...t){super(...t),this.currentLayout=null,this.current=null,this.container=null,this.rootContainer=null}async init(t){this.rootContainer=t,window.addEventListener("popstate",()=>this.update.bind(this)(window.location)),this.rootContainer.addEventListener("click",r=>{let o=r.target.closest("[link]");o&&(r.preventDefault(),this.push(o.getAttribute("href")))}),await this.update(window.location)}async render(t){let r=t.route,o=this.app.router.from;if(this.current&&o?.route.component!==r.component&&(this.current?.unmount?.(),this.current=null),this.currentLayout&&o?.route.layout!==r.layout&&(this.currentLayout.unmount(),this.currentLayout=null),r.layout)if(t.state.reloaded||o?.route.layout!==r.layout){if(this.currentLayout=await this.app.mount(this.app.router.layouts[r.layout],this.rootContainer),!this.currentLayout)return;if(this.container=this.rootContainer.querySelector("[router]"),!this.container){L(null,503);return}}else this.currentLayout?.refresh?.({cause:"routerPushed"});else this.container=this.rootContainer;if(this.rootContainer.setAttribute("layout",r.layout||""),document.title=r.title||"Lesta",this.rootContainer.setAttribute("page",r.name||""),t.state.reloaded||o?.route.component!==r.component){if(window.scrollTo(0,0),this.current=await this.app.mount(r.component,this.container),this.currentLayout?.refresh?.({cause:"pageChanged"}),!this.current)return}else this.current?.refresh?.({cause:"routerPushed"});let n=window[t.hash?.slice(1)];return window.scrollTo({top:(n?.offsetTop||0)+(t.state?.top||0),left:(n?.offsetLeft||0)+(t.state?.left||0),behavior:t.state?.behavior||"auto"}),t}};function yt(e,t){return new _(e,t)}function bt(...e){return Object.assign(y.prototype,S,T),new y(...e)}async function wt(e,t,r={},o="_"){if(r.id||=0,!e)return m(o,216);if(!t)return m(o,217);let n={...e},s=new AbortController,i={target:t,nodepath:o,action:{},unmount(){s.abort(),t.innerHTML="",c.unmounted(i)}},a=()=>r.aborted?.({phase:c.context.phase,reason:s.signal.reason}),c=new j(n,i,r,s,bt);return await D(c,()=>{c.context.container=i,n.template&&t.append(...P(n.template,c.context))},a,r.completed)}window.lesta=Y;})();
