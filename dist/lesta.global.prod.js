(()=>{var Ot=Object.defineProperty;var rt=(r,t)=>{for(var e in t)Ot(r,e,{get:t[e],enumerable:!0})};var et={};rt(et,{createApp:()=>mt,createRouter:()=>wt,createStores:()=>ft,debounce:()=>W,deepFreeze:()=>M,delay:()=>z,deleteReactive:()=>C,deliver:()=>L,escHtml:()=>G,isObject:()=>$,loadModule:()=>g,mapProps:()=>I,mountWidget:()=>Et,nextFrame:()=>B,replicate:()=>l,revocablePromise:()=>w,throttling:()=>k,uid:()=>J});function $(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function l(r){return r?typeof r=="object"?JSON.parse(JSON.stringify(r)):r:r??null}function L(r,t=[],e){let o=Array.isArray(t)?t:t.split("."),n;try{for(n=0;n<o.length-1;n++)r=r[o[n]];return e!==void 0&&(r[o[n]]=e),r[o[n]]}catch{}}function I(r,t){let e={};return r.forEach(o=>Object.assign(e,{[o]:t})),e}function W(r,t=120){return function(...o){let n=this.lastCall;this.lastCall=Date.now(),n&&this.lastCall-n<=t&&clearTimeout(this.lastCallTimer),this.lastCallTimer=setTimeout(()=>r(...o),t)}}function k(r,t=50){let e;return function(...n){e||(e=setTimeout(()=>{r(...n),clearTimeout(e),e=null},t))}}function z(r=0){let t,e,o=new Promise((n,s)=>{e=()=>{clearTimeout(t),s(),o._pending=!1,o.rejected=!0},t=setTimeout(()=>{clearTimeout(t),n(),o._pending=!1,o._fulfilled=!0},r)});return o._reject=e,o._pending=!0,o._rejected=!1,o._fulfilled=!1,o}async function w(r,t,e){return new Promise((o,n)=>{let s=()=>{n(),e?.(),t.removeEventListener("abort",s)};t.addEventListener("abort",s),t.aborted&&s(),r.then(o).catch(n)})}async function g(r,t,e){if(typeof r=="function"){let o=r();return o instanceof Promise?{...(await w(o,t,e))?.default}:o}return{...r}}function C(r,t){for(let[e,o]of r)if(Array.isArray(o)){let n=o.indexOf(t);n!==-1&&(o.length===1?r.delete(e):o.splice(n,1))}else o===t&&r.delete(e)}function J(){let r=new Uint32Array(4);window.crypto.getRandomValues(r);let t=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{t++;let o=r[t>>3]>>t%8*4&15;return(e==="x"?o:o&3|8).toString(16)})}function M(r){return Object.freeze(r),Object.getOwnPropertyNames(r).forEach(t=>{let e=r[t];e!==null&&(typeof e=="object"||typeof e=="function")&&!Object.isFrozen(e)&&M(e)}),r}async function B(){return new Promise(requestAnimationFrame)}function G(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/`/g,"&#x60;").replace(/=/g,"&#x3D;")}var u=(r,t,e="")=>{};var K={};rt(K,{_attr:()=>st,_class:()=>ot,_event:()=>it,_text:()=>nt});var ot={update:(r,t,e)=>t?r.classList.add(e):r.classList.remove(e)};var nt={update:(r,t)=>{t!==void 0&&(r.textContent=t!==Object(t)?t:JSON.stringify(t))}};var st={update:(r,t,e)=>{typeof t=="boolean"?t?r.setAttribute(e,""):r.removeAttribute(e):r.setAttribute(e,t)}};var it={create:(r,t)=>{for(let e in t)r.addEventListener(e,t[e])},destroy:(r,t)=>{for(let e in t)r.removeEventListener(e,t[e])}};var at={refs:[],collect:!1,define(r){return r&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var _=class{constructor(t,e,o={},n){this.component=t,this.app=o,this.impress=at,this.proxiesData={},this.context={app:o,container:e,options:t,phase:0,abort:()=>n.abort(),abortSignal:n.signal,node:{},param:{},method:{},proxy:{},source:t.sources||{},directives:{...K,...o.directives,...t.directives}}}async loaded(t){return await this.component.loaded?.bind(this.context)(t)}async rendered(){return typeof this.component!="object"?u(this.context.container.nodepath,211):await this.component.rendered?.bind(this.context)()}async created(){return await this.component.created?.bind(this.context)()}methods(){if(this.component.methods)for(let[t,e]of Object.entries(this.component.methods)){if(this.context.method.hasOwnProperty(t))return u(this.context.container.nodepath,212,t);this.context.method[t]=e.bind(this.context),this.component.actions?.includes(t)&&(this.context.container.action[t]=(...o)=>{let n=e.bind(this.context)(l(...o));return n instanceof Promise?n.then(s=>l(s)):l(n)})}Object.preventExtensions(this.context.container.action),Object.preventExtensions(this.context.method)}params(){if(this.component.params){for(let t in this.component.params)if(this.context.param.hasOwnProperty(t))return u(this.context.container.nodepath,213,t);Object.assign(this.context.param,this.component.params)}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return u(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}};function E(r,t,e=""){if(!(r&&(r.constructor.name==="Object"||r.constructor.name==="Array")))return r;let o={getPrototypeOf(n){return{target:n,instance:"Proxy"}},get(n,s,i){return t.get?.(n,s,`${e}${s}`),Reflect.get(n,s,i)},set(n,s,i,a){return t.beforeSet(i,`${e}${s}`,m=>{i=m})||!(Reflect.get(n,s,a)!==i||s==="length")||(i=E(i,t,`${e}${s}.`),Reflect.set(n,s,i,a),t.set(n,i,`${e}${s}`)),!0},deleteProperty(n,s){return Reflect.deleteProperty(n,s)},defineProperty(n,s,i){return Reflect.defineProperty(n,s,i)}};r=l(r);for(let n in r)r.hasOwnProperty(n)&&(r[n]=E(r[n],t,`${e}${n}.`));return new Proxy(r,o)}function b(r,t,e){if(!r)return;let o=(n,s)=>{let i=Math.min(n.length,s.length);return n.slice(0,i)===s.slice(0,i)};for(let[n,s]of r)Array.isArray(s)?s.includes(t)&&n(e):o(t,s)&&n(e,t.length>s.length?t.replace(s+".",""):void 0)}var d=(r,t,e="")=>{};var j=class extends _{constructor(t,e,o,n,s){super(t,e,o,n),this.factory=s}async props(){}async mounted(){await this.component.mounted?.bind(this.context)()}actives(t,e){b(t.reactivity?.node,e)}getProxy(){return E(this.proxiesData,{beforeSet:(t,e,o)=>{if(this.component.setters?.[e]){let n=this.component.setters[e].bind(this.context)(t);if(n===void 0)return!0;o(n)}},set:(t,e,o)=>{for(let n in this.context.node)this.actives(this.context.node[n],o,e);this.component.handlers?.[o]?.bind(this.context)(e)},get:(t,e,o)=>{this.impress.collect&&!this.impress.refs.includes(o)&&t.hasOwnProperty(e)&&this.impress.refs.push(o)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),e=this.context.container,o=e.target;for(let n in t){let s=t[n].selector||this.context.app.selector||`.${n}`,i=typeof s=="function"?s(n):s,a=o.querySelector(i)||o.matches(i)&&o,p=e.nodepath+"."+n;if(a){if(a._engaged)return d(p,106,n);if(a._engaged=!0,e.spot&&Object.values(e.spot).includes(a)){d(p,107,n);continue}Object.assign(this.context.node,{[n]:{target:a,nodepath:p,nodename:n,action:{},prop:{},directives:{}}})}else d(p,105)}Object.preventExtensions(this.context.node);for await(let[n,s]of Object.entries(this.context.node))await this.factory(t[n],this.context,s,this.impress,this.app).controller()}}};var f=(r,t,e,o,n="")=>{};var Q=class{constructor(t,e,o){this.props=t,this.context=e,this.container=e.container,this.app=o}async setup(t){if(this.props.proxies&&Object.keys(this.props.proxies).length&&!t?.proxies)return f(this.container.nodepath,306);if(this.context.unrelatedProxy=e=>this.props.proxies[e]?.hasOwnProperty("_independent")?this.props.proxies[e]._independent:!0,t)return await this.params(t.params),await this.methods(t.methods),await this.proxies(t.proxies)}store(t){return typeof t=="function"?t.bind(this)():t}validation(t,e,o,n,s){let i=this.container.nodepath,a=(c,h)=>c&&h&&!(typeof c===h||h==="array"&&Array.isArray(c))&&f(i,s,o,304,h),p=(c,h)=>c&&Array.isArray(h)&&!h.includes(c)&&f(i,s,o,302,c),m=(c,h)=>c??(h.required&&f(i,s,o,303))??h.default??c,x=(c,h)=>(c=m(c,h),a(c,h.type),p(c,h.enum),c);if(typeof e=="string"&&a(n,e),Array.isArray(e)&&p(n,e),$(e)){t[o]=x(n,e);let c=e.validation?.bind(this.context)(t[o]);c&&f(i,s,o,308,c)}return t[o]}async proxies(t){if(t){let e={},o=this.context;for(let n in t){let s=t[n];this.container.prop[n]={update:(a,p)=>p?L(o.proxy[n],p,l(a)):this.validation(o.proxy,s,n,l(a),"proxies")};let i=null;if(this.props.proxies?.hasOwnProperty(n))i=this.props.proxies[n]?._value;else if(s.store){let a=this.store(s.store),p=await this.app.store?.init(a);if(!p)return f(this.container.nodepath,"proxies",n,307,a);i=p.proxies(n,this.container)}this.validation(e,s,n,l(i),"proxies")}return e}}async params(t){for(let e in t){let o=t[e],n=async()=>{let s=null;if(o.store){let i=this.store(o.store),a=await this.app.store?.init(i);if(!a)return f(this.container.nodepath,"params",e,307,i);s=a.params(e)}else s=this.props?.params[e];return o?.mutable?s:l(s)};this.validation(this.context.param,o,e,await n(),"params"),o.readonly&&Object.defineProperty(this.context.param,e,{writable:!1})}}async methods(t){let e=(o,n)=>{this.context.method[n]=(...s)=>{if(s.length&&(s.length>1||typeof s.at(0)!="object"))return f(this.container.nodepath,"methods",n,301);let i=o({...l(s.at(0)),_params:this.context.container.param,_methods:this.context.container.method});return i instanceof Promise?i.then(a=>l(a)):l(i)}};for(let o in t){let n=t[o];if(n.store){let s=this.store(n.store),i=await this.app.store?.init(s);if(!i)return f(this.container.nodepath,"methods",o,307,s);let a=i.methods(o);if(!a)return f(this.container.nodepath,"methods",o,305,s);e(a,o)}else{let s=this.props.methods?.hasOwnProperty(o);if(n?.required&&!s)return f(this.container.nodepath,"methods",o,303);s&&e(this.props.methods[o],o)}}}},ct={init(r,t,e,o){return new Q(r,e,o).setup(t)}};var T=class extends j{constructor(...t){super(...t)}async props(t){this.proxiesData=await ct.init(t,this.component.props,this.context,this.app)||{}}actives(t,e,o){let n=i=>{b(i.reactivity?.node,e),b(i.reactivity?.component,e,o)},s=i=>{for(let a in i.spot)n(i.spot[a]),s(i.spot[a])};n(t),t.children?t.children.forEach(i=>s(i)):s(t)}destroy(t){t.reactivity?.component?.clear(),t.prop={},t.action={};for(let e in t.unstore)t.unstore[e]()}unmount(t){if(this.context.node)for(let e of Object.values(this.context.node)){if(e.directives)for(let o of Object.values(e.directives))o.destroy?.();if(e.reactivity?.node?.clear(),!e.unmount)return;for(let o in e.spot)e.spot[o].unmount?.();e.unmount()}this.component.unmounted?.bind(this.context)(),delete t.unmount}};function X(r){if(!r.mixins?.length)return r;let t=["directives","params","proxies","methods","handlers","setters","sources"],e=["params","proxies","methods"],o=["loaded","rendered","created","mounted","unmounted"],n={props:{},actions:[],spots:[]},s=[],i={},a=(c,h,v)=>({...c[v],...h[v]}),p=(c,h)=>[...c,...h||[]],m=(c={},h={})=>{for(let v in h)c[v]={...c[v]||{},...h[v]};return c},x=c=>{n.template=c.template||n.template,n.actions=p(n.actions,c.actions),n.spots=p(n.spots,c.spots),t.forEach(h=>{n[h]=a(n,c,h)}),o.forEach(h=>{c[h]&&(n[h]=c[h])}),e.forEach(h=>{n.props[h]=a(n.props,c.props||{},h)}),c.nodes&&s.push(c.nodes)};return n.nodes=function(){return s.forEach(c=>{m(i,c.bind(this)())}),i},r.mixins.forEach(c=>{x(X(c))}),x(r),n}var S={directives(r){let t=this.nodeElement;if(!r.startsWith("_"))return d(t.nodepath,102,r);let e=this.context.directives[r],o=this.nodeOptions[r],{create:n,update:s,destroy:i}=e;Object.assign(t.directives,{[r]:{create:()=>n?n.bind(e)(t.target,o):{},destroy:()=>i?i.bind(e)(t.target,o):{}}}),n&&t.directives[r].create();let a=(p,m,x)=>{let c=h=>s.bind(e)(t.target,h,m,x);typeof p=="function"?(this.impress.collect=!0,c(p(t.target)),this.reactiveNode(this.impress.define(),()=>c(p(t.target)))):c(p)};if(s)if(typeof o=="object")for(let p in o)a(o[p],p,o);else a(o)}};var D={listeners(r){typeof this.nodeOptions[r]=="function"&&(this.nodeElement.target[r]=t=>this.nodeOptions[r].bind(this.context)(t))},general(r){let t=e=>{this.nodeElement.target[r]!==null&&typeof this.nodeElement.target[r]=="object"?e!==null&&typeof e=="object"?Object.assign(this.nodeElement.target[r],e):d(this.nodeElement.nodepath,103,r):this.nodeElement.target[r]=e};if(typeof this.nodeOptions[r]=="function"){let e=()=>t(this.nodeOptions[r].bind(this.context)());this.impress.collect=!0,e(),this.reactiveNode(this.impress.define(),e)}else t(this.nodeOptions[r])},native(r){r.startsWith("on")?this.listeners(r):this.general(r)}};var pt={async iterative(r){if(typeof r.iterate!="function")return u(this.nodeElement.nodepath,205);if(this.nodeElement.replaced)return u(this.nodeElement.nodepath,204);if(this.name=null,this.repeat=0,this.nodeElement.children=[],this.nodeOptions.component=r,this.nodeElement.clear=()=>this.length.bind(this)(0),this.createIterate=async t=>{this.nodeElement.children[t]=this.nodeElement._current={parent:this.nodeElement,target:!0,nodepath:this.nodeElement.nodepath+"."+t,index:t,action:{},prop:{},iterated:!0},await this.create(this.proxiesIterate.bind(this),this.nodeElement._current,r)},this.impress.collect=!0,this.data=r.iterate(),this.data){if(!Array.isArray(this.data))return u(this.nodeElement.nodepath,205);this.name=this.impress.refs.at(-1),this.impress.clear(),Object.getPrototypeOf(this.data).instance==="Proxy"&&(this.reactiveComponent([this.name],o=>this.length(o.length)),this.reactiveComponent([this.name+".length"],o=>this.length(o)));let t=async()=>{this.data=r.iterate(),await this.length(this.data.length)};this.induced(async o=>o?await t():this.nodeElement.clear())&&await t()}},proxiesIterate(r){let t=this.nodeElement._current,e=(o,n)=>{this.impress.refs.some(s=>s.includes(this.name))?this.reactiveComponent(this.impress.define(o),(s,i)=>{let a=(...p)=>t.prop[o]?.update(...p);i?a(s,i):a(n(t))}):this.nodeElement.created?this.impress.clear():this.reactiveComponent(this.impress.define(o),(s,i)=>{let a=this.nodeElement.children,p=m=>{let x=a[m],c=(...h)=>x.prop[o]?.update(...h);i?c(s,i):c(n(x))};this.portions(a.length,0,p),this.repeat++})};return this.reactivate(r,e,t)},async portions(r,t,e){if(!r)return;let{portion:o}=this.nodeOptions.component,n=null,s=!1;if(t<r-o){let i=()=>{if(this.repeat>1)return this.repeat--;this.portions(r,t,e)};setTimeout(()=>s?i():new Promise(a=>n=a).then(a=>i()))}do if(await e(t),t++,n&&(o=1),t>=r){this.repeat=0;break}while(t%o!==0);s=!0,n?.()},async length(r){this.repeat++;let t=this.nodeElement.children.length;if(r>t&&await this.portions(r,t,async e=>await this.createIterate(e)),r<t)for(;r<t;){t--;let e=this.nodeElement.children;C(this.nodeElement.reactivity.component,this.name+"."+t),e[t].unmount?.(),e[t].target.remove?.(),e.splice(t,1)}}};var ht={async basic(r){this.nodeOptions.component=r;let t=()=>this.create(this.proxies.bind(this),this.nodeElement,r);this.induced(async o=>o?await t():this.nodeElement.unmount?.())&&await t()},proxies(r){if(!r)return;let t=(e,o)=>this.reactiveComponent(this.impress.define(e),(n,s)=>{let i=(...a)=>this.nodeElement.prop[e]?.update(...a);s?i(n,s):i(o(this.nodeElement))});return this.reactivate(r,t)}};var ut={collect(r,t){return{params:this.params(r.params,t),methods:this.methods(r.methods)}},methods(r){let t={};if(r)for(let[e,o]of Object.entries(r))typeof o=="function"&&Object.assign(t,{[e]:o});return t},params(r,t){let e={};if(r)for(let[o,n]of Object.entries(r))Object.assign(e,{[o]:typeof n=="function"&&n.name?n(t):n});return e}};var lt={async component(){if(this.nodeElement.reactivity.component=new Map,this.nodeElement.iterated)return u(this.nodeElement.nodepath,208);this.nodeElement.mount=t=>(this.nodeElement.unmount?.(),this.nodeElement.created=!1,t.iterate?this.iterative(t):this.basic(t));let r=()=>this.nodeElement.mount(this.nodeOptions.component);this.nodeOptions.component.async?r():await r()},induced(r){if(this.nodeOptions.component.hasOwnProperty("induce")){this.nodeElement.induce=r;let t=this.nodeOptions.component.induce;if(!t)return;if(typeof t=="function"){this.impress.collect=!0;let e=t();if(this.reactiveNode(this.impress.define(),async()=>await this.nodeElement.induce(t())),!e)return}}return!0},reactiveComponent(r,t){return this.reactive(r,t,this.nodeElement.reactivity.component)},reactivate(r,t){let e={};if(r)for(let[o,n]of Object.entries(r))if(typeof n=="function"&&n.name){this.impress.collect=!0;let s=a=>n(a),i=n(this.nodeElement._current||this.nodeElement);Object.assign(e,{[o]:{_value:i,_independent:!t(o,s)}})}else Object.assign(e,{[o]:{_value:n,_independent:!0}});return e},async create(r,t,e){let{src:o,spots:n,aborted:s,completed:i}=e;if(o&&(await V(o,t,{aborted:s,completed:i,...ut.collect(e,t),proxies:r(e.proxies)||{}},this.app),this.nodeElement.created=!0,!!n))for await(let[a,p]of Object.entries(n)){if(!t.spot?.hasOwnProperty(a)){u(t.nodepath,202,a);continue}let m=t.spot[a];Object.assign(m,{parent:t,nodepath:t.nodepath+"."+a,nodename:a,action:{},prop:{},spoted:!0}),await H(p,this.context,m,this.impress,this.app).controller()}}};var y=class{constructor(t,e,o,n,s){this.app=s,this.nodeOptions=t,this.context=e,this.impress=n,this.nodeElement=o,this.nodeElement.reactivity={node:new Map}}reactive(t,e,o){return t?.length&&o.set(e,t),this.impress.clear(),t}reactiveNode(t,e){this.reactive(t,e,this.nodeElement.reactivity.node)}controller(){let t=this.nodeElement.nodepath,e=this.nodeElement.target.tagName==="TEMPLATE";this.nodeElement.replaced=e;for(let o in this.nodeOptions){if(e&&!["selector","component"].includes(o))return d(t,108,o);if(o in this.nodeElement.target)this.native(o);else if(o in this.context.directives)this.directives(o);else{if(o==="component")return this.component?.();if(o!=="selector")return d(t,104,o)}}}};function H(...r){return Object.assign(y.prototype,D,S,pt,ht,lt),new y(...r)}function P(r,t){let e=typeof r=="function"?r.bind(t)():r,o=document.createElement("div");return o.innerHTML=e.trim(),o.childNodes}function Y(r,t){let e={...t.context.options},o=s=>{if(!s)return u(r.nodepath,210);let i=P(s,t.context);return i.length>1?u(r.nodepath,210):i},n=s=>{e.spots?.length&&(s.spot={}),e.spots?.forEach(i=>Object.assign(s.spot,{[i]:{target:s.target.querySelector(`[spot="${i}"]`)}}))};if(r.iterated){let s=r.parent;s.children.length===1&&s.target.childNodes.length&&(s.target.innerHTML="");let i=o(e.template);s.target.append(...i),r.target=s.target.lastChild,n(r),s.unmount||(s.unmount=()=>{t.destroy(s),s.clear()}),r.unmount=()=>{t.destroy(r),t.unmount(r),t.context.abort()}}else{if(r.replaced){let s=o(e.template),i=r.target;r.target.before(...s),r.target=i.previousSibling,i.remove()}else{if(!e.template)return;let s=P(e.template,t.context);r.target.innerHTML="",r.target.append(...s)}n(r),r.unmount=()=>{t.destroy(r),t.unmount(r),r.target.innerHTML="",t.context.abort()}}}async function q(r,t,e,o,n={}){let s=[async()=>await r.loaded(),async()=>{await r.props(n),r.params(),r.methods(),r.proxies(),await r.created()},async()=>{t(),await r.rendered()},async()=>{await r.nodes(),await r.mounted()}];try{for await(let i of s)await w(i(),r.context.abortSignal),r.context.phase++}catch{e()}return o?.(),r.context.container}async function V(r,t,e={},o={}){let n=new AbortController;t.unmount=()=>n.abort();let s=()=>e.aborted?.({phase:a?a.context.phase:0,reason:n.signal.reason}),i=await g(r,n.signal,s);if(!i)return u(t.nodepath,216);let a=new T(X(i),t,o,n,H);return await q(a,()=>Y(t,a),s,e.completed,e)}function mt(r={}){let t={};return r.mount=async({options:e,target:o,name:n="root"},s)=>(Object.assign(t,{target:o,nodepath:n,action:{},prop:{}}),await V(e,t,s,r)),r.unmount=()=>t.unmount?.(),Object.preventExtensions(r),r}var F=(r,t,e="")=>{};var Z=class{constructor(t,e,o){this.store=t,this.context={name:o,app:e,options:t,reactivity:new Map,param:{},method:{},source:this.store.sources}}async loaded(){this.store.loaded&&await this.store.loaded.bind(this.context)()}create(){this.context.param=this.store.params,Object.preventExtensions(this.context.param);for(let t in this.store.methods)this.context.method[t]=e=>this.store.middlewares&&t in this.store.middlewares?(async()=>{let o=await this.store.middlewares[t].bind(this.context)(e);return o&&typeof o!="object"?F(this.context.name,404,t):(e&&o&&Object.assign(e,o),this.store.methods[t].bind(this.context)(e))})():this.store.methods[t].bind(this.context)(e);this.context.proxy=E(this.store.proxies,{beforeSet:(t,e,o)=>{if(this.store.setters?.[e]){let n=this.store.setters[e].bind(this.context)(t);if(n===void 0)return!0;o(n)}},set:async(t,e,o)=>{b(this.context.reactivity,o,e)}}),Object.preventExtensions(this.context.proxy)}async created(){this.store.created&&await this.store.created.bind(this.context)()}params(t){return this.context.param[t]}proxies(t,e){let o=(n,s)=>e.prop[t].update(n,s);return this.context.reactivity.set(o,t),e.unstore||(e.unstore={}),e.unstore[t]=()=>{this.context.reactivity.delete(o)},this.context.proxy[t]}methods(t){return this.context.method[t]}};function ft(r,t){if(!t)return F(null,401);let e={};return r.store={init:async o=>{if(!e.hasOwnProperty(o)){let n=await g(t[o]);if(!n)return F(o,402);let s=new Z(n,r,o);e[o]=s,await s.loaded(),s.create(),await s.created()}return e[o]},destroy:o=>delete e[o]},r.store}var N=(r="",t,e="")=>{},O=(r,t="")=>{};var dt={init(r,t){return this.url=t,this.result={path:null,map:null,to:null},this.routeEach(r)},picker(r){if(r){let t={},e=this.result.path.match(/:\w+/g);e&&e.forEach((n,s)=>{t[n.substring(1)]=this.result.map[s+1]});let o={path:this.result.map.at(0)||"/",params:t,fullPath:this.url.href,hash:this.url.hash,query:Object.fromEntries(new URLSearchParams(this.url.search)),name:r.name,extra:r.extra,route:{}};r.path.slice(-1)==="*"&&(o.pathMatch=this.result.map.at(-1));for(let n in r)r[n]&&(o.route[n]=r[n]);return o.route.path=this.result.path,o}},mapping(r){let t=r.replace(/:\w+/g,"(\\w+)").replace(/\*$/,"(.*)"),e=new RegExp(`^${t}$`);return(decodeURI(this.url.pathname).toString().replace(/\/$/,"")||"/").match(e)},find(r,t){this.result.path=t,this.result.map=this.mapping(this.result.path);let e=1;for(let o in r.route.params){let n=!1,s=r.route.params[o];if(!this.result.map&&s.optional){let i=this.result.path.replace("/:"+o,"").replace(/\/$/,"");this.result.map=this.mapping(i),n=!0}if(this.result.map&&s.regex){let i=this.result.map[e];s.regex.test(i)||n||(this.result.map=null)}if(this.result.map&&s.enum){let i=this.result.map[e];s.enum.includes(i)||n||(this.result.map=null)}n||e++}},routeEach(r){let t={};for(let e of r)e.path||N(e.name,501),this.find(e,e.path),this.result.map&&(this.result.to=this.picker(e.route),t={...this.result});return!this.result.map&&t&&(this.result=t),this.result.to}};function xt(r,t,e){return r&&r[e]?(t.regex&&!t.regex.test(r[e])&&O(555,e),r[e]):(t.optional||O(554,e),"")}function U(r){return/[<>\/&"'=]/.test(r)?encodeURIComponent(r):r}function tt(r,t,e){let o="";if(!r)return"/";if(typeof r=="object")if(r.path&&r.path.startsWith("/"))o=r.path;else if(r.name){let n=e.findIndex(s=>s.name===r.name);if(n!==-1){o=e[n].path;let s=e[n].route.params;for(let i in r.params)s[i]||O(553,i);for(let[i,a]of Object.entries(s)){let p=xt(r.params,a,i);o=o.replace("/:"+i,U(p))}o.slice(-1)==="*"&&(o=o.replace(/\*$/,r.pathMatch||"")),r.query&&(o+="?"+new URLSearchParams(r.query).toString())}else O(551,r.name)}else{let n=new URL(t.fullPath);if(r.params){Object.keys(t.params).length||O(552),o=t.route.path;for(let s in t.params){let i=r.params[s]||t.params[s];if(i){let a=xt(r.params,i,s);o=o.replace("/:"+s,U(a))}else O(553,s)}o.slice(-1)==="*"&&(o=o.replace(/\*$/,r.pathMatch||t.pathMatch))}else o=n.pathname;if(r.query){for(let s in r.query)r.query[s]===""?n.searchParams.delete(s):n.searchParams.set(U(s),U(r.query[s]));o+=n.search}r.hash&&(typeof r.hash=="string"&&(n.hash=r.hash),o+=n.hash)}else if(typeof r=="string"&&r.startsWith("/"))o=r;else return new URL(r,t.fullPath).pathname;return o=o.replace(/\/$/,"").replace(/^([^/])/,"/$1"),o||"/"}function yt(r,t,e={path:""}){r.forEach(o=>{if(!o.hasOwnProperty("path"))return N(o.name,557);o.params={...e.params,...o.params},o.extra={...e.extra,...o.extra},o.beforeEnter=o.beforeEnter||e.beforeEnter,o.afterEnter=o.afterEnter||e.afterEnter;let n=(s="")=>{o.children?yt(o.children,t,{path:s,params:o.params,extra:o.extra,beforeEnter:o.beforeEnter,afterEnter:o.afterEnter}):t.push({name:o.name,path:s.replace(/\/$/,"")||"/",route:o})};if(n(e.path+"/"+o.path.replace(/^\/|\/$/g,"")),o.alias){let s=i=>i.charAt(0)==="/"?i:e.path+"/"+i;if(Array.isArray(o.alias))for(let i of o.alias)n(s(i));else n(s(o.alias))}})}var bt=yt;var A=class{constructor(t,e,o){this.app=t,this.propsData=o,this.app.router={layouts:e.layouts||{},collection:[],push:this.push.bind(this),link:this.link.bind(this),from:null,to:null,render:()=>{},update:()=>{}},this.routes=e.routes,this.afterEach=e.afterEach,this.beforeEach=e.beforeEach,this.beforeEnter=e.beforeEnter,this.afterEnter=e.afterEnter,this.form=null,bt(this.routes,this.app.router.collection)}link(t){return tt(t,this.app.router.to,this.app.router.collection)}async push(t){let e=t.path||t;if(typeof e=="string"&&e!==""){if(e.startsWith("#"))return history[t.replace?"replaceState":"pushState"](null,null,t.path);try{if(new URL(e).hostname!==location.hostname)return window.open(e,t.target||"_self",t.windowFeatures)}catch{}}let o=this.link(t);if(typeof o!="string")return o;let n=new URL((this.app.origin||location.origin)+o);return await this.update(n,!0,typeof t=="object"?t.replace:!1,t.reload)}async beforeHooks(t){if(t){let e=await t(this.app.router.to,this.app.router.from,this.app);if(e)return e!==!0&&this.push(e),!0}}async afterHooks(t){t&&await t(this.app.router.to,this.app.router.from,this.app)}async update(t,e=!1,o=!1,n=!1){let s=null;if(await this.beforeHooks(this.beforeEach))return;let i=dt.init(this.app.router.collection,t),a=i?.route;if(a){if(i.pushed=e,i.replace=o,i.reload=n,this.app.router.from=this.form,this.app.router.to=i,await this.beforeHooks(this.beforeEnter)||await this.beforeHooks(a.beforeEnter))return;if(a.redirect){let p=a.redirect;typeof p=="function"?await this.push(await p(i,this.app.router.from)):await this.push(p);return}if(s=await this.app.router.render(this.app.router.to),!s)return;this.form=this.app.router.to,await this.afterHooks(this.afterEnter),await this.afterHooks(a.afterEnter)}return await this.afterHooks(this.afterEach),s}};var R=class extends A{constructor(...t){super(...t),this.currentLayout=null,this.current=null,this.app.router.render=this.render.bind(this),this.app.router.update=this.on.bind(this),this.contaner=null,this.rootContainer=null,this.events=new Set}async init(t){this.rootContainer=t,window.addEventListener("popstate",()=>this.update.bind(this)(window.location)),this.rootContainer.addEventListener("click",e=>{let o=e.target.closest("[link]");o&&(e.preventDefault(),this.push(o.getAttribute("href")))}),await this.update(window.location)}async emit(...t){let e=this.events;for await(let o of e)await o(...t)}on(t){let e=this.events;return e.has(t)||e.add(t),()=>e.delete(t)}async render(t){t.pushed&&history[t.replace?"replaceState":"pushState"](null,null,t.fullPath);let e=t.route,o=this.app.router.from;if(this.current&&o?.route.component!==e.component&&(this.current?.unmount?.(),this.current=null),this.currentLayout&&o?.route.layout!==e.layout&&(this.currentLayout.unmount(),this.currentLayout=null),e.layout){if(t.reload||o?.route.layout!==e.layout){if(this.currentLayout=await this.app.mount({options:this.app.router.layouts[e.layout],target:this.rootContainer},this.propsData),!this.currentLayout)return;if(this.contaner=this.rootContainer.querySelector("[router]"),!this.contaner){N(null,503);return}}}else this.contaner=this.rootContainer;if(this.rootContainer.setAttribute("layout",e.layout||""),document.title=e.title||"Lesta",this.rootContainer.setAttribute("page",e.name||""),t.reload||o?.route.component!==e.component){if(window.scrollTo(0,0),this.current=await this.app.mount({options:e.component,target:this.contaner},this.propsData),!this.current)return}else await this.emit(t,o,this.app);return t}};function wt(r,t,e={}){return new R(r,t,e)}function gt(...r){return Object.assign(y.prototype,D,S),new y(...r)}async function Et({options:r,target:t,name:e="root"},o={}){if(!r)return u(e,216);if(!t)return u(e,217);let n={...r},s=new AbortController,i={target:t,nodepath:e,action:{},unmount(){s.abort(),t.innerHTML="",p.component.unmounted?.bind(p.context)(),delete i.unmount}},a=()=>o.aborted?.({phase:p.context.phase,reason:s.signal.reason}),p=new j(n,i,o,s,gt);return await q(p,()=>{p.context.container=i,n.template&&t.append(...P(n.template,p.context))},a,o.completed)}window.lesta=et;})();
