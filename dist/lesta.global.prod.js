(()=>{var wt=Object.defineProperty;var Z=(r,t)=>{for(var e in t)wt(r,e,{get:t[e],enumerable:!0})};var Y={};Z(Y,{createApp:()=>ht,createRouter:()=>xt,createStores:()=>ut,debounce:()=>U,deepFreeze:()=>N,delayRace:()=>W,deliver:()=>A,escHtml:()=>k,isObject:()=>$,loadModule:()=>E,mapProps:()=>I,mountWidget:()=>bt,replicate:()=>u,revocablePromise:()=>w,throttle:()=>z});function $(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function N(r){if(r===null||typeof r!="object")return r;let t=new WeakSet;function e(o){if(Object.isFrozen(o)||!(o instanceof Object)||t.has(o))return o;t.add(o),Object.freeze(o);for(let n of Reflect.ownKeys(o)){let s=o[n];s instanceof Object&&e(s)}return o}return e(r)}function u(r){return r?typeof r=="object"?JSON.parse(JSON.stringify(r)):r:r??null}function A(r,t=[],e){let o=Array.isArray(t)?t:t.split("."),n;try{for(n=0;n<o.length-1;n++)r=r[o[n]];return e!==void 0&&(r[o[n]]=e),r[o[n]]}catch{}}function I(r,t){return r.reduce((e,o)=>(e[o]=t,e),{})}function U(r,t=150){let e;return(...o)=>{clearTimeout(e),e=setTimeout(()=>{r(...o)},t)}}function z(r,t=150){let e=null;return function(...n){e===null&&(e=setTimeout(()=>{r.apply(this,n),e=null},t))}}function W(r=0,t){return new Promise((e,o)=>{if(t?.aborted){o(new Error("Aborted"));return}let n=setTimeout(()=>{e(),i()},r),s=()=>{clearTimeout(n),o(new Error("Aborted")),i()},i=()=>t?.removeEventListener("abort",s);t?.addEventListener("abort",s)})}async function w(r,t,e){return new Promise((o,n)=>{let s=()=>{n(),e?.(),t?.removeEventListener("abort",s)};t?.addEventListener("abort",s),t?.aborted&&s(),r.then(o).catch(n)})}async function E(r,t,e){if(typeof r=="function"){let o=r();return o instanceof Promise?{...(await w(o,t,e))?.default}:o}return{...r}}function F(r,t){for(let[e,o]of r)if(Array.isArray(o)){let n=o.indexOf(t);n!==-1&&(o.length===1?r.delete(e):o.splice(n,1))}else o===t&&r.delete(e)}function k(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/`/g,"&#x60;").replace(/=/g,"&#x3D;")}var f=(r,t,e="")=>{};function g(r,t,e=""){if(!(r&&(r.constructor.name==="Object"||r.constructor.name==="Array")))return r;let o={getPrototypeOf(n){return{target:n,instance:"Proxy"}},get(n,s,i){return t.get?.(n,s,`${e}${s}`),Reflect.get(n,s,i)},set(n,s,i,a){return t.beforeSet(i,`${e}${s}`,h=>{i=h})||!(Reflect.get(n,s,a)!==i||s==="length")||(i=g(i,t,`${e}${s}.`),Reflect.set(n,s,i,a),t.set(n,i,`${e}${s}`)),!0},deleteProperty(n,s){return Reflect.deleteProperty(n,s)},defineProperty(n,s,i){return Reflect.defineProperty(n,s,i)}};r=u(r);for(let n in r)r.hasOwnProperty(n)&&(r[n]=g(r[n],t,`${e}${n}.`));return new Proxy(r,o)}function b(r,t,e){if(!r)return;let o=(n,s)=>{let i=Math.min(n.length,s.length);return n.slice(0,i)===s.slice(0,i)};for(let[n,s]of r)Array.isArray(s)?s.includes(t)&&n(e):o(t,s)&&n(e,t.length>s.length?t.replace(s+".",""):void 0)}var x=(r,t,e="")=>{};var tt={refs:[],collect:!1,define(r){return r&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var J={};Z(J,{_attr:()=>ot,_class:()=>et,_event:()=>nt,_text:()=>rt});var et={update:(r,t,e)=>t?r.target.classList.add(e):r.target.classList.remove(e)};var rt={update:(r,t)=>{t!==void 0&&(r.target.textContent=t!==Object(t)?t:JSON.stringify(t))}};var ot={update:(r,t,e)=>{typeof t=="boolean"?t?r.target.setAttribute(e,""):r.target.removeAttribute(e):r.target.setAttribute(e,t)}};var nt={create:(r,t)=>{for(let e in t)r.target.addEventListener(e,t[e])},destroy:(r,t)=>{for(let e in t)r.target.removeEventListener(e,t[e])}};var j=class{constructor(t,e,o,n,s){this.factory=s,this.component=t,this.app=o,this.impress=tt,this.proxiesData={},this.context={app:o,container:e,options:t,phase:0,abort:()=>n.abort(),id:()=>(o.id++,o.name+o.id),abortSignal:n.signal,node:{},param:{},method:{},proxy:{},source:t.sources||{},directives:{...J,...o.directives,...t.directives}}}async loaded(t){await this.component.loaded?.bind(this.context)(t)}async props(){}async rendered(){if(typeof this.component!="object")return f(this.context.container.nodepath,211);await this.component.rendered?.bind(this.context)()}async mounted(){await this.component.mounted?.bind(this.context)()}async created(){await this.component.created?.bind(this.context)()}unmounted(t){this.component.unmounted?.bind(this.context)(),delete t.unmount}refreshed(t){this.component.refreshed?.bind(this.context)(t)}methods(){if(this.component.methods)for(let[t,e]of Object.entries(this.component.methods)){if(this.context.method.hasOwnProperty(t))return f(this.context.container.nodepath,212,t);this.context.method[t]=e.bind(this.context),this.component.actions?.includes(t)&&(this.context.container.action[t]=(...o)=>{let n=e.bind(this.context)(u(...o));return n instanceof Promise?n.then(s=>u(s)):u(n)})}Object.preventExtensions(this.context.container.action),Object.preventExtensions(this.context.method)}params(){if(this.component.params){for(let t in this.component.params)if(this.context.param.hasOwnProperty(t))return f(this.context.container.nodepath,213,t);Object.assign(this.context.param,this.component.params)}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return f(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}actives(t,e){b(t.reactivity?.node,e)}getProxy(){return g(this.proxiesData,{beforeSet:(t,e,o)=>{if(this.component.setters?.[e]){let n=this.component.setters[e].bind(this.context)(t);if(n===void 0)return!0;o(n)}},set:(t,e,o)=>{for(let n in this.context.node)this.actives(this.context.node[n],o,e);this.component.handlers?.[o]?.bind(this.context)(e)},get:(t,e,o)=>{this.impress.collect&&!this.impress.refs.includes(o)&&t.hasOwnProperty(e)&&this.impress.refs.push(o)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),e=this.context.container,o=e.target;for(let n in t){let s=t[n].selector||this.context.app.selectors||`.${n}`,i=typeof s=="function"?s(n):s,a=o.querySelector(i)||o.matches(i)&&o,c=e.nodepath+"."+n;if(a){if(a._engaged)return x(c,106,n);a._engaged=!0;let h=this.component.styles?.[n];if(typeof h=="string"&&h.trim()&&(a.classList.remove(n),a.classList.add(h)),e.spot&&Object.values(e.spot).includes(a)){x(c,107,n);continue}Object.assign(this.context.node,{[n]:{target:a,nodepath:c,nodename:n,action:{},prop:{},directives:{}}})}else x(c,105)}Object.preventExtensions(this.context.node);for await(let[n,s]of Object.entries(this.context.node))await this.factory(t[n],this.context,s,this.impress,this.app).controller()}}};var l=(r,t,e,o,n="")=>{};var K=class{constructor(t,e,o){this.props=t,this.context=e,this.container=e.container,this.app=o}async setup(t){if(this.props.proxies&&Object.keys(this.props.proxies).length&&!t?.proxies)return l(this.container.nodepath,306);if(this.context.unrelatedProxy=e=>this.props.proxies[e]?.hasOwnProperty("_independent")?this.props.proxies[e]._independent:!0,t)return await this.params(t.params),await this.methods(t.methods),await this.proxies(t.proxies)}prop(t){return typeof t=="function"?t.bind(this.context)():t}validation(t,e,o,n,s){let i=this.container.nodepath,a=(h,d)=>h&&d&&!(typeof h===d||d==="array"&&Array.isArray(h))&&l(i,s,o,304,d),c=(h,d)=>h&&Array.isArray(d)&&!d.includes(h)&&l(i,s,o,302,h);return t[o]=n??(e.required&&l(i,s,o,303))??e.default??n,typeof e=="string"&&a(t[o],e),Array.isArray(e)&&c(t[o],e),$(e)&&(a(t[o],e.type),c(t[o],e.enum),e.validation&&!e.validation.bind(this.context)(t[o])&&l(i,s,o,308)),t[o]}async proxies(t){if(t){let e={},o=this.context;for(let n in t){let s=this.prop(t[n]),i=s.store;this.container.prop[n]={update:(c,h)=>h?A(o.proxy[n],h,u(c)):this.validation(o.proxy,s,n,u(c),"proxies")};let a=null;if(this.props.proxies?.hasOwnProperty(n))a=this.props.proxies[n]?._value;else if(i){let c=await this.app.store?.init(i);if(!c)return l(this.container.nodepath,"proxies",n,307,i);a=c.proxies(n,this.container)}this.validation(e,s,n,u(a),"proxies")}return e}}async params(t){for(let e in t){let o=this.prop(t[e]),n=o.store,s=async()=>{let i=null;if(n){let a=await this.app.store?.init(n);if(!a)return l(this.container.nodepath,"params",e,307,n);i=a.params(e)}else i=this.props?.params[e];return o?.mutable?i:u(i)};this.validation(this.context.param,o,e,await s(),"params"),o.readonly&&Object.defineProperty(this.context.param,e,{writable:!1})}}async methods(t){let e=(o,n)=>{this.context.method[n]=(...s)=>{if(s.length&&(s.length>1||typeof s.at(0)!="object"))return l(this.container.nodepath,"methods",n,301);let i=o(u(s.at(0)));return i instanceof Promise?i.then(a=>u(a)):u(i)}};for(let o in t){let n=this.prop(t[o]),s=n.store;if(s){let i=await this.app.store?.init(s);if(!i)return l(this.container.nodepath,"methods",o,307,s);let a=i.methods(o);if(!a)return l(this.container.nodepath,"methods",o,305,s);e(a,o)}else{let i=this.props.methods?.hasOwnProperty(o);if((n?.required||n===!0)&&!i)return l(this.container.nodepath,"methods",o,303);i&&e(this.props.methods[o],o)}}}},st={init(r,t,e,o){return new K(r,e,o).setup(t)}};var M=class extends j{constructor(...t){super(...t)}async props(t){this.proxiesData=await st.init(t,this.component.props,this.context,this.app)||{}}actives(t,e,o){let n=i=>{b(i.reactivity?.node,e),b(i.reactivity?.component,e,o)},s=i=>{for(let a in i.spot)n(i.spot[a]),s(i.spot[a])};n(t),t.children?t.children.forEach(i=>s(i)):s(t)}destroy(t){t.reactivity?.component?.clear(),t.prop={},t.action={};for(let e in t.unstore)t.unstore[e]()}refresh(t){if(this.context.node){for(let e of Object.values(this.context.node))if(e.unmount){for(let o in e.spot)e.spot[o].refresh?.(t);e.refresh(t)}}super.refreshed(t)}unmount(t){if(this.context.node)for(let n of Object.values(this.context.node)){if(n.directives)for(let s of Object.values(n.directives))s.destroy?.();if(n.reactivity?.node?.clear(),!!n.unmount){for(let s in n.spot)n.spot[s].unmount?.();n.unmount()}}let{spotname:e,parent:o}=t;e&&o.refresh({cause:"spotUnmounted",data:{spotname:e}}),super.unmounted(t)}};function B(r){if(!r.mixins?.length)return r;let t=["styles","directives","params","proxies","methods","handlers","setters","sources"],e=["params","proxies","methods"],o=["loaded","rendered","created","mounted","unmounted","refreshed"],n={props:{},actions:[],spots:[]},s=[],i={},a=(p,m,v)=>({...p[v],...m[v]}),c=(p,m)=>[...p,...m||[]],h=(p={},m={})=>{for(let v in m)p[v]={...p[v]||{},...m[v]};return p},d=p=>{n.template=p.template||n.template,n.actions=c(n.actions,p.actions),n.spots=c(n.spots,p.spots),t.forEach(m=>{n[m]=a(n,p,m)}),o.forEach(m=>{p[m]&&(n[m]=p[m])}),e.forEach(m=>{n.props[m]=a(n.props,p.props||{},m)}),p.nodes&&s.push(p.nodes)};return n.nodes=function(){return s.forEach(p=>{h(i,p.bind(this)())}),i},r.mixins.forEach(p=>{d(B(p))}),d(r),n}var S={directives(r){let t=this.nodeElement;if(!r.startsWith("_"))return x(t.nodepath,102,r);let e=this.context.directives[r],o=this.nodeOptions[r],{create:n,update:s,destroy:i}=e;Object.assign(t.directives,{[r]:{create:()=>n?n.bind(e)(t,o):{},destroy:()=>i?i.bind(e)(t,o):{}}}),n&&t.directives[r].create();let a=(c,h,d)=>{let p=m=>s.bind(e)(t,m,h,d);typeof c=="function"?(this.impress.collect=!0,p(c(t,d)),this.reactiveNode(this.impress.define(),()=>p(c(t,d)))):p(c)};if(s)if(typeof o=="object")for(let c in o)a(o[c],c,o);else a(o)}};var T={listeners(r){typeof this.nodeOptions[r]=="function"&&(this.nodeElement.target[r]=t=>{this.nodeOptions[r].bind(this.context)(t)})},general(r){let t=e=>{this.nodeElement.target[r]!==null&&typeof this.nodeElement.target[r]=="object"?e!==null&&typeof e=="object"?Object.assign(this.nodeElement.target[r],e):x(this.nodeElement.nodepath,103,r):this.nodeElement.target[r]=e};if(typeof this.nodeOptions[r]=="function"){let e=()=>t(this.nodeOptions[r].bind(this.context)());this.impress.collect=!0,e(),this.reactiveNode(this.impress.define(),e)}else t(this.nodeOptions[r])},native(r){r.startsWith("on")?this.listeners(r):this.general(r)}};var it={async iterative(r){if(typeof r.iterate!="function")return f(this.nodeElement.nodepath,205);if(this.nodeElement.replaced)return f(this.nodeElement.nodepath,204);if(this.name=null,this.repeat=0,this.nodeElement.children=[],this.nodeOptions.component=r,this.nodeElement.clear=()=>this.length.bind(this)(0),this.createIterate=async t=>{this.nodeElement.children[t]=this.nodeElement._current={parent:this.nodeElement,target:!0,nodepath:this.nodeElement.nodepath+"."+t,index:t,action:{},prop:{},iterated:!0},await this.create(this.proxiesIterate.bind(this),this.nodeElement._current,r)},this.impress.collect=!0,this.data=r.iterate(),this.data){if(!Array.isArray(this.data))return f(this.nodeElement.nodepath,205);this.name=this.impress.refs.at(-1),this.impress.clear(),Object.getPrototypeOf(this.data).instance==="Proxy"&&(this.reactiveComponent([this.name],o=>this.length(o.length)),this.reactiveComponent([this.name+".length"],o=>this.length(o)));let t=async()=>{this.data=r.iterate(),await this.length(this.data.length)};this.induced(async o=>o?await t():this.nodeElement.clear())&&await t()}},proxiesIterate(r){let t=this.nodeElement._current,e=(o,n)=>{this.impress.refs.some(s=>s.includes(this.name))?this.reactiveComponent(this.impress.define(o),(s,i)=>{let a=(...c)=>t.prop[o]?.update(...c);i?a(s,i):a(n(t))}):this.nodeElement.created?this.impress.clear():this.reactiveComponent(this.impress.define(o),(s,i)=>{let a=this.nodeElement.children,c=h=>{let d=a[h],p=(...m)=>d.prop[o]?.update(...m);i?p(s,i):p(n(d))};this.portions(a.length,0,c),this.repeat++})};return this.reactivate(r,e,t)},async portions(r,t,e){if(!r)return;let{portion:o}=this.nodeOptions.component,n=null,s=!1;if(t<r-o){let i=()=>{if(this.repeat>1)return this.repeat--;this.portions(r,t,e)};setTimeout(()=>s?i():new Promise(a=>n=a).then(a=>i()))}do if(await e(t),t++,n&&(o=1),t>=r){this.repeat=0;break}while(t%o!==0);s=!0,n?.()},async length(r){this.repeat++;let t=this.nodeElement.children.length;if(r>t&&await this.portions(r,t,async e=>await this.createIterate(e)),r<t)for(;r<t;){t--;let e=this.nodeElement.children;F(this.nodeElement.reactivity.component,this.name+"."+t),e[t].unmount?.(),e[t].target.remove?.(),e.splice(t,1)}}};var at={async basic(r){this.nodeOptions.component=r;let t=()=>this.create(this.proxies.bind(this),this.nodeElement,r);this.induced(async o=>o?await t():this.nodeElement.unmount?.())&&await t()},proxies(r){if(!r)return;let t=(e,o)=>this.reactiveComponent(this.impress.define(e),(n,s)=>{let i=(...a)=>this.nodeElement.prop[e]?.update(...a);s?i(n,s):i(o(this.nodeElement))});return this.reactivate(r,t)}};var ct={collect(r,t){return{params:this.params(r.params,t),methods:this.methods(r.methods)}},methods(r){let t={};if(r)for(let[e,o]of Object.entries(r))typeof o=="function"&&Object.assign(t,{[e]:o});return t},params(r,t){let e={};if(r)for(let[o,n]of Object.entries(r))Object.assign(e,{[o]:typeof n=="function"&&n.name?n(t):n});return e}};var pt={async component(){if(this.nodeElement.reactivity.component=new Map,this.nodeElement.iterated)return f(this.nodeElement.nodepath,208);this.nodeElement.mount=t=>{if(!Object.keys(t).length)return;this.nodeElement.unmount?.(),this.nodeElement.created=!1;let{spotname:e,parent:o}=this.nodeElement;return e&&o.refresh({cause:"spotMounted",data:{spotname:e}}),t.iterate?this.iterative(t):this.basic(t)};let r=()=>this.nodeElement.mount(this.nodeOptions.component);this.nodeOptions.component.async?r():await r()},induced(r){if(this.nodeOptions.component.hasOwnProperty("induced")){this.nodeElement.induced=r;let t=this.nodeOptions.component.induced;if(!t)return;if(typeof t=="function"){this.impress.collect=!0;let e=t();if(this.reactiveNode(this.impress.define(),async()=>await this.nodeElement.induced(t())),!e)return}}return!0},reactiveComponent(r,t){return this.reactive(r,t,this.nodeElement.reactivity.component)},reactivate(r,t){let e={};if(r)for(let[o,n]of Object.entries(r))if(typeof n=="function"&&n.name){this.impress.collect=!0;let s=a=>n(a),i=n(this.nodeElement._current||this.nodeElement);Object.assign(e,{[o]:{_value:i,_independent:!t(o,s)}})}else Object.assign(e,{[o]:{_value:n,_independent:!0}});return e},async create(r,t,e){let{src:o,spots:n,aborted:s,completed:i}=e;if(o&&(await q(o,t,{aborted:s,completed:i,...ct.collect(e,t),proxies:r(e.proxies)||{}},this.app),this.nodeElement.created=!0,!!n))for await(let[a,c]of Object.entries(n)){if(!t.spot?.hasOwnProperty(a)){f(t.nodepath,202,a);continue}let h=t.spot[a];Object.assign(h,{parent:t,nodepath:t.nodepath+"."+a,nodename:a,spotname:a,action:{},prop:{}}),await H(c,this.context,h,this.impress,this.app).controller()}}};var y=class{constructor(t,e,o,n,s){this.app=s,this.nodeOptions=t,this.context=e,this.impress=n,this.nodeElement=o,this.nodeElement.reactivity={node:new Map}}reactive(t,e,o){return t?.length&&o.set(e,t),this.impress.clear(),t}reactiveNode(t,e){this.reactive(t,e,this.nodeElement.reactivity.node)}controller(){let t=this.nodeElement.nodepath,e=this.nodeElement.target.tagName==="TEMPLATE";this.nodeElement.replaced=e;for(let o in this.nodeOptions){if(e&&!["selector","component"].includes(o))return x(t,108,o);if(o in this.nodeElement.target)this.native(o);else if(o in this.context.directives)this.directives(o);else{if(o==="component")return this.component?.();if(o!=="selector")return x(t,104,o)}}}};function H(...r){return Object.assign(y.prototype,T,S,it,at,pt),new y(...r)}function P(r,t){let e=typeof r=="function"?r.bind(t)():r,o=document.createElement("div");return o.innerHTML=e.trim().replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gi,""),o.childNodes}function G(r,t){let e={...t.context.options},o=e.template,n=i=>{let a=P(i,t.context);return a.length>1?f(r.nodepath,210):a},s=i=>{e.spots?.length&&(i.spot={}),e.spots?.forEach(a=>Object.assign(i.spot,{[a]:{target:i.target.querySelector(`[spot="${a}"]`)}}))};if(r.iterated){let i=r.parent;if(o){let a=n(o);i.target.append(...a)}r.target=i.target.children[r.index],s(r),i.unmount||(i.unmount=()=>{t.destroy(i),i.clear()}),r.unmount=()=>{t.destroy(r),t.unmount(r),t.context.abort()}}else{if(r.replaced){let i=n(o),a=r.target;r.target.before(...i),r.target=a.previousSibling,a.remove()}else{if(!o)return;let i=P(e.template,t.context);r.target.append(...i)}s(r),r.unmount=()=>{t.destroy(r),t.unmount(r),r.target.innerHTML="",t.context.abort()}}}async function D(r,t,e,o,n={}){let s=r.context;s.container.refresh=({cause:a,data:c={}})=>r.refresh(u({cause:a,data:c}));let i=[async()=>await r.loaded(),async()=>{await r.props(n),r.params(),r.methods(),r.proxies(),await r.created()},async()=>{t(),await r.rendered()},async()=>{await r.nodes(),await r.mounted()}];try{for await(let a of i)await w(a(),s.abortSignal),s.phase++}catch(a){throw e(),a}return o?.(),s.container}async function q(r,t,e={},o={}){let n=new AbortController;t.unmount=()=>n.abort();let s=()=>e.aborted?.({phase:a?a.context.phase:0,reason:n.signal.reason}),i=await E(r,n.signal,s);if(!i)return f(t.nodepath,216);let a=new M(B(i),t,o,n,H);return await D(a,()=>G(t,a),s,e.completed,e)}function ht(r={}){return r.id=0,r.name||="_",r.mount=async(t,e,o)=>await q(t,{target:e,nodepath:r.name,action:{},prop:{}},o,r),Object.assign(r,{router:{},store:{}}),Object.preventExtensions(r),r}var R=(r,t,e="")=>{};var Q=class{constructor(t,e,o){this.store=t,this.context={name:o,app:e,options:t,reactivity:new Map,param:{},method:{},source:this.store.sources}}async loaded(){this.store.loaded&&await this.store.loaded.bind(this.context)()}create(){this.context.param=this.store.params,Object.preventExtensions(this.context.param);for(let t in this.store.methods)this.context.method[t]=(...e)=>{if(e.length&&(e.length>1||typeof e.at(0)!="object"))return R(this.context.name,403,t);let o=e.at(0);return this.store.middlewares?.hasOwnProperty(t)?(async()=>{let n=await this.store.middlewares[t].bind(this.context)(o);return n&&typeof n!="object"?R(this.context.name,404,t):(o&&n&&Object.assign(o,n),this.store.methods[t].bind(this.context)(o))})():this.store.methods[t].bind(this.context)(o)};this.context.proxy=g(this.store.proxies,{beforeSet:(t,e,o)=>{if(this.store.setters?.[e]){let n=this.store.setters[e].bind(this.context)(t);if(n===void 0)return!0;o(n)}},set:async(t,e,o)=>{b(this.context.reactivity,o,e)}}),Object.preventExtensions(this.context.proxy)}async created(){this.store.created&&await this.store.created.bind(this.context)()}params(t){return this.context.param[t]}proxies(t,e){let o=(n,s)=>e.prop[t].update(n,s);return this.context.reactivity.set(o,t),e.unstore||(e.unstore={}),e.unstore[t]=()=>{this.context.reactivity.delete(o)},this.context.proxy[t]}methods(t){return this.context.method[t]}};function ut(r,t){if(!t)return R(null,401);let e={};return r.store={init:async o=>{if(!e.hasOwnProperty(o)){let n=await E(t[o]);if(!n)return R(o,402);let s=new Q(n,r,o);e[o]=s,await s.loaded(),s.create(),await s.created()}return e[o]},destroy:o=>delete e[o]},r.store}var L=(r="",t,e="")=>{},O=(r,t="")=>{};var mt={init(r,t){return this.url=t,this.result={path:null,map:null,to:null},this.routeEach(r)},picker(r){if(r){let t={},e=this.result.path.match(/:\w+/g);e&&e.forEach((n,s)=>{t[n.substring(1)]=this.result.map[s+1]});let o={path:this.result.map.at(0)||"/",params:Object.keys(t).length?t:void 0,fullPath:this.url.href,hash:this.url.hash,query:this.url.search?Object.fromEntries(new URLSearchParams(this.url.search)):void 0,name:r.name,extra:r.extra,route:{}};r.path.slice(-1)==="*"&&(o.pathMatch=this.result.map.at(-1));for(let n in r)r[n]&&(o.route[n]=r[n]);return o.route.path=this.result.path,o}},mapping(r){let t=r.replace(/:\w+/g,"(\\w+)").replace(/\*$/,"(.*)"),e=new RegExp(`^${t}$`);return(decodeURI(this.url.pathname).toString().replace(/\/$/,"")||"/").match(e)},find(r,t){this.result.path=t,this.result.map=this.mapping(this.result.path);let e=1;for(let o in r.route.params){let n=!1,s=r.route.params[o];if(!this.result.map&&s.optional){let i=this.result.path.replace("/:"+o,"").replace(/\/$/,"");this.result.map=this.mapping(i),n=!0}if(this.result.map&&s.regex){let i=this.result.map[e];s.regex.test(i)||n||(this.result.map=null)}if(this.result.map&&s.enum){let i=this.result.map[e];s.enum.includes(i)||n||(this.result.map=null)}n||e++}},routeEach(r){let t={};for(let e of r)e.path||L(e.name,501),this.find(e,e.path),this.result.map&&(this.result.to=this.picker(e.route),t={...this.result});return!this.result.map&&t&&(this.result=t),this.result.to}};function ft(r,t,e){return r&&r[e]?(t.regex&&!t.regex.test(r[e])&&O(555,e),r[e]):(t.optional||O(554,e),"")}function V(r){return/[<>\/&"'=]/.test(r)?encodeURIComponent(r):r}function X(r,t,e){let o="";if(!r)return"/";if(typeof r=="object")if(r=u(r),r.query&&(r.query=u(r.query)),r.path&&r.path.startsWith("/"))o=r.path;else if(r.name){let n=e.findIndex(s=>s.name===r.name);if(n!==-1){o=e[n].path;let s=e[n].route.params;for(let i in r.params)s[i]||O(553,i);for(let[i,a]of Object.entries(s)){let c=ft(r.params,a,i);o=o.replace("/:"+i,V(c))}o.slice(-1)==="*"&&(o=o.replace(/\*$/,r.pathMatch||"")),r.query&&(o+="?"+new URLSearchParams(r.query).toString())}else O(551,r.name)}else{let n=new URL(t.fullPath);if(r.params){Object.keys(t.params).length||O(552),o=t.route.path;for(let s in t.params){let i=r.params[s]||t.params[s];if(i){let a=ft(r.params,i,s);o=o.replace("/:"+s,V(a))}else O(553,s)}o.slice(-1)==="*"&&(o=o.replace(/\*$/,r.pathMatch||t.pathMatch))}else o=n.pathname;if(r.query){for(let s in r.query)r.query[s]===""?n.searchParams.delete(s):n.searchParams.set(V(s),V(r.query[s]));o+=n.search}r.hash&&(typeof r.hash=="string"&&(n.hash=r.hash),o+=n.hash)}else if(typeof r=="string"&&r.startsWith("/"))o=r;else{let n=new URL(r,t.fullPath);return n.pathname+n.search+n.hash}return o=o.replace(/\/$/,"").replace(/^([^/])/,"/$1"),o||"/"}function dt(r,t,e={path:""}){r.forEach(o=>{if(!o.hasOwnProperty("path"))return L(o.name,557);o.params={...e.params,...o.params},o.extra={...e.extra,...N(o.extra)},o.beforeEnter=o.beforeEnter||e.beforeEnter,o.afterEnter=o.afterEnter||e.afterEnter;let n=(s="")=>{o.children?dt(o.children,t,{path:s,params:o.params,extra:o.extra,beforeEnter:o.beforeEnter,afterEnter:o.afterEnter}):t.push({name:o.name,path:s.replace(/\/$/,"")||"/",route:o})};if(n(e.path+"/"+o.path.replace(/^\/|\/$/g,"")),o.alias){let s=i=>i.charAt(0)==="/"?i:e.path+"/"+i;if(Array.isArray(o.alias))for(let i of o.alias)n(s(i));else n(s(o.alias))}})}var lt=dt;var C=class{constructor(t,e){this.app=t,this.app.router={layouts:e.layouts||{},collection:[],push:this.push.bind(this),link:this.link.bind(this),from:null,to:null},this.routes=e.routes,this.afterEach=e.afterEach,this.beforeEach=e.beforeEach,this.beforeEnter=e.beforeEnter,this.afterEnter=e.afterEnter,this.form=null,lt(this.routes,this.app.router.collection)}link(t){return X(t,this.app.router.to,this.app.router.collection)}async push(t){let e=t.path||t;if(typeof e=="string"&&e!=="")try{if(new URL(e).hostname!==location.hostname)return window.open(e,t.target||"_self",t.windowFeatures)}catch{}let o=this.link(t);if(typeof o!="string")return o;let n=new URL(location.origin+o);return history[t.state?.replaced?"replaceState":"pushState"](null,null,n.href),await this.update(n,!0,t.state)}async beforeHooks(t){if(t){let e=await t(this.app.router.to,this.app.router.from,this.app);if(e)return e!==!0&&this.push(e),!0}}async afterHooks(t){t&&await t(this.app.router.to,this.app.router.from,this.app)}async update(t,e=!1,o={}){let n=null;if(await this.beforeHooks(this.beforeEach))return;let s=mt.init(this.app.router.collection,t),i=s?.route;if(i){if(s.pushed=e,s.state=u(o),this.app.router.from=this.form,this.app.router.to=s,await this.beforeHooks(this.beforeEnter)||await this.beforeHooks(i.beforeEnter))return;if(i.redirect){let a=i.redirect;typeof a=="function"?await this.push(await a(s,this.app.router.from)):await this.push(a);return}if(n=await this.render(this.app.router.to),!n)return;this.form=this.app.router.to,await this.afterHooks(this.afterEnter),await this.afterHooks(i.afterEnter)}return await this.afterHooks(this.afterEach),n}};var _=class extends C{constructor(...t){super(...t),this.currentLayout=null,this.current=null,this.container=null,this.rootContainer=null}async init(t){this.rootContainer=t,window.addEventListener("popstate",()=>this.update.bind(this)(window.location)),this.rootContainer.addEventListener("click",e=>{let o=e.target.closest("[link]");o&&(e.preventDefault(),this.push(o.getAttribute("href")))}),await this.update(window.location)}async render(t){let e=t.route,o=this.app.router.from;if(this.current&&o?.route.component!==e.component&&(this.current?.unmount?.(),this.current=null),this.currentLayout&&o?.route.layout!==e.layout&&(this.currentLayout.unmount(),this.currentLayout=null),e.layout)if(t.state.reloaded||o?.route.layout!==e.layout){if(this.currentLayout=await this.app.mount(this.app.router.layouts[e.layout],this.rootContainer),!this.currentLayout)return;if(this.container=this.rootContainer.querySelector("[router]"),!this.container){L(null,503);return}}else this.currentLayout?.refresh?.({cause:"routerPushed"});else this.container=this.rootContainer;if(this.rootContainer.setAttribute("layout",e.layout||""),document.title=e.title||"Lesta",this.rootContainer.setAttribute("page",e.name||""),t.state.reloaded||o?.route.component!==e.component){if(window.scrollTo(0,0),this.current=await this.app.mount(e.component,this.container),this.currentLayout?.refresh?.({cause:"pageChanged"}),!this.current)return}else this.current?.refresh?.({cause:"routerPushed"});let n=window[t.hash?.slice(1)];return window.scrollTo({top:(n?.offsetTop||0)+(t.state?.top||0),left:(n?.offsetLeft||0)+(t.state?.left||0),behavior:t.state?.behavior||"auto"}),t}};function xt(r,t){return new _(r,t)}function yt(...r){return Object.assign(y.prototype,T,S),new y(...r)}async function bt(r,t,e={}){if(!r)return f(name,216);if(!t)return f(name,217);e.id=0,e.name||="_";let o={...r},n=new AbortController,s={target:t,nodepath:e.name,action:{},unmount(){n.abort(),t.innerHTML="",a.unmounted(s)}},i=()=>e.aborted?.({phase:a.context.phase,reason:n.signal.reason}),a=new j(o,s,e,n,yt);return await D(a,()=>{a.context.container=s,o.template&&t.append(...P(o.template,a.context))},i,e.completed)}window.lesta=Y;})();
