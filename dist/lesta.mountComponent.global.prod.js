(()=>{var Z=Object.defineProperty;var tt=(e,t)=>{for(var r in t)Z(e,r,{get:t[r],enumerable:!0})};function l(e){return e?typeof e=="object"?JSON.parse(JSON.stringify(e)):e:e??null}function E(e,t="",r){let n=t.split("."),o;try{for(o=0;o<n.length-1;o++)e=e[n[o]];return r!==void 0&&(e[n[o]]=r),e[n[o]]}catch{}}async function b(e,t){if(typeof e=="function"){let r=e();return!(r instanceof Promise)||t?.aborted?void 0:(await(async()=>t?t.aborted?void 0:await Promise.race([r,new Promise(s=>t.addEventListener("abort",()=>s()))]):await r)())?.default}return e}function v(e,t){for(let[r,n]of e)if(Array.isArray(n)){let o=n.indexOf(t);o!==-1&&(n.length===1?e.delete(r):n.splice(o,1))}else n===t&&e.delete(r)}function O(e){function t(a){let c=document.createElement("capsule");return c.innerHTML=a,c}function r(a){let c=a.querySelectorAll("script");for(let p of c)p.remove()}function n(a,c){let p=c.replace(/\s+/g,"").toLowerCase();if(["src","href","xlink:href"].includes(a)&&(p.includes("javascript:")||p.includes("data:text/html"))||a.startsWith("on"))return!0}function o(a){let c=a.attributes;for(let{name:p,value:h}of c)n(p,h)&&a.removeAttribute(p)}function s(a){let c=a.children;for(let p of c)o(p),s(p)}let i=t(e);return r(i),s(i),i.childNodes}var $=()=>{let e=[],t=!1,r=()=>e.length,n=()=>e.length===0,o=i=>{e.push(i),t||(t=!0,s())},s=async()=>{let i=e.at(0);i?(await i(),e.shift(),s()):t=!1};return{add:o,isEmpty:n,size:r}};var m=(e,t,r="")=>{};var T={};tt(T,{_attr:()=>U,_class:()=>W,_evalHTML:()=>I,_event:()=>z,_html:()=>D,_text:()=>k});var D={update:(e,t)=>{e.innerHTML="",t&&e.append(...O(t))}};var I={update:(e,t)=>t!==void 0?e.innerHTML=t:""};var W={update:(e,t,r)=>t?e.classList.add(r):e.classList.remove(r)};var k={update:(e,t)=>e.textContent=t!==Object(t)?t:JSON.stringify(t)};var U={update:(e,t,r)=>{typeof t=="boolean"?t?e.setAttribute(r,""):e.removeAttribute(r):e.setAttribute(r,t)}};var z={create:(e,t)=>{for(let r in t)e.addEventListener(r,t[r])},destroy:(e,t)=>{for(let r in t)e.removeEventListener(r,t[r])}};var F={refs:[],collect:!1,define(e){return e&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var N=class{constructor(t,r,n={},o){this.component=t,this.app=n,this.impress=F,this.proxiesData={},this.context={app:n,container:r,options:t,phase:0,abortSignal:o,node:{},param:{},method:{},proxy:{},source:t.sources||{},directives:{...T,...n.directives,...t.directives}}}async loaded(t){return await this.component.loaded?.bind(this.context)(t)}async rendered(){return typeof this.component!="object"?m(this.context.container.nodepath,211):await this.component.rendered?.bind(this.context)()}async created(){return await this.component.created?.bind(this.context)()}methods(){if(this.component.methods){this.component.outwards?.methods?.length&&(this.context.container.method={});for(let[t,r]of Object.entries(this.component.methods)){if(this.context.method.hasOwnProperty(t))return m(this.context.container.nodepath,212,t);this.context.method[t]=r.bind(this.context),this.component.outwards?.methods?.includes(t)&&(this.context.container.method[t]=(...n)=>{let o=r.bind(this.context)(l(...n));return o instanceof Promise?o.then(s=>l(s)):l(o)})}}Object.preventExtensions(this.context.method)}params(){if(this.component.params){this.component.outwards?.params?.length&&(this.context.container.param={});for(let t in this.component.params){if(this.context.param.hasOwnProperty(t))return m(this.context.container.nodepath,213,t);this.component.outwards?.params?.includes(t)&&(this.context.container.param[t]=this.component.params[t])}Object.assign(this.context.param,this.component.params)}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return m(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}};function j(e,t,r=""){if(!(e&&(e.constructor.name==="Object"||e.constructor.name==="Array")))return e;let n={getPrototypeOf(o){return{target:o,instance:"Proxy"}},get(o,s,i){return t.get?.(o,s,`${r}${s}`),Reflect.get(o,s,i)},set(o,s,i,a){let c=!1;return t.beforeSet(i,`${r}${s}`,h=>{i=h,c=!0})||!(Reflect.get(o,s,a)!==i||s==="length"||c)||(i=j(i,t,`${r}${s}.`),Reflect.set(o,s,i,a),t.set(o,i,`${r}${s}`)),!0},deleteProperty(o,s){return Reflect.deleteProperty(o,s)},defineProperty(o,s,i){return Reflect.defineProperty(o,s,i)}};e=l(e);for(let o in e)e.hasOwnProperty(o)&&(e[o]=j(e[o],t,`${r}${o}.`));return new Proxy(e,n)}function g(e,t,r){if(!e)return;let n=(o,s)=>{let i=Math.min(o.length,s.length);return o.slice(0,i)===s.slice(0,i)};for(let[o,s]of e)Array.isArray(s)?s.includes(t)&&o(r):n(t,s)&&o(r,t.length>s.length?t.replace(s+".",""):void 0)}var f=(e,t,r="")=>{};var L=class extends N{constructor(t,r,n,o,s){super(t,r,n,o),this.factory=s}async props(){}async mounted(){await this.component.mounted?.bind(this.context)()}actives(t,r){g(t.reactivity?.node,r)}getProxy(){return j(this.proxiesData,{beforeSet:(t,r,n)=>{if(this.component.setters?.[r]){let o=this.component.setters[r].bind(this.context)(t);if(o===void 0)return!0;n(o)}},set:(t,r,n)=>{for(let o in this.context.node)this.actives(this.context.node[o],n,r);this.component.handlers?.[n]?.bind(this.context)(r)},get:(t,r,n)=>{this.impress.collect&&!this.impress.refs.includes(n)&&t.hasOwnProperty(r)&&this.impress.refs.push(n)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),r=this.context.container,n=r.target;for(let o in t){let s=t[o]?.selector||this.context.app.selector||`.${o}`,i=typeof s=="function"?s(o):s,a=n.querySelector(i)||n.classList.contains(o)&&n,c=r.nodepath+"."+o;if(a){if(r.spot&&Object.values(r.spot).includes(a)){f(c,107,o);continue}Object.assign(this.context.node,{[o]:{target:a,nodepath:c,nodename:o,directives:{}}})}else f(c,105)}Object.preventExtensions(this.context.node);for await(let[o,s]of Object.entries(this.context.node))await this.factory(t[o],this.context,s,this.impress,this.app).controller()}}};var x=(e,t,r,n,o="")=>{};var H=class{constructor(t,r,n){this.props=t,this.context=r,this.container=r.container,this.app=n}async setup(t){if(this.props.proxies&&Object.keys(this.props.proxies).length&&!t?.proxies)return x(this.container.nodepath,306);if(this.container.proxy||(this.container.proxy={}),t)return await this.params(t.params),await this.methods(t.methods),await this.proxies(t.proxies)}validation(t,r,n,o,s){let i=this.container.nodepath,a=(u,d)=>u&&d&&!(typeof u===d||d==="array"&&Array.isArray(u))&&x(i,s,n,304,d),c=(u,d)=>u&&Array.isArray(d)&&!d.includes(u)&&x(i,s,n,302,u),p=(u,d)=>u??(d.required&&x(i,s,n,303))??d.default??u,h=(u,d)=>typeof d=="string"?a(u,d):(a(u,d.type),c(u,d.enum),p(u,d));return{string:()=>a(o,r),object:()=>{o=h(o,r),r.validate?.(o,h)},function:()=>r(o,h)}[typeof r]?.(),t[n]=o,h}async proxies(t){if(t){let r={},n=this.context;for(let o in t){let s=t[o],i=null;this.container.proxy[o]={getValue:()=>l(n.proxy[o]),setValue:(p,h)=>{h?(E(n.proxy[o],h,l(p)),s.validate?.(n.proxy[o],i)):this.validation(n.proxy,s,o,l(p),"proxies")},isIndependent:()=>this.props.proxies[o]?._independent||!1};let a=null,{store:c}=s;if(this.props.proxies?.hasOwnProperty(o))a=this.props.proxies[o]?._value;else if(c){let p=await this.app.store?.init(c);if(!p)return x(this.container.nodepath,"proxies",o,307,c);a=p.proxies(o,this.container)}i=this.validation(r,s,o,l(a),"proxies")}return r}}async params(t){for(let r in t){let n=t[r],o=async()=>{let{store:s}=n,i=null;if(s){let a=await this.app.store?.init(s);if(!a)return x(this.container.nodepath,"params",r,307,s);i=a.params(r)}else i=this.props?.params[r];return n?.hole?i:l(i)};this.validation(this.context.param,n,r,await o(),"params"),n.readonly&&Object.defineProperty(this.context.param,r,{writable:!1})}}async methods(t){let r=(n,o)=>{this.context.method[o]=(...s)=>{if(s.length&&(s.length>1||typeof s.at(0)!="object"))return x(this.container.nodepath,"methods",o,301);let i=n({...l(s.at(0)),_params:this.context.container.param,_methods:this.context.container.method});return i instanceof Promise?i.then(a=>l(a)):l(i)}};for(let n in t){let o=t[n],{store:s}=o;if(s){let i=await this.app.store?.init(s);if(!i)return x(this.container.nodepath,"methods",n,307,s);let a=i.methods(n);if(!a)return x(this.container.nodepath,"methods",n,305,s);r(a,n)}else{let i=this.props.methods?.hasOwnProperty(n);if(o?.required&&!i)return x(this.container.nodepath,"methods",n,303);i&&r(this.props.methods[n],n)}}}},J={async init(e,t,r,n){return await new H(e,r,n).setup(t)}};var M=class extends L{constructor(...t){super(...t)}async props(t){this.proxiesData=await J.init(t,this.component.props,this.context,this.app)||{}}actives(t,r,n){let o=i=>{g(i.reactivity?.node,r),g(i.reactivity?.component,r,n)},s=i=>{for(let a in i.spot)o(i.spot[a]),s(i.spot[a])};o(t),t.children?t.children.forEach(i=>s(i)):s(t)}destroy(t){t.reactivity?.component?.clear(),delete t.proxy,delete t.method;for(let r in t.unstore)t.unstore[r]()}unmount(t){if(this.context.node)for(let r of Object.values(this.context.node)){if(r.directives)for(let n of Object.values(r.directives))n.destroy?.();if(r.reactivity?.node?.clear(),!r.unmount)return;for(let n in r.spot)r.spot[n].unmount?.();r.unmount()}this.component.unmounted?.bind(this.context)(),delete t.unmount}};function S(e){if(e.mixins?.length){let t=["directives","params","proxies","methods","handlers","setters","sources"],r=["params","proxies","methods"],n=["loaded","rendered","created","mounted","unmounted"],o={props:{},outwards:{params:[],methods:[]},spots:[]},s=(c,p,h)=>({...c[h],...p[h]}),i=(c,p)=>[...c,...p||[]],a=c=>{o.template=c.template||o.template,o.outwards.params=i(o.outwards.params,c.outwards?.params),o.outwards.methods=i(o.outwards.methods,c.outwards?.methods),o.spots=i(o.spots,c.spots),t.forEach(h=>{o[h]=s(o,c,h)}),n.forEach(h=>{let w=o[h];o[h]=async function(){return c[h]?.bind(this)()||w?.bind(this)()}}),r.forEach(h=>{o.props[h]=s(o.props,c.props||{},h)});let p=o.nodes;o.nodes=function(){return{...p?.bind(this)(),...c.nodes?.bind(this)()}}};return e.mixins.forEach(c=>{a(S(c))}),a(e),o}return e}var _={directives(e){let t=this.nodeElement;if(!e.startsWith("_"))return f(t.nodepath,102,e);let r=this.context.directives[e],n=this.nodeOptions[e],{create:o,update:s,destroy:i}=r;Object.assign(t.directives,{[e]:{create:()=>o?o.bind(r)(t.target,n):{},destroy:()=>i?i.bind(r)(t.target,n):{}}}),o&&t.directives[e].create();let a=(c,p,h)=>{let w=u=>s.bind(r)(t.target,u,p,h);typeof c=="function"?(this.impress.collect=!0,w(c(t.target)),this.reactiveNode(this.impress.define(),()=>w(c(t.target)))):w(c)};if(s)if(typeof n=="object")for(let c in n)a(n[c],c,n);else a(n)}};var C={listeners(e){typeof this.nodeOptions[e]=="function"&&(this.nodeElement.target[e]=t=>this.nodeOptions[e].bind(this.context)(t))},general(e){if(e==="innerHTML")return f(this.nodeElement.nodepath,106);if(typeof this.nodeOptions[e]=="function"){let t=()=>{let r=this.nodeOptions[e].bind(this.context)();this.nodeElement.target[e]!==null&&typeof this.nodeElement.target[e]=="object"?r!==null&&typeof r=="object"?Object.assign(this.nodeElement.target[e],r):f(this.nodeElement.nodepath,103,e):this.nodeElement.target[e]=r};this.impress.collect=!0,t(),this.reactiveNode(this.impress.define(),t)}else this.nodeElement.target[e]=this.nodeOptions[e]},native(e){e.startsWith("on")?this.listeners(e):this.general(e)}};var X={async iterative(e){if(typeof e.iterate!="function")return m(this.nodeElement.nodepath,205);if(this.name=null,this.nodeElement.children=[],this.nodeElement.target.innerHTML="",this.nodeOptions.component=e,this.nodeElement.clear=()=>this.remove.bind(this)(0),this.createIterate=async t=>{this.nodeElement.children[t]=this.nodeElement._current={parent:this.nodeElement,target:!0,nodepath:this.nodeElement.nodepath+"."+t,index:t,isIterable:!0},await this.create(this.proxiesIterate.bind(this),this.nodeElement.children[t],e,this.data[t],t)},this.impress.collect=!0,this.data=e.iterate(),this.data){if(!Array.isArray(this.data))return m(this.nodeElement.nodepath,206);this.name=this.impress.refs.at(-1),this.impress.clear(),this.qty=this.data.length,this.nodeElement.isIterative=!0,Object.getPrototypeOf(this.data).instance==="Proxy"&&(this.reactiveComponent([this.name],n=>{if(this.data=e.iterate(),e.proxies){for(let[o,s]of Object.entries(e.proxies))if(typeof s=="function"&&s.name&&s.length)for(let i=0;i<Math.min(this.nodeElement.target.children.length,n.length);i++)this.nodeElement.children[i]?.proxy?.[o]?.setValue(s(this.nodeElement.children[i]))}this.length(n.length)}),this.reactiveComponent([this.name+".length"],n=>this.length(n)));let t=async()=>(this.data=e.iterate(),await this.length(this.data.length));this.induced(async n=>n?await t():this.nodeElement._clear())&&await t()}},proxiesIterate(e,t){let r=this.nodeElement.children[t],n=(o,s)=>{this.impress.refs.some(i=>i.includes(this.name))?this.reactiveComponent(this.impress.define(o),(i,a)=>{r.proxy&&(a?r.proxy[o]?.setValue(i,a):(this.data=this.nodeOptions.component.iterate(),r.proxy[o]?.setValue(s(r))))}):this.nodeElement.created?this.impress.clear():this.reactiveComponent(this.impress.define(o),(i,a)=>{for(let c=0;c<this.nodeElement.children.length;c++){let p=this.nodeElement.children[c];a?p.proxy?.[o]?.setValue(i,a):p.proxy?.[o]?.setValue(s(p))}})};return this.reactivate(e,n,r)},async length(e){this.qty=e;let t=this.nodeElement.target.children.length;e>t&&await this.add(),e<t&&this.remove(e)},async add(){let e=this.nodeElement.target.children.length;for(this.nodeElement._refillNumber=this.qty-e;this.qty>e;)await this.createIterate(e),this.nodeElement._refillNumber=0,e++},remove(e){let t=this.nodeElement.target.children.length;for(;e<t;)t--,v(this.nodeElement.reactivity.component,this.name+"."+t),this.nodeElement.children[t].unmount?.(),this.nodeElement.children[t].target.remove(),this.nodeElement.children.splice(t,1)}};var Q={async basic(e){this.nodeOptions.component=e;let t=async()=>await this.create(this.proxies.bind(this),this.nodeElement,e);this.induced(async n=>n?await t():this.nodeElement.unmount?.())&&await t()},proxies(e){if(!e)return;let t=(r,n)=>this.reactiveComponent(this.impress.define(r),(o,s)=>{s?this.nodeElement.proxy?.[r]?.setValue(o,s):this.nodeElement.proxy?.[r]?.setValue(n(this.nodeElement))});return this.reactivate(e,t)}};var B={collect(e,t,r){return{params:this.params(e.params,t,r),methods:this.methods(e.methods)}},methods(e){let t={};if(e)for(let[r,n]of Object.entries(e))typeof n=="function"&&Object.assign(t,{[r]:n});return t},params(e,t,r){let n={};if(e)for(let[o,s]of Object.entries(e)){let i=null;typeof s=="function"&&s.name?i=t?s(t,r):s():i=s,Object.assign(n,{[o]:i})}return n}};var G={async component(){if(this.nodeElement.reactivity.component=new Map,this.nodeElement.isIterable)return m(this.nodeElement.nodepath,208);this.nodeElement.mount=async e=>{this.nodeElement.unmount?.(),this.nodeElement.created=!1,e.iterate?await this.iterative(e):await this.basic(e)},this.nodeOptions.component.async?this.nodeElement.mount(this.nodeOptions.component):await this.nodeElement.mount(this.nodeOptions.component)},induced(e){if(this.nodeOptions.component.hasOwnProperty("induce")){this.nodeElement.induce=e;let t=this.nodeOptions.component.induce;if(!t)return;if(typeof t=="function"){this.impress.collect=!0;let r=t();if(this.reactiveNode(this.impress.define(),async()=>await this.nodeElement.induce(t())),!r)return}}return!0},reactiveComponent(e,t){return this.reactive(e,t,this.nodeElement.reactivity.component)},reactivate(e,t){let r={};if(e)for(let[n,o]of Object.entries(e))if(typeof o=="function"&&o.name){this.impress.collect=!0;let s=c=>o(c),i=o(this.nodeElement),a=t(n,s);Object.assign(r,{[n]:{_value:i,_independent:!a}})}else Object.assign(r,{[n]:{_value:o,_independent:!0}});return r},async create(e,t,r,n,o){let{src:s,spots:i,aborted:a,completed:c,ssr:p}=r;if(s&&(await P(s,t,{aborted:a,completed:c,ssr:p,...B.collect(r,n,o),proxies:e(r.proxies,o)||{}},this.app),this.nodeElement.created=!0,!!i))for await(let[h,w]of Object.entries(i)){if(!t.spot.hasOwnProperty(h)){m(t.nodepath,202,h);continue}let u=t.spot[h];Object.assign(u,{parent:t,nodepath:t.nodepath+"."+h,nodename:h,isSpot:!0}),await R(w,this.context,u,this.impress,this.app).controller()}}};var y=class{constructor(t,r,n,o,s){this.app=s,this.nodeOptions=t,this.context=r,this.impress=o,this.nodeElement=n,this.nodeElement.reactivity={node:new Map}}reactive(t,r,n){return t?.length&&n.set(r,t),this.impress.clear(),t}reactiveNode(t,r){this.reactive(t,r,this.nodeElement.reactivity.node)}async controller(){for(let t in this.nodeOptions)t in this.nodeElement.target?this.native(t):t in this.context.directives?this.directives(t):t==="component"?await this.component?.():t==="selector"?this.nodeElement.isSpot&&f(this.nodeElement.nodepath,108):f(this.nodeElement.nodepath,104,t)}};function R(...e){return Object.assign(y.prototype,C,_,X,Q,G),new y(...e)}function q(e,t,r){let n={...t.context.options},o=s=>{n.spots?.length&&(s.spot={}),n.spots?.forEach(i=>Object.assign(s.spot,{[i]:{target:s.target.querySelector(`[spot="${i}"]`)}}))};if(e.isIterable){let s=e.parent;if(!n.template)return m(e.nodepath,209);let{_refillNumber:i}=s;s.target.insertAdjacentHTML("beforeEnd",new Array(i).fill(0).reduce(a=>a+n.template,"")),e.target=s.target.children[e.index],o(e),s.unmount||(s.unmount=()=>{t.destroy(s),s.clear(),delete s.unmount,r.abort()}),e.unmount=()=>{t.destroy(e),t.unmount(e),r.abort()}}else if(n.template)return e.target.innerHTML=n.template,o(e),e.unmount=()=>{t.destroy(e),t.unmount(e),e.target.innerHTML="",r.abort()},e}async function A(e,t,r){let n=[async()=>await e.loaded(),async()=>{if(t(),typeof document<"u")return await e.rendered()},async()=>(await e.props(r),e.params(),e.methods(),e.proxies(),await e.created()),async()=>{if(await e.nodes(),typeof document<"u")return await e.mounted()}],o=s=>({container:e.context.container,phase:e.context.phase,data:s});for await(let s of n){let i=await s();if(e.context.phase++,e.context.abortSignal?.aborted||i){r.aborted?.(o(l(i)));return}}return r.completed?.(o(null)),e.context.container}async function P(e,t,r,n={}){let o=new AbortController,s=o.signal,i=await b(e,s);if(!i)return m(t.nodepath,216);let a=new M(S(i),t,n,s,R);return await A(a,()=>!r.ssr&&q(t,a,o),r)}function Y(...e){return Object.assign(y.prototype,C,_),new y(...e)}async function V({options:e,target:t,name:r="root",aborted:n,completed:o}){if(!e)return m(r,216);if(!t)return m(r,217);let s=new AbortController,i=s.signal,a={target:t,nodepath:r,unmount(){delete c.context.container,t.innerHTML="",s.abort()}},c=new L(e,a,{},i,Y);return await A(c,()=>{t.innerHTML=e.template,c.context.container=a},{aborted:n,completed:o}),a}window.lesta={mountComponent:P,mountWidget:V,replicate:l,deliver:E,deleteReactive:v,cleanHTML:O,loadModule:b,queue:$};})();
