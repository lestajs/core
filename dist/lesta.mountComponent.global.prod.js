(()=>{var et=Object.defineProperty;var ot=(n,t)=>{for(var e in t)et(n,e,{get:t[e],enumerable:!0})};function f(n){return n?typeof n=="object"?JSON.parse(JSON.stringify(n)):n:n??null}function E(n,t,e){let o;try{for(o=0;o<t.length-1;o++)n=n[t[o]];return e!==void 0&&(n[t[o]]=e),n[t[o]]}catch{}}async function b(n,t){if(typeof n=="function"){let e=n();return!(e instanceof Promise)||t?.aborted?void 0:(await(async()=>t?t.aborted?void 0:await Promise.race([e,new Promise(r=>t.addEventListener("abort",()=>r()))]):await e)())?.default}return n}function v(n,t){for(let[e,o]of n)if(Array.isArray(o)){let i=o.indexOf(t);i!==-1&&(o.length===1?n.delete(e):o.splice(i,1))}else o===t&&n.delete(e)}function O(n){function t(a){let p=document.createElement("capsule");return p.innerHTML=a,p}function e(a){let p=a.querySelectorAll("script");for(let c of p)c.remove()}function o(a,p){let c=p.replace(/\s+/g,"").toLowerCase();if(["src","href","xlink:href"].includes(a)&&(c.includes("javascript:")||c.includes("data:text/html"))||a.startsWith("on"))return!0}function i(a){let p=a.attributes;for(let{name:c,value:m}of p)o(c,m)&&a.removeAttribute(c)}function r(a){let p=a.children;for(let c of p)i(c),r(c)}let s=t(n);return e(s),r(s),s.childNodes}var j=()=>{let n=[],t=!1,e=()=>n.length,o=()=>n.length===0,i=s=>{n.push(s),t||(t=!0,r())},r=async()=>{let s=n.at(0);s?(await s(),n.shift(),r()):t=!1};return{add:i,isEmpty:o,size:e}};var h=(n="root",t,e="")=>{};var M=class{constructor(t,e,o){this.component=t,this.app=e,this.proxiesData={},this.context={...e,mount:e.mount,phase:0,abortSignal:o,options:t,container:null,node:{},param:{},method:{},proxy:{},source:t.sources||{}}}async loaded(t){if(this.component.loaded)return await this.component.loaded.bind(this.context)(t)}async rendered(){if(typeof this.component!="object")return h(this.context.container.nodepath,211);if(this.component.rendered)return await this.component.rendered.bind(this.context)()}async created(){if(this.component.created)return await this.component.created.bind(this.context)()}methods(){if(this.context.container.method||(this.context.container.method={}),this.component.methods)for(let[t,e]of Object.entries(this.component.methods))this.context.method[t]=e.bind(this.context),this.context.container.method[t]=(...o)=>this.context.method[t](...f(o));Object.preventExtensions(this.context.method)}params(){if(this.component.params){for(let t in this.component.params)if(t in this.context.param)return h(this.context.container.nodepath,213,t);Object.assign(this.context.param,f(this.component.params))}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return h(this.context.container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=this.getProxy(),Object.preventExtensions(this.context.proxy)}};function L(n,t,e=""){if(!(n&&(n.constructor.name==="Object"||n.constructor.name==="Array")))return n;let o={getPrototypeOf(i){return{target:i,instance:"Proxy"}},get(i,r,s){return typeof r=="symbol"||t.get?.(i,`${e}${r}`),Reflect.get(i,r,s)},set(i,r,s,a){if(typeof r=="symbol")return Reflect.set(i,r,s,a);let p=!1;return t.beforeSet(s,`${e}${r}`,m=>{s=m,p=!0})||!(Reflect.get(i,r,a)!==s||r==="length"||p)||(s=L(s,t,`${e}${r}.`),Reflect.set(i,r,s,a),t.set(i,s,`${e}${r}`)),!0},deleteProperty(i,r){return Reflect.deleteProperty(i,r)},defineProperty(i,r,s){return Reflect.defineProperty(i,r,s)}};n=f(n);for(let i in n)n[i]=L(n[i],t,`${e}${i}.`);return new Proxy(n,o)}function C(n,t,e){let o=(i,r)=>{let s=Math.min(i.length,r.length);return i.slice(0,s)===r.slice(0,s)};for(let[i,r]of n)Array.isArray(r)?r.includes(t)&&i(e):o(t,r)&&i(e,t.length>r.length?t.replace(r+".","").split("."):void 0)}var _={};ot(_,{_attr:()=>X,_class:()=>J,_evalHTML:()=>I,_event:()=>Q,_html:()=>F,_text:()=>B});var F={update:(n,t)=>{n.innerHTML="",t&&n.append(...O(t))}};var I={update:(n,t)=>t!==void 0?n.innerHTML=t:""};var J={update:(n,t,e)=>t?n.classList.add(e):n.classList.remove(e)};var B={update:(n,t)=>n.textContent=t!==Object(t)?t:JSON.stringify(t)};var X={update:(n,t,e)=>{typeof t=="boolean"?t?n.setAttribute(e,""):n.removeAttribute(e):n.setAttribute(e,t)}};var Q={create:(n,t)=>{for(let e in t)n.addEventListener(e,t[e])},destroy:(n,t)=>{for(let e in t)n.removeEventListener(e,t[e])}};var x=(n,t,e="")=>{};var Y={refs:[],collect:!1,define(n){return n&&this.refs.every(t=>t.startsWith(this.refs.at(0)))?this.refs.at(-1):[...this.refs]},clear(){this.collect=!1,this.refs.length=0}};var A=class extends M{constructor(t,e,o,i){super(t,e,o),this.Nodes=i,this.impress=Y,this.context={...this.context,directives:{..._,...e.directives,...t.directives}}}async props(){}async mounted(){this.component.mounted&&await this.component.mounted.bind(this.context)()}getProxy(){return L(this.proxiesData,{beforeSet:(t,e,o)=>{if(this.component.setters?.[e]){let i=this.component.setters[e].bind(this.context)(t);if(i===void 0)return!0;o(i)}},set:(t,e,o)=>{for(let i in this.context.node){let r=this.context.node[i];r.reactivity.node&&C(r.reactivity.node,o),r.reactivity.component&&C(r.reactivity.component,o,e);for(let s in r.section)r.section[s]?.reactivity.component&&C(r.section[s].reactivity.component,o,e)}this.component.handlers?.[o]?.bind(this.context)(e)},get:(t,e)=>{this.impress.collect&&!this.impress.refs.includes(e)&&this.impress.refs.push(e)}})}async nodes(){if(this.component.nodes){let t=this.component.nodes.bind(this.context)(),e=this.context.container;for await(let[o,i]of Object.entries(t)){let r=i.selector||this.context.selector||`.${o}`,s=typeof r=="function"?r(o):r,a=e.querySelector(s)||e.classList.contains(o)&&e,p=e.nodepath?e.nodepath+"."+o:o;if(a){if(a.nodepath=p,a.nodename=o,Object.assign(this.context.node,{[o]:a}),i){let c=new this.Nodes(i,this.context,a,this.impress,this.app,o);for await(let[m]of Object.entries(i))await c.controller(m)}}else x(p,105)}Object.preventExtensions(this.context.node)}}};var d=(n="root",t,e,o,i="")=>{};var V=class{constructor(t,e,o){this.props=t,this.context=e,this.container=e.container,this.app=o}async setup(t){if(this.props.proxies&&Object.keys(this.props.proxies).length&&!t?.proxies)return d(this.container.nodepath,306);if(this.container.proxy||(this.container.proxy={}),t)return await this.params(t.params),await this.methods(t.methods),await this.proxies(t.proxies)}validation(t,e,o,i,r){let s=this.container.nodepath,a=(u,l)=>u&&l&&!(typeof u===l||l==="array"&&Array.isArray(u))&&d(s,r,o,304,l),p=(u,l)=>u&&Array.isArray(l)&&!l.includes(u)&&d(s,r,o,302,u),c=(u,l)=>u??(l.required&&d(s,r,o,303)||l.default),m=(u,l)=>typeof l=="string"?a(u,l):(a(u,l.type),p(u,l.enum),c(u,l));return{string:()=>a(i,e),object:()=>{i=m(i,e),e.validate?.(i,m)},function:()=>e(i,m)}[typeof e]?.(),t[o]=i,m}async proxies(t){if(t){let e={};for(let o in t){let i=t[o],r=this.context,s=null;this.container.proxy[o]=(c,m)=>{m?.length?(E(r.proxy[o],m,c),i.validate?.(r.proxy[o],s)):this.validation(r.proxy,i,o,c,"proxies")};let a=null,{store:p}=i;if(this.props.proxies&&o in this.props.proxies)a=this.props.proxies[o];else if(p){let c=await this.context.store?.init(p);if(!c)return d(this.container.nodepath,"proxies",o,307,p);a=c.proxies(o,this.container)}s=this.validation(e,i,o,f(a),"proxies")}return e}}async params(t){for(let e in t){let o=t[e],i=async()=>{let{store:r}=o,s=null;if(r){let a=await this.context.store?.init(r);if(!a)return d(this.container.nodepath,"params",e,307,r);s=a.params(e)}else s=this.props?.params[e];return o?.ignore?s:f(s)};this.validation(this.context.param,o,e,await i(),"params"),o.readonly&&Object.defineProperty(this.context.param,e,{writable:!1})}}async methods(t){for(let e in t){let o=t[e],{store:i}=o;if(i){let r=await this.context.store?.init(i);if(!r)return d(this.container.nodepath,"methods",e,307,i);let s=r.methods(e);if(!s)return d(this.container.nodepath,"methods",e,305,i);this.context.method[e]=async(...a)=>await s(...f(a))}else{let r=this.props.methods&&e in this.props.methods;if(o?.required&&!r)return d(this.container.nodepath,"methods",e,303);r&&(this.context.method[e]=async(...s)=>await this.props.methods[e](...f(s)))}}}},G={async init(n,t,e,o){return await new V(n,e,o).setup(t)}};var H=class extends A{constructor(...t){super(...t)}async props(){this.proxiesData=await G.init(this.context.options.inputs,this.component.props,this.context,this.app)||{}}destroy(t){t.reactivity?.component?.clear(),delete t.proxy,delete t.method;for(let e in t.unstore)t.unstore[e]()}unmount(t){if(this.context.node)for(let e of Object.values(this.context.node)){if(e.unmount&&!e.hasAttribute("iterable")){if(e.section)for(let o of Object.values(e.section))o.unmount&&o.unmount();e.unmount()}if(e.directives)for(let o of Object.values(e.directives))o.destroy&&o.destroy();e.reactivity?.node?.clear()}this.component.unmounted&&this.component.unmounted.bind(this.context)(),delete t.unmount}};function U(n){if(n.mixins?.length){let t=["selectors","directives","params","proxies","methods","handlers","setters","sources"],e=["params","proxies","methods"],o=["loaded","rendered","created","mounted","unmounted"],i={props:{}},r=(a,p,c)=>({...a[c],...p[c]}),s=a=>{i.template=a.template||i.template,t.forEach(c=>{i[c]=r(i,a,c)}),o.forEach(c=>{let m=i[c];i[c]=async function(){return a[c]?.bind(this)()||m?.bind(this)()}}),e.forEach(c=>{i.props[c]=r(i.props,a.props||{},c)});let p=i.nodes;i.nodes=function(){return{...p?.bind(this)(),...a.nodes?.bind(this)()}}};return n.mixins.forEach(a=>{s(U(a))}),s(n),i}return n}var y=class{constructor(t,e,o,i,r,s){this.app=r,this.node=t,this.context=e,this.impress=i,this.nodeElement=o,this.keyNode=s,this.nodeElement.reactivity={node:new Map}}reactive(t,e,o){t?.length&&o.set(e,t),this.impress.clear()}reactiveNode(t,e){this.reactive(t,e,this.nodeElement.reactivity.node)}};var K={collect(n,t,e){return{params:this.params(n.params,t,e),methods:this.methods(n.methods),section:n.section}},methods(n){let t={};if(n)for(let[e,o]of Object.entries(n))typeof o=="function"&&Object.assign(t,{[e]:o});return t},params(n,t,e){let o={};if(n)for(let[i,r]of Object.entries(n)){let s=null;typeof r=="function"&&r.name?s=t?r(t,e):r():s=r,Object.assign(o,{[i]:s})}return o}};async function Z(n,t,e,o,i){if(n.sections){let r=async(s,a)=>{if(n.iterate)return h(e.section[s].nodepath,204);e.section[s].unmount?.(),a.src&&(a.section=s,await i(t,e,a,()=>o(a.proxies,e.section[s],s)))};e.section={};for await(let[s,a]of Object.entries(n.sections)){if(a.induce||a.iterate)return h(e.section[s].nodepath,215);let p=e.querySelector(`[section="${s}"]`);if(!p)return h(e.nodepath,201,s);p.reactivity||(p.reactivity={component:new Map}),Object.assign(e.section,{[s]:p}),a.src&&await r(s,a),p.mount=async c=>await r(s,c||a)}}}var w=class extends y{constructor(...t){super(...t),this.nodeElement.reactivity.component=new Map}reactiveComponent(t,e,o){let i=o||this.nodeElement;this.reactive(t,e,i.reactivity.component)}reactivate(t,e,o,i,r){let s={};if(t)for(let[a,p]of Object.entries(t))if(typeof p=="function"&&p.name){this.impress.collect=!0;let c=o&&p.length?p(o[i],i):p(r);Object.assign(s,{[a]:c}),e(a,p),this.impress.clear()}else Object.assign(s,{[a]:p});return s}async create(t,e,o,i,r,s){let{src:a,abortSignal:p,aborted:c,sections:m,ssr:g}=o;if(!a)return h(e.nodepath,203);let u=null;e.process||(e.process=!0,u=await this.app.mount(a,e,{abortSignal:p,aborted:c,sections:m,ssr:g,...K.collect(o,r,s),proxies:i()||{}}),delete e.process),u&&await Z(o,t,u,(l,$,z)=>s!==void 0?t(l,u.section[z],s):t(l,$),this.create.bind(this))}};var P=class extends w{constructor(...t){super(...t),this.queue=j(),this.name=null,this.created=!1,this.nodeElement.toEmpty=()=>this.remove.bind(this)(0)}async init(){if(typeof this.node.component.iterate!="function")return h(this.nodeElement.nodepath,205);if(this.createIterate=async t=>{this.created||(this.nodeElement.style.visibility="hidden");let e=()=>this.proxies(this.node.component.proxies,this.nodeElement.children[t],t);if(await this.create(this.proxies.bind(this),this.nodeElement,this.node.component,e,this.data[t],t),!this.created){if(this.nodeElement.children.length>1)return h(this.nodeElement.nodepath,210);this.nodeElement.style.removeProperty("visibility")}this.created=!0},this.impress.collect=!0,this.data=this.node.component.iterate(),this.data){if(!Array.isArray(this.data))return h(this.nodeElement.nodepath,206);this.name=this.impress.refs.at(-1),this.impress.clear(),this.nodeElement.setAttribute("iterate",""),Object.getPrototypeOf(this.data).instance==="Proxy"&&(this.reactiveComponent([this.name],async e=>{this.data=this.node.component.iterate(),e.length&&this.queue.add(async()=>{if(this.node.component.proxies){for(let[o,i]of Object.entries(this.node.component.proxies))if(typeof i=="function"&&i.name&&i.length)for(let r=0;r<Math.min(this.nodeElement.children.length,e.length);r++){let s=i(this.data[r],r);this.nodeElement.children[r].proxy[o]?.(s),this.sections(this.node.component.sections,this.nodeElement.children[r],r)}}}),this.queue.add(async()=>await this.length(e.length))}),this.reactiveComponent([this.name+".length"],async e=>{this.queue.add(async()=>await this.length(e))}));let t=async()=>await this.add(this.data.length);if(this.node.component.induce){if(typeof this.node.component.induce!="function")return h(this.nodeElement.nodepath,212);this.impress.collect=!0;let e=this.node.component.induce();this.reactiveNode(this.impress.define(),async()=>{this.node.component.induce()?await t():this.nodeElement.toEmpty()}),e&&await t()}else await t()}}sections(t,e,o){if(t)for(let[i,r]of Object.entries(t))for(let[s,a]of Object.entries(r.proxies))typeof a=="function"&&a.name&&a.length&&(e.section[i]?.proxy[s]?.(a(this.data[o],o)),this.sections(r.sections,e.section[i],o))}proxies(t,e,o){let i=(r,s)=>{this.impress.refs.some(a=>a.includes(this.name))?this.reactiveComponent(this.impress.define(r),async(a,p)=>{this.queue.add(async()=>{if(p)this.nodeElement.children[o]?.proxy[r]?.(a,p);else if(this.data=this.node.component.iterate(),o<this.data.length){let c=s(this.data[o],o);this.nodeElement.children[o]?.proxy[r]?.(c)}})},e):this.created?this.impress.clear():this.reactiveComponent(this.impress.define(r),async(a,p)=>{!this.nodeElement.process&&this.queue.add(async()=>{for(let c=0;c<this.nodeElement.children.length;c++)p?this.nodeElement.children[c].proxy[r]?.(a,p):this.nodeElement.children[c].proxy[r]?.(s(this.data[c],c))})},e)};return this.reactivate(t,i,this.data,o)}async length(t){if(this.data=this.node.component.iterate(),this.data.length===t){let e=this.nodeElement.children.length;t>e&&await this.add(t),t<e&&this.remove(t)}}async add(t){let e=this.nodeElement.children.length;for(;t>e;)await this.createIterate(e),e++}remove(t){let e=this.nodeElement.children.length;for(;t<e;)e--,v(this.nodeElement.reactivity.component,this.name+"."+e),this.nodeElement.children[e].unmount()}};var R=class extends w{constructor(...t){super(...t)}async init(){let t=async e=>await this.create(this.proxies.bind(this),this.nodeElement,e,()=>this.proxies(e.proxies,this.nodeElement));if(this.nodeElement.mount=t,this.node.component.induce){if(typeof this.node.component.induce!="function")return h(this.nodeElement.nodepath,212);this.impress.collect=!0;let e=this.node.component.induce();this.reactiveNode(this.impress.define(),async()=>{this.node.component.induce()?this.nodeElement.unmount||await t(this.node.component):this.nodeElement.unmount?.()}),e&&await t(this.node.component)}else this.node.component.src&&await t(this.node.component)}proxies(t,e){let o=(i,r)=>this.reactiveComponent(this.impress.define(i),(s,a)=>a?e.proxy[i]?.(s,a):e.proxy[i]?.(r()),e);return this.reactivate(t,o,null,null,e)}};var S=class extends y{constructor(...t){super(...t)}init(t){let e=this.nodeElement;if(!t.startsWith("_"))return x(e.nodepath,102,t);let o=this.context.directives[t],i=this.node[t],{create:r,update:s,destroy:a}=o;e.hasOwnProperty("directives")||Object.assign(e,{directives:{}}),Object.assign(e.directives,{[t]:{create:()=>r?r.bind(o)(e,i):{},destroy:()=>a?a.bind(o)(e,i):{}}}),r&&e.directives[t].create();let p=(c,m,g)=>{let u=()=>s.bind(o)(e,typeof c=="function"?c(e):c,m,g);this.impress.collect=!0,u(),this.reactiveNode(this.impress.define(),u)};if(s)if(typeof i=="object")for(let c in i)p(i[c],c,i);else p(i)}};var T=class extends y{constructor(...t){super(...t)}listeners(t){typeof this.node[t]=="function"&&(this.nodeElement[t]=e=>this.node[t].bind(this.context)(e,this.nodeElement))}general(t){if(t==="innerHTML")return x(this.nodeElement.nodepath,106);if(typeof this.node[t]=="function"){let e=()=>{let o=this.node[t].bind(this.context)(this.nodeElement);this.nodeElement[t]!==null&&typeof this.nodeElement[t]=="object"?o!==null&&typeof o=="object"?Object.assign(this.nodeElement[t],o):x(this.nodeElement.nodepath,103,t):this.nodeElement[t]=o};this.impress.collect=!0,e(),this.reactiveNode(this.impress.define(),e)}else this.nodeElement[t]=this.node[t]}init(t){t.startsWith("on")?this.listeners(t):this.general(t)}};var N=class{constructor(t,e,o,i,r,s){this.app=r,this.node=t,this.context=e,this.impress=i,this.nodeElement=o,this.keyNode=s,this.directive=new S(t,e,o,i,r,s),this.native=new T(t,e,o,i,r,s)}async controller(t){t in this.nodeElement?this.native.init(t):t in this.context.directives?this.directive.init(t):t==="component"&&this.component?await this.component():t!=="selector"&&x(this.nodeElement.nodepath,104,t)}};var q=class extends N{constructor(...t){super(...t)}async component(){if(this.nodeElement.hasAttribute("section"))return h(this.nodeElement.nodepath,207);if(this.nodeElement.hasAttribute("iterable"))return h(this.nodeElement.nodepath,208);let{node:t,context:e,nodeElement:o,impress:i,app:r,keyNode:s}=this;this.node.component.iterate?(this.iterate=new P(t,e,o,i,r,s),await this.iterate.init()):(this.basic=new R(t,e,o,i,r,s),await this.basic.init())}};function W(n,t,e,o){let i={...t.context.options};if(e){let r=n.section[e];return r?(o||(r.innerHTML=i.template),r.nodepath=n.nodepath+"."+e,r.nodename=e,r.unmount=()=>{t.destroy(r),t.unmount(r),r.innerHTML=""},r):h(n.nodename,202,e)}else{if(n.hasAttribute("iterate")){if(!i.template)return h(n.nodepath,209);o||n.insertAdjacentHTML("beforeEnd",i.template);let r=n.children[n.children.length-1];return r.nodepath=n.nodepath,n.unmount||(n.unmount=()=>{t.destroy(n),n.toEmpty(),delete n.unmount}),r.setAttribute("iterable",""),r.unmount=async()=>{t.destroy(r),t.unmount(r),r.remove()},r}else i.template&&!o&&(n.innerHTML=i.template);return n.unmount=()=>{t.destroy(n),t.unmount(n),n.innerHTML=""},n}}async function k(n,t,e){let o=[async()=>await n.loaded(),async()=>{if(n.context.container=t(),typeof document<"u")return await n.rendered()},async()=>(await n.props(),n.params(),n.methods(),n.proxies(),await n.created()),async()=>{if(await n.nodes(),typeof document<"u")return await n.mounted()}];for await(let i of o){let r=await i();if(n.context.phase++,n.context.abortSignal?.aborted||r){e&&e({phase:n.context.phase,data:r,abortSignal:n.context.abortSignal});return}}return n.context.container}async function D(n,t,e={},o={}){let{signal:i,aborted:r,params:s,methods:a,proxies:p,sections:c,section:m,ssr:g}=e,u=t.nodepath||"root";i&&!(i instanceof AbortSignal)&&h(u,217),r&&typeof r!="function"&&h(u,218);let l=await b(n,i);if(!l)return h(u,216);let $=new H(U(l),o,i,q);return $.context.options.inputs={params:s,methods:a,proxies:p,sections:c},await k($,()=>W(t,$,m,g),r)}window.lesta={mountComponent:D,replicate:f,deliver:E,deleteReactive:v,cleanHTML:O,loadModule:b,queue:j};})();
